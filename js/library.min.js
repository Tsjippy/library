(()=>{"use strict";let e,t=function(e){"undefined"!=typeof tinymce&&(tinymce.remove(),document.querySelectorAll(".entry-content .wp-editor-area").forEach(e=>{window.tinyMCE.execCommand("mceAddEditor",!1,e.id)})),window.document.dispatchEvent(new Event("DOMContentLoaded",{bubbles:!0,cancelable:!0})),document.querySelectorAll(".wp-switch-editor").forEach(e=>e.addEventListener("click",t=>{let l=e.closest(".wp-editor-wrap").querySelector(".wp-editor-area"),r=e.closest(".wp-editor-wrap").querySelector(".mce-panel");l.style.visibility="unset",t.target.matches(".switch-tmce")?(r.style.display="block",l.style.display="none"):(r.style.display="none",l.style.display="block")})),document.querySelectorAll("select:not(.nonice,.swal2-select)").forEach(function(e){Main.attachNiceSelect(e)});const t=new Event("scriptsloaded");e.dispatchEvent(t)},l=function(r){if(null==r)return;0==e.length&&t(r);let a=e.shift();if(null!=a)if("SCRIPT"==a.tagName&&null==document.getElementById(a.id)){var n=document.createElement("script");""==a.type?n.type="text/javascript":n.type=a.type,""!=a.src?n.src=a.src:n.innerHTML=a.innerHTML,n.id=a.id;try{document.head.appendChild(n)}catch(e){console.error(e)}e.length>0?""!=a.src?n.addEventListener("load",l.bind(null,r)):l(r):""!=a.src?n.addEventListener("load",t.bind(null,r)):t(r)}else e.length>0?l(r):t(r);else t(r)};function r(e,t,l=!0,r=null,a=!1){let n="",o="",s="",c="";return e instanceof Element?(n=e,"INPUT"!=n.tagName&&"TEXTAREA"!=n.tagName&&"SELECT"!=n.tagName&&null==n.closest(".nice-select-dropdown")&&(n=n.querySelector("input, select, textarea")),null==n&&(n=e),o=n.name):e.match("E[0-9]")?(c=`[id^=${e}]`,n=t.querySelector(c),o=n.name):(o=e,c=`[name='${o}' i]`,n=t.querySelector(c)),null==n?(console.trace(),console.log("cannot find element with name "+o),s):("radio"==n.type?s=function(e,t){let l=e.querySelector(`${t}:checked`);return null==l?"":l.value}(t,c):"checkbox"==n.type?s=function(e,t,l,r){let a="",n="";return"checkbox"==r.type&&null!=l?r.checked?r.value:"":(null!=l?(n=e.querySelector(`${t}[value="${l}" i]:checked`),null!=n&&(a=l)):(n=e.querySelectorAll(`${t}:checked`),a=[],n.forEach(e=>{a.push(e.value)})),a)}(t,c,r,e):null!=n.closest(".nice-select-dropdown")&&null!=n.dataset.value?s=n.dataset.value:null!=n.list&&""!=n.value&&l?s=function(e){let t="",l=e.list.querySelector(`[value='${e.value}' i]`);return t=null==l?e.value:l.dataset.value,t}(n):null!=n.name&&n.name.endsWith("[]")?s=function(e,t){let l=[];return e.querySelectorAll(`[name="${t.name}"]`).forEach(e=>l.push(e.value)),l}(t,n):null!=n.value&&"undefined"!=n.value&&(s=n.value),a?s.toLowerCase():s)}function a(e){Array.from(e.options).forEach(function(e){e.defaultSelected=!1})}console.log("Forms.js is loaded");let n,o,s,c=[];function i(e,t=!0){!function(e){"undefined"!=typeof tinymce&&e.querySelectorAll(".wp-editor-area").forEach(e=>{let t=tinymce.get(e.id);null!=t&&(c[e.id]=t.settings,t.save(),t.remove())})}(e);let l=e.cloneNode(!0);return l.querySelectorAll(".nice-select").forEach(e=>e.remove()),e.querySelectorAll(".wp-editor-area").forEach(e=>{null!=c[e.id]&&tinymce.init(c[e.id])}),t&&l.querySelectorAll("input,select,textarea").forEach(e=>{"checkbox"==e.type||"radio"==e.type?e.checked=!1:"hidden"!=e.type&&(e.value=""),"select-one"==e.type&&a(e)}),l.querySelectorAll("select").forEach(e=>{a(e),Main.attachNiceSelect(e)}),l}function d(e){let t=i(e);t.querySelectorAll(".upload-files").forEach(function(e){e.dataset.index=nodeNr}),t.querySelectorAll(".documentpreview").forEach(function(e){e.innerHTML=""});let l=0;if(t.querySelectorAll("select").forEach(t=>{let r=e.getElementsByTagName("select")[l].selectedIndex;null!=t.options[r]&&(t.options[r].style.display="none"),Main.attachNiceSelect(t),l++}),null==e.querySelector(".remove")&&null==t.querySelector(".remove")){let l='<button type="button" class="remove button" style="flex: 1;">-</button>';e.querySelector(".buttonwrapper").insertAdjacentHTML("beforeend",l),t.querySelector(".buttonwrapper").insertAdjacentHTML("beforeend",l)}if(e.matches(".tabcontent")){e.classList.add("hidden");let t=e.closest(".clone_divs_wrapper").querySelector(".tablink.active"),l=i(t);t.classList.remove("active"),t.parentNode.insertBefore(l,t.nextSibling)}return e.parentNode.insertBefore(t,e.nextSibling),t}function u(e){function t(e,t){""!=e.id&&(e.id=e.id.replace(/[0-9]+(?!.*[0-9])/,t)),"button"==e.type&&""!=e.textContent&&(e.textContent=e.textContent.replace(/[0-9]+(?!.*[0-9])/,t+1),e.dataset.target=e.dataset.target.replace(/[0-9]+(?!.*[0-9])/,t)),null!=e.dataset.divid&&(e.dataset.divid=t),e.querySelectorAll("h3, h4, legend :first-child").forEach(e=>{e.textContent=e.textContent.replace(/[0-9]+(?!.*[0-9])/,t+1)}),e.querySelectorAll("input,select,textarea").forEach(e=>{e.classList.contains("nice-select-search")||(""!=e.id&&null!=e.id&&(e.id=e.id.replace(/[0-9]+(?!.*[0-9])/,t)),""!=e.name&&null!=e.name&&(e.name=e.name.replace(/[0-9]+(?!.*[0-9])/,t)),"button"==e.type&&(e.value=e.value.replace(/[0-9]+(?!.*[0-9])/,t)))})}e.querySelectorAll(":scope > .clone_div").forEach(t),e.querySelectorAll(":scope > .tablink").forEach(t)}function p(e){let t=e.closest(".clone_div"),l=t.closest(".clone_divs_wrapper"),r=l.querySelectorAll(".clone_div");if(r[r.length-1]==t){let e=t.querySelector(".add"),l=t.previousElementSibling;null==l.querySelector(".buttonwrapper .add")&&l.querySelector(".buttonwrapper").appendChild(e)}t.remove(),1==l.querySelectorAll(".clone_div").length&&l.querySelector(".remove").remove(),u(l)}function m(e,t,l,a,n="",o=!1){if(null==t)return;let s="",c="";if(e instanceof Element)c=e,s=c.name,e=""==c.id?`[name^="${c.name}" i]`:`[id^=${c.id}]`;else{c=a.querySelector(e);try{s=c.name}catch{console.log(c)}}if(r(c,a,!1,t)==t)return;if(null==c){let e=a.querySelectorAll(`.clone_div [name^="${s}" i]`);if(0===e.length)return;1==e.length?(c=e[0],e=""):(c=e[0],e.forEach((e,t)=>{0==t?m(e,"","",a):p(e)}))}if(""!=n)if(/\d{4}-\d{2}-\d{2}/.test(t)){let e=new Date(t);e.setDate(e.getDate()+parseInt(n)),t=e.toISOString().split("T")[0]}else t+=parseInt(n);if("radio"==c.type||"checkbox"==c.type)if(""==t)""!=e&&a.querySelectorAll(e).forEach(e=>e.checked=!1);else if(c.value.toLowerCase()==t.toLowerCase())c.checked=!0;else{let e=a.querySelectorAll(`[name="${s}" i]`);for(const l of e)l.value.toLowerCase()==t.toLowerCase()&&(l.checked=!0)}else if("date"==c.type){if(c.value=t,!/\d{4}-\d{2}-\d{2}/.test(t)){let e="";if(3==t.split("-").length?e=t.split("-"):3==t.split("/").length&&(e=t.split("/")),""!=e){let t,l,r;e.forEach(e=>{4==e.length?t=e:2==e.length&&(e>12?r=e:null==l?l=e:r=e)}),null!=r&&null!=l&&null!=t&&(c.value=`${t}-${l}-${r}`)}}}else if(null!=c.list){let e=c.list.querySelector(`[data-value="${t}" i]`);if(null!=e)if(null!=c.closest(".clone_div")){let t;c.closest(".clone_divs_wrapper").querySelectorAll(".clone_div").forEach(e=>e.classList.add("shouldremove")),e.value.split(";").forEach(e=>{t=d(c.closest(".clone_div")),t.classList.remove("shouldremove"),m(t.querySelector(c.tagName),e,"",a,"",!0)}),u(c.closest(".clone_divs_wrapper")),c.closest(".clone_divs_wrapper").querySelectorAll(".shouldremove").forEach(e=>e.remove())}else c.value=e.value;else c.value=o?t:""}else c.value=t;let i=new Event("input");c.dispatchEvent(i),"function"==typeof l&&l(c)}async function f(e){let t=e.closest(".form.table-wrapper"),l=e.outerHTML,r=new FormData,a=t.querySelector(".sim-table.form-data-table").dataset.formid,n=t.querySelector(".sim-table.form-data-table").dataset.shortcodeid;r.append("formid",a),r.append("shortcode_id",n);const o=new URL(window.location);o.searchParams.get("onlyown")&&r.append("onlyown",!0),o.searchParams.get("all")&&r.append("all",!0),o.searchParams.get("archived")&&r.append("archived",!0);let s=Main.showLoader(e,!1,"Requesting form results...");t.innerHTML=s.outerHTML;let c=await FormSubmit.fetchRestApi("forms/show_form_results",r);c?t.innerHTML=c:s.outerHTML=l}function h(e){null!=e.target.closest("td")&&e.target.closest("td").matches(".editing")||(e.stopPropagation(),document.removeEventListener("click",h),g(e,document.querySelector(".editing input, .editing select, .editing textarea")))}function y(e){e.closest("td").classList.add("editing"),n=e.textContent,"Click to update"!=n&&"X"!=n||(n=""),e.innerHTML=`<input type="text" value="${n}">`,function(e){let t=e.querySelectorAll("input,select,textarea");t.forEach(e=>{n.split(",").forEach(t=>{"checkbox"==e.type||"radio"==e.type?e.value==t.trim()&&(e.checked=!0):"select"==e.type?e.querySelector('option[value="'+t+'"]').selected=!0:e.value=n}),"select-one"==e.type&&null==e._niceselect&&Main.attachNiceSelect(e),e.addEventListener("keyup",function(e){13===e.keyCode&&g(e)}),document.addEventListener("click",h),"checkbox"==e.type&&1!=t.length||("date"==e.type?e.addEventListener("blur",function(e){""!=e.target.value&&g(e)}):e.addEventListener("change",function(e){""!=e.target.value&&g(e)}),e.focus())})}(e)}async function g(e,t){void 0===t&&(t=e.target);let l=t.closest("td"),a=r(t,l,!1),o=t.closest("table");if(a!=n){let e=new FormData;e.append("value",JSON.stringify(a));for(let t in l.dataset)e.append(t,l.dataset[t]);for(let l in t.closest("tr").dataset)e.append(l,t.closest("tr").dataset[l]);Main.showLoader(l.firstChild),await FormSubmit.fetchRestApi(o.dataset.url,e)&&(l.innerHTML=a)}else console.log(a),t.closest("td").innerHTML=n;l.classList.remove("editing")}function v(){document.querySelectorAll(".sim-table").forEach(function(e){let t=[];e.querySelectorAll("thead th").forEach((e,l)=>{null!=e.dataset.nicename?t[l]=e.dataset.nicename:t[l]=e.textContent}),e.querySelectorAll("tbody td").forEach(e=>{e.hasAttribute("label")||null==t[e.cellIndex]||e.setAttribute("label",t[e.cellIndex]),"X"!=e.textContent&&""!=e.textContent||e.classList.add("mobile-hidden")})})}async function w(e){e.textContent="Close full screen",e.classList.replace("show","close");let t=e.closest(".table-wrapper");window.lastY=window.pageYOffset,window.scrollTo(0,0),document.querySelector("body").style.overflow="hidden",document.querySelector("header").style.zIndex="unset",t.classList.add("fullscreen"),t.style.marginLeft="0px";let l=new URL(window.location);l.searchParams.set("fullscreen",t.querySelector("table").dataset.formid),window.history.pushState({},"",l),S(),t.requestFullscreen().catch(e=>{})}function S(){let e,t,l=new URLSearchParams(window.location.search).get("fullscreen");document.querySelectorAll(".sim-table").forEach(r=>{let a=r.closest(".table-wrapper");if(null==a)return;null!=l?(t=0,a.querySelectorAll(".table-head").forEach(e=>t=e.offsetHeight)):t=document.querySelector("header").offsetHeight,e=0,a.querySelectorAll(".sim-table-footer").forEach(t=>e=t.offsetHeight);let n=t+e+40;r.style.maxHeight=`calc(100vh - ${n}px)`})}function b(){document.querySelectorAll(".table-wrapper").forEach(e=>{let t="",l=0,r=e.querySelector("table");if(null==r)return;let a=r.scrollWidth;if(0!=a){if(window.innerWidth<570)t=e.getBoundingClientRect().x;else{let r=window.innerWidth-a;a/window.innerWidth<.7?null!=document.querySelector(".is-right-sidebar")&&(r=.7*window.innerWidth-a):(document.getElementById("primary").style.zIndex=1,document.querySelectorAll("#right-sidebar").forEach(e=>e.style.zIndex=0)),l=r<20?10:r/2,""!=e.style.marginLeft&&(e.style.marginLeft="-0px"),t=parseInt(e.getBoundingClientRect().x)-l}e.style.marginLeft=`-${t}px`}})}async function q(e,t){if(s=e.files.length,s<0)return;let l=new FormData;l.append("action","process_library_upload"),l.append("location",t);for(let t=0;t<s;t++){let r=e.files[t];l.append("files[]",r)}let r=new XMLHttpRequest;r.onreadystatechange=E,r.upload.addEventListener("progress",L,!1),r.open("POST",sim.ajaxUrl,!0),o.querySelectorAll(".loadergif_wrapper").forEach(e=>{e.classList.remove("hidden"),e.querySelectorAll(".uploadmessage").forEach(e=>{e.textContent="Preparing upload",e.classList.add("upload-message")})}),o.querySelector(".uploadmessage").textContent="Uploading Picture(s)",document.getElementById("progress-wrapper").classList.remove("hidden"),r.send(l)}function L(e){if(e.lengthComputable){let t=e.total,l=100*e.loaded/t;l=Math.round(10*l)/10,document.querySelectorAll("#upload_progress").forEach(e=>e.value=l),document.querySelectorAll("#progress_percentage").forEach(e=>e.textContent=`   ${l}%`),l>=99&&(document.getElementById("progress-wrapper").classList.add("hidden"),o.querySelectorAll(".uploadmessage").forEach(e=>{e.textContent=s>1?"Processing images":"Processing image"}))}}function E(e){let t=e.target;4==t.readyState&&(t.status>=200&&t.status<400?function(e){o.innerHTML=JSON.parse(e).data+o.innerHTML,v(),Main.displayMessage("The files have been processed succesfully.","success",!0),o.querySelector(".image-selector-wrap").classList.remove("hidden");const t=new Event("uploadfinished");o.dispatchEvent(t),async function(){o.querySelectorAll("table tr").forEach(async e=>{A(e)})}()}(t.responseText):(console.error(t.responseText),Main.displayMessage(JSON.parse(t.responseText).error,"error")),document.querySelectorAll(".loadergif_wrapper").forEach(function(e){e.classList.add("hidden")}),o.querySelector('input[type="file"]').value="")}async function A(e){try{if(null==e.querySelector(".title"))return;let t=e.querySelector(".title").value,l=e.querySelector(".author").value.trim(),r="https://openlibrary.org/search.json?q="+encodeURIComponent(`title:${t}`);""!=l&&(r+=encodeURIComponent(` author:${l}`)+"&limit=1"),r+="&fields=key,title,author_name,subtitle,alternative_subtitle,cover_i,language,number_of_pages_median,first_publish_year,description,subjects";const a=await fetch(r),n=await a.json();let o=n.docs[0]??[];if(0==o.length&&""==l){let l=`authorlist-${t.replaceAll(" ","_").replaceAll("'","")}`;e.querySelectorAll(".author").forEach(e=>e.setAttribute("list",l));let r=`<datalist id='${l}' class='author-selection'>`;n.docs.forEach(e=>{null!=e.author_name&&(r+=`<option value='${e.author_name.join()}'>`)}),r+="</datalist>",e.querySelector(".authors").insertAdjacentHTML("afterEnd",r)}else{let t=o.author_name??[l],r=e.querySelector(".authors.clone_divs_wrapper"),a=r.querySelector(".clone_div");t.forEach(e=>{let t=i(a);t.querySelector(".author").value=e,r.appendChild(t)}),a.remove()}let s=o.cover_i??"";if(""!=s){let t=`https://covers.openlibrary.org/b/id/${s}-S.jpg`,l=`https://covers.openlibrary.org/b/id/${s}-L.jpg`;e.querySelector(".image").innerHTML=`<input type='hidden' name='image' value='${s}'><a href='${l}' target='_blank'><img src='${t}' class='book-image' loading='lazy'></a>`}let c=o.subtitle??"",d=o.first_publish_year??"";d=d[0]??d;let u=o.language??"";u=u[0]??u;let p=o.number_of_pages??o.number_of_pages_median??"",m=`<td><input type='text' name='subtitle' class='subtitle' value='${c}'></td>`;m+=`<td><input type='text' name='series' class='series' value='${o.series??""}'></td>`,m+=`<td><input type='text' name='year' class='year' value='${d}'></td>`,m+=`<td><input type='text' name='language' class='language' value='${u}'></td>`,m+=`<td><input type='text' name='pages' class='pages' value='${p}'></td>`;let f=e.querySelector(".placeholder");null==f?(e.querySelector(".subtitle").value=c,e.querySelector(".series").value=o.series??"",e.querySelector(".year").value=d,e.querySelector(".language").value=u,e.querySelector(".pages").value=p):f.outerHTML=m;let h=e.querySelector(".summary").value;h=null!=o.description&&null!=o.description.value?o.description.value:"";let y=o.key??"";if(""!=y){r=`https://openlibrary.org${y}`,e.querySelector(".url").innerHTML=`\n\t\t\t<input type='hidden' name='url' value='${r}'>\n\t\t\t<a href='${r}' target='_blank'>View on Open Library</a>\n\t\t\t`;const t=await fetch(r+".json"),l=await t.json();h=l.description??"",h=h.value??h,null!=l.subjects&&l.subjects.forEach(t=>{e.querySelectorAll(`.category[data-name="${t}"]`).forEach(e=>e.checked=!0)})}""!=h&&(e.querySelector(".summary").value=h)}catch(e){console.error("Error fetching book data:",e)}}window.addEventListener("online",function(){document.querySelectorAll(".form_submit").forEach(e=>{e.disabled=!1,e.querySelectorAll(".offline").forEach(e=>e.remove())})}),window.addEventListener("offline",function(){document.querySelectorAll(".form_submit").forEach(e=>{e.disabled=!0,null==e.querySelector(".online")&&(e.innerHTML='<div class="online">'+e.innerHTML+"</div>"),e.innerHTML+='<div class="offline">You are offline</div>'})}),document.addEventListener("click",function(t){let r=t.target;if(r.matches(".add")){let e=r.closest(".clone_div"),t=d(e);u(r.closest(".clone_divs_wrapper")),t.querySelectorAll(".wp-editor-area").forEach((t,l)=>{let r=tinymce.get(e.querySelectorAll(".wp-editor-area")[l].id);if(null!=r){let e=r.settings;for(const t in e)console.log(`${t}: ${e[t]}`),"string"==typeof e[t]&&(e[t]=e[t].replace(/(.*)([0-9])/,(e,t,l)=>t+(parseInt(l)+1)));tinymce.init(e)}}),r.remove()}r.matches(".remove")&&p(r),r.matches('.sim-form-wrapper [name="submit_form"]')&&(t.stopPropagation(),async function(e){let t=e.closest("form");t.querySelectorAll(".required:not(hidden) input, .required:not(hidden) textarea, .required:not(hidden) select").forEach(e=>{null!=e.closest("div.nice-select")||"file"==e.type&&null!=e.closest(".file_upload_wrap").querySelector(".documentpreview input")||(e.required=!0)});let l=await FormSubmit.submitForm(e,"forms/save_form_input");l&&(e.closest(".submit_wrapper").querySelector(".loadergif").classList.add("hidden"),Main.displayMessage(l),"true"==t.dataset.reset&&FormSubmit.formReset(t))}(r)),(r.matches(".formbuilder-switch")||r.matches(".formbuilder-switch-back"))&&async function(t){let r,a=t.closest(".sim-form-wrapper"),n=t.outerHTML,o=new FormData;const s=new URL(window.location);t.matches(".formbuilder-switch")?(o.append("formbuilder",!0),s.searchParams.set("formbuilder",!0),r=a.querySelector("form.sim-form-wrapper").dataset.formid):(s.searchParams.delete("formbuilder"),r=a.querySelector('[name="formid"]').value),window.history.pushState({},"",s),o.append("formid",r);let c=Main.showLoader(t,!1,"Requesting form...");a.innerHTML=c.outerHTML;let i=await FormSubmit.fetchRestApi("forms/form_builder",o);i?(a.innerHTML=i.html,function(t,r){e=[];let a=document.createElement("div");a.innerHTML=t.html,e=Array.prototype.slice.call(a.getElementsByTagName("script")),t.js&&(a.innerHTML=t.js,e=[...a.children].concat(e),l(r)),t.css&&(a.innerHTML=t.css,[...a.children].forEach(e=>{document.head.appendChild(e)}))}(i,document)):c.outerHTML=n}(r),(r.matches(".archive-switch-hide")||r.matches(".archive-switch-show"))&&async function(e){const t=new URL(window.location);e.matches(".archive-switch-show")?t.searchParams.set("archived",!0):t.searchParams.delete("archived"),window.history.pushState({},"",t),f(e)}(r),(r.matches(".onlyown-switch-all")||r.matches(".onlyown-switch-on"))&&async function(e){const t=new URL(window.location);e.matches(".onlyown-switch-on")?(t.searchParams.set("onlyown",!0),t.searchParams.delete("all",!0)):(t.searchParams.set("all",!0),t.searchParams.delete("onlyown")),window.history.pushState({},"",t),f(e)}(r)}),document.addEventListener("change",e=>{if(e.target.matches("input[list]")&&e.target.name.includes("[")){let t=e.target.list.querySelector(`[value="${e.target.value}" i]`);if(null!=t){let l=t.dataset.value;null!=l&&m(e.target,l,"",e.target.closest("form"))}}}),console.log("Table.js loaded"),document.addEventListener("click",e=>{let t=e.target;"TH"==t.tagName&&function(e){let t,l,r,a=e.closest("table"),n=!0;var o="asc";for(e.classList.contains("desc")&&(o="desc");n;){n=!1,r=a.rows;for(let a=1;a<r.length-1;a++){if(t=r[a].getElementsByTagName("TD")[e.cellIndex].innerHTML.toLowerCase(),l=r[a+1].getElementsByTagName("TD")[e.cellIndex].innerHTML.toLowerCase(),isNaN(t)||isNaN(l)){let e=new Date(t),r=new Date(l);"Invalid Date"===e||isNaN(e)||70==e.getYear()||"Invalid Date"===r||isNaN(r)||70==r.getYear()||(t=e.getTime(),l=r.getTime())}else t=parseFloat(t),l=parseFloat(l);("asc"==o&&t>l||"desc"==o&&l>t)&&(r[a].parentNode.insertBefore(r[a+1],r[a]),n=!0)}}"asc"==o?(e.classList.add("desc"),e.classList.replace("asc","desc")):e.classList.replace("desc","asc")}(t);let l=t.closest("td");t.matches("td.edit")?(e.stopPropagation(),y(t)):null!=l&&l.matches("td.edit")&&"INPUT"!=t.tagName&&"A"!=t.tagName&&"TEXTAREA"!=t.tagName&&!t.closest(".nice-select")?(e.stopPropagation(),y(t.closest("td"))):t.matches(".show.fullscreenbutton")?w(t):t.matches(".close.fullscreenbutton")&&function(e){let t=100;e.textContent="Show full screen",e.classList.replace("close","show"),null!=window.lastY&&(t=window.lastY),window.scrollTo(0,t),console.log("scrolling"),document.querySelector("body").style.overflow="unset",document.querySelector("header").style.zIndex="99999",e.closest(".table-wrapper").classList.remove("fullscreen"),b();let l=new URL(window.location);l.searchParams.delete("fullscreen"),window.history.pushState({},"",l),document.exitFullscreen(),S()}(t)}),document.addEventListener("DOMContentLoaded",function(){b(),window.addEventListener("resize",b),v();let e=new URLSearchParams(window.location.search).get("fullscreen");if(null!=e)try{w(document.querySelector(`table[data-formid="${e}"]`).closest(".table-wrapper").querySelector(".fullscreenbutton"))}catch{console.error(`table[data-formid="${e}"]`)}S()}),console.log("library.js loaded"),document.addEventListener("DOMContentLoaded",function(){}),document.addEventListener("click",e=>{let t=e.target;null!=o&&t.matches(".add-books")?o.querySelectorAll(".image-preview, .book.table-wrapper").forEach(e=>e.remove()):t.matches(".add-book")?async function(e){let t=e.closest("td"),l=e.closest("tr"),r=new FormData;l.querySelectorAll("input, textarea").forEach(e=>r.append(e.name,e.value)),l.querySelectorAll("td > img").forEach(e=>r.append("image",e.src)),e.classList.add("hidden"),t.querySelector(".loadergif_wrapper").classList.remove("hidden");let a=await FormSubmit.fetchRestApi("library/add_book",r);a?(t.innerHTML=a,Main.displayMessage(a.message)):(e.classList.remove("hidden"),t.querySelector(".loadergif_wrapper").classList.add("hidden"),e.remove())}(t):t.matches(".delete-book")&&t.closest("tr").remove()}),document.addEventListener("change",async e=>{let t=e.target;if("image-selector"==t.name&&t.files.length>0){o=t.closest(".file_upload_wrap");let e=o.querySelector(".book-location");if(!e.reportValidity())return;e=e.value,document.querySelectorAll(".book-table-wrapper").forEach(e=>e.remove()),t.closest(".image-selector-wrap").classList.add("hidden"),o.querySelectorAll(".image-preview").forEach(e=>e.remove());for(const l of t.files){let r=new FileReader;r.onload=function(e){let t=document.createElement("div");t.classList.add("image-preview");let l=document.createElement("img");l.src=e.target.result,l.classList.add("book-image"),l.style.maxHeight="100px",l.style.padding="0",t.appendChild(l),o.prepend(t)},r.readAsDataURL(l),q(t,e)}}else if(t.matches(".title, .author")){let e=t.closest("tr");await A(e)}})})();
//# sourceMappingURL=library.min.js.map