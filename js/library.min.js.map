{"version":3,"file":"library.min.js","mappings":"mBAAO,IAAIA,EAEAC,EAAqB,SAAUC,GAEhB,oBAAb,UACLC,QAAQC,SAGRC,SAASC,iBAAiB,kCAAkCC,QAAQC,IAChEC,OAAOC,QAAQC,YAAY,gBAAgB,EAAOH,EAAGI,OAK7DH,OAAOJ,SAASQ,cAAc,IAAIC,MAAM,mBAAoB,CACxDC,SAAS,EACTC,YAAY,KAIhBX,SAASC,iBAAiB,qBAAqBC,QAAQC,GAAIA,EAAGS,iBAAiB,QAASC,IACpF,IAAIC,EAAUX,EAAGY,QAAQ,mBAAmBC,cAAc,mBACtDC,EAAWd,EAAGY,QAAQ,mBAAmBC,cAAc,cAC3DF,EAAKI,MAAMC,WAAW,QACnBN,EAAGO,OAAOC,QAAQ,iBAClBJ,EAAMC,MAAMI,QAAQ,QACnBR,EAAKI,MAAMI,QAAQ,SAEnBL,EAAMC,MAAMI,QAAQ,OACpBR,EAAKI,MAAMI,QAAQ,YAK9BtB,SAASC,iBAAiB,qCAAqCC,QAAQ,SAASqB,GACzEC,KAAKC,iBAAiBF,EAC7B,GAEG,MAAMV,EAAK,IAAIJ,MAAM,iBACxBZ,EAASW,cAAcK,EACxB,EAwBWa,EAAa,SAAU7B,GAC9B,GAAe8B,MAAZ9B,EACC,OAGiB,GAAlBF,EAAQiC,QACPhC,EAAmBC,GAEvB,IAAIM,EAAKR,EAAQkC,QAEjB,GAASF,MAANxB,EAMH,GAAiB,UAAdA,EAAG2B,SAAyD,MAAlC9B,SAAS+B,eAAe5B,EAAGI,IAAY,CAChE,IAAIyB,EAAIhC,SAASiC,cAAc,UAEjB,IAAX9B,EAAG+B,KACFF,EAAEE,KAAO,kBAETF,EAAEE,KAAO/B,EAAG+B,KAGH,IAAV/B,EAAGgC,IACFH,EAAEG,IAAOhC,EAAGgC,IAEZH,EAAEI,UAAYjC,EAAGiC,UAGrBJ,EAAEzB,GAAKJ,EAAGI,GAEV,IACIP,SAASqC,KAAKC,YAAYN,EAC9B,CAAC,MAAOO,GACJC,QAAQD,MAAMA,EAClB,CAEG5C,EAAQiC,OAAS,EACH,IAAVzB,EAAGgC,IACFH,EAAEpB,iBAAiB,OAAQc,EAAWe,KAAM,KAAM5C,IAElD6B,EAAW7B,GAGF,IAAVM,EAAGgC,IACFH,EAAEpB,iBAAiB,OAAQhB,EAAmB6C,KAAM,KAAM5C,IAE1DD,EAAmBC,EAG/B,MAASF,EAAQiC,OAAS,EAEtBF,EAAW7B,GAEXD,EAAmBC,QA7CnBD,EAAmBC,EA+C3B,ECtDO,SAAS6C,EAAcC,EAASC,EAAMC,GAAc,EAAMC,EAAa,KAAMC,GAAU,GAE7F,IAAI5C,EAAO,GACP6C,EAAQ,GACRC,EAAU,GACVC,EAAW,GAwBf,OArBGP,aAAmBQ,SACrBhD,EAAOwC,EAEU,SAAdxC,EAAG2B,SAAoC,YAAd3B,EAAG2B,SAAuC,UAAd3B,EAAG2B,SAA8D,MAAvC3B,EAAGY,QAAQ,2BAC5FZ,EAAKA,EAAGa,cAAc,4BAEd,MAANb,IACFA,EAAOwC,GAERK,EAAQ7C,EAAG6C,MAEHL,EAAQS,MAAM,WACtBF,EAAW,QAAQP,KACnBxC,EAAOyC,EAAK5B,cAAckC,GAC1BF,EAAQ7C,EAAG6C,OAEXA,EAAQL,EACRO,EAAW,UAAUF,QACrB7C,EAAOyC,EAAK5B,cAAckC,IAGlB,MAAN/C,GACFqC,QAAQa,QACRb,QAAQc,IAAI,iCAAiCN,GAEtCC,IAGM,SAAX9C,EAAG+B,KACLe,EAzGF,SAAuBL,EAAMM,GAC5B,IAAI/C,EAAKyC,EAAK5B,cAAc,GAAGkC,aAG/B,OAAS,MAAN/C,EAEK,GAGDA,EAAG8C,KACX,CA+FUM,CAAcX,EAAMM,GACT,YAAX/C,EAAG+B,KACXe,EA/FF,SAA0BL,EAAMM,EAAUJ,EAAcH,GACvD,IAAIM,EAAS,GACTO,EAAW,GAGf,MAAmB,YAAhBb,EAAQT,MAAsC,MAAhBY,EAC7BH,EAAQc,QACHd,EAAQM,MAGT,IAIW,MAAhBH,GACFU,EAAWZ,EAAK5B,cAAc,GAAGkC,YAAmBJ,iBACrC,MAAZU,IACFP,EAAQH,KAITU,EAAWZ,EAAK3C,iBAAiB,GAAGiD,aACpCD,EAAS,GACTO,EAAStD,QAAQC,IAChB8C,EAAMS,KAAKvD,EAAG8C,UAQTA,EACR,CA8DUU,CAAiBf,EAAMM,EAAUJ,EAAcH,GACR,MAAvCxC,EAAGY,QAAQ,0BAAwDY,MAApBxB,EAAGyD,QAAQX,MAElEA,EAAQ9C,EAAGyD,QAAQX,MACA,MAAX9C,EAAG0D,MAA4B,IAAZ1D,EAAG8C,OAAeJ,EAC7CI,EAzDK,SAA0B9C,GAChC,IAAI8C,EAAS,GACTa,EAAa3D,EAAG0D,KAAK7C,cAAc,WAAWb,EAAG8C,aAQrD,OALCA,EADe,MAAba,EACO3D,EAAG8C,MAEJa,EAAUF,QAAQX,MAGpBA,CACR,CA8CWc,CAAiB5D,GACPwB,MAAXxB,EAAG6C,MAAqB7C,EAAG6C,KAAKgB,SAAS,MACjDf,EAnEF,SAAuBL,EAAMzC,GAC5B,IAAI8C,EAAQ,GAIZ,OAFAL,EAAK3C,iBAAiB,UAAUE,EAAG6C,UAAU9C,QAAQ+D,GAAQhB,EAAMS,KAAKO,EAAKhB,QAEtEA,CACR,CA6DWiB,CAActB,EAAMzC,GACT,MAAZA,EAAG8C,OAA6B,aAAZ9C,EAAG8C,QAC/BA,EAAQ9C,EAAG8C,OAGTF,EACKE,EAAMkB,cAEPlB,EACR,CC7FO,SAASmB,EAAoBjE,GACnCkE,MAAMC,KAAKnE,EAAGoE,SAASrE,QAAQ,SAASsE,GACvCA,EAAOC,iBAAkB,CAC1B,EACD,CA9BAjC,QAAQc,IAAI,sBAgCZ,IClCIoB,ECiCAC,EAAgBC,EFChBC,EAAkB,GAef,SAASC,EAAUC,EAAcC,GAAM,IAd9C,SAA2BD,GAEJ,oBAAb,SACRA,EAAa9E,iBAAiB,mBAAmBC,QAAQC,IACxD,IAAI8E,EAAKnF,QAAQoF,IAAI/E,EAAGI,IACf,MAAN0E,IACFJ,EAAgB1E,EAAGI,IAAM0E,EAAGE,SAC5BF,EAAGG,OACHH,EAAGlF,WAIP,CAGCsF,CAAkBN,GAGlB,IAAIO,EAAUP,EAAaD,WAAU,GAoCrC,OAjCAQ,EAAQrF,iBAAiB,gBAAgBC,QAAQqF,GAAYA,EAASxF,UAGtEgF,EAAa9E,iBAAiB,mBAAmBC,QAAQC,IAC3BwB,MAA1BkD,EAAgB1E,EAAGI,KACrBT,QAAQ0F,KAAKX,EAAgB1E,EAAGI,OAK/ByE,GACFM,EAAQrF,iBAAiB,yBAAyBC,QAAQuF,IACxC,YAAdA,EAAMvD,MAAoC,SAAduD,EAAMvD,KACpCuD,EAAMhC,SAAU,EACM,UAAdgC,EAAMvD,OACduD,EAAMxC,MAAQ,IAIE,cAAdwC,EAAMvD,MAERkC,EAAoBqB,KAKvBH,EAAQrF,iBAAiB,UAAUC,QAAQqB,IAE1C6C,EAAoB7C,GAEpBC,KAAKC,iBAAiBF,KAGhB+D,CACR,CAEO,SAASI,EAAcX,GAC7B,IAAIO,EAAUR,EAAUC,GAGxBO,EAAQrF,iBAAiB,iBAAiBC,QAAQ,SAASyF,GAC1DA,EAAa/B,QAAQgC,MAAQC,MAC9B,GAGAP,EAAQrF,iBAAiB,oBAAoBC,QAAQ,SAAS4F,GAC7DA,EAAW1D,UAAY,EACxB,GAGA,IAAI2D,EAAI,EAiBR,GAhBAT,EAAQrF,iBAAiB,UAAUC,QAAQqB,IAE1C,IAAIyE,EAAcjB,EAAakB,qBAAqB,UAAUF,GAAGG,cAG/BvE,MAA/BJ,EAAOgD,QAAQyB,KACjBzE,EAAOgD,QAAQyB,GAAa9E,MAAMI,QAAU,QAI7CE,KAAKC,iBAAiBF,GAEtBwE,MAI2C,MAAzChB,EAAa/D,cAAc,YAA0D,MAApCsE,EAAQtE,cAAc,WAAmB,CAC3F,IAAImF,EAAO,0EAGZpB,EAAa/D,cAAc,kBAAkBoF,mBAAmB,YAAaD,GAG7Eb,EAAQtE,cAAc,kBAAkBoF,mBAAmB,YAAaD,EACzE,CAGA,GAAGpB,EAAa1D,QAAQ,eAAe,CAEtC0D,EAAasB,UAAUC,IAAI,UAG3B,IAAIC,EAAYxB,EAAahE,QAAQ,uBAAuBC,cAAc,mBACtEwF,EAAY1B,EAAUyB,GAG1BA,EAAUF,UAAUtG,OAAO,UAG3BwG,EAAUE,WAAWC,aAAaF,EAAWD,EAAUI,YACxD,CAKA,OAFA5B,EAAa0B,WAAWC,aAAapB,EAASP,EAAa4B,aAEpDrB,CACR,CAEO,SAASsB,EAAaC,GAK5B,SAASC,EAAcC,EAAOnB,GAId,IAAZmB,EAAMxG,KACRwG,EAAMxG,GAAKwG,EAAMxG,GAAGyG,QAAQ,oBAAqBpB,IAIjC,UAAdmB,EAAM7E,MAAyC,IAArB6E,EAAME,cAClCF,EAAME,YAAgBF,EAAME,YAAYD,QAAQ,oBAAqBpB,EAAQ,GAE7EmB,EAAMnD,QAAQxC,OAAS2F,EAAMnD,QAAQxC,OAAO4F,QAAQ,oBAAqBpB,IAI/C,MAAxBmB,EAAMnD,QAAQsD,QAChBH,EAAMnD,QAAQsD,MAAQtB,GAIvBmB,EAAM9G,iBAAiB,+BAA+BC,QAAQC,IAC7DA,EAAG8G,YAAc9G,EAAG8G,YAAYD,QAAQ,oBAAqBpB,EAAQ,KAStEmB,EAAM9G,iBAAiB,yBAAyBC,QAAQuF,IAEnDA,EAAMY,UAAUc,SAAS,wBAEb,IAAZ1B,EAAMlF,IAAwBoB,MAAZ8D,EAAMlF,KAC1BkF,EAAMlF,GAAKkF,EAAMlF,GAAGyG,QAAQ,oBAAqBpB,IAGjC,IAAdH,EAAMzC,MAA4BrB,MAAd8D,EAAMzC,OAC5ByC,EAAMzC,KAAOyC,EAAMzC,KAAKgE,QAAQ,oBAAqBpB,IAIrC,UAAdH,EAAMvD,OACRuD,EAAMxC,MAAQwC,EAAMxC,MAAM+D,QAAQ,oBAAqBpB,MAI3D,CArDAiB,EAAQ5G,iBAAiB,uBAAuBC,QAAQ4G,GAExDD,EAAQ5G,iBAAiB,qBAAqBC,QAAQ4G,EAoDvD,CAEO,SAASM,EAAWhG,GAC1B,IAAIiG,EAASjG,EAAOL,QAAQ,cACxB0F,EAAcY,EAAKtG,QAAQ,uBAC3BuG,EAAeb,EAAWxG,iBAAiB,cAG/C,GAAGqH,EAAaA,EAAa1F,OAAO,IAAMyF,EAAK,CAC9C,IAAIE,EAAaF,EAAKrG,cAAc,QAGhCwG,EAAOH,EAAKI,uBACgC,MAA7CD,EAAKxG,cAAc,wBACrBwG,EAAKxG,cAAc,kBAAkBsB,YAAYiF,EAEnD,CAGAF,EAAKtH,SAGkD,GAApD0G,EAAWxG,iBAAiB,cAAc2B,QACxB6E,EAAWzF,cAAc,WAC/BjB,SAGf6G,EAAaH,EACd,CA8LO,SAASiB,EAAiBxE,EAAUD,EAAO0E,EAAa/E,EAAMgF,EAAS,GAAIC,GAAW,GAC5F,GAAYlG,MAATsB,EACF,OAGD,IAAID,EAAQ,GACR5B,EAAU,GAEd,GAAG8B,aAAoBC,QACtB/B,EAAU8B,EACVF,EAAQ5B,EAAO4B,KAEdE,EADe,IAAb9B,EAAOb,GACE,WAAWa,EAAO4B,WAElB,QAAQ5B,EAAOb,UAGvB,CACJa,EAAWwB,EAAK5B,cAAckC,GAE9B,IACCF,EAAQ5B,EAAO4B,IAChB,CAAC,MACAR,QAAQc,IAAIlC,EACb,CACD,CAIA,GAFesB,EAActB,EAAQwB,GAAM,EAAOK,IAEnCA,EACd,OAID,GAAa,MAAV7B,EAAe,CACjB,IAAI0G,EAAWlF,EAAK3C,iBAAiB,sBAAsB+C,SAC3D,GAAsB,IAAnB8E,EAAQlG,OACV,OAC0B,GAAlBkG,EAAQlG,QAChBR,EAAS0G,EAAQ,GACjBA,EAAU,KAEV1G,EAAS0G,EAAQ,GAEjBA,EAAQ5H,QAAQ,CAACC,EAAIyF,KACR,GAATA,EACF8B,EAAiBvH,EAAI,GAAI,GAAIyC,GAE7BwE,EAAWjH,KAIf,CAGA,GAAe,IAAZyH,EAEF,GAAI,oBAAoBG,KAAK9E,GAAO,CACnC,IAAI+E,EAAO,IAAIC,KAAKhF,GACpB+E,EAAKE,QAAQF,EAAKG,UAAYC,SAASR,IACvC3E,EAAQ+E,EAAKK,cAAcC,MAAM,KAAK,EACvC,MACCrF,GAAgBmF,SAASR,GAI3B,GAAkB,SAAfxG,EAAOc,MAAkC,YAAfd,EAAOc,KAEnC,GAAY,IAATe,EACa,IAAZC,GACFN,EAAK3C,iBAAiBiD,GAAUhD,QAAQC,GAAIA,EAAGsD,SAAQ,QAIxD,GAAGrC,EAAO6B,MAAMkB,eAAiBlB,EAAMkB,cACtC/C,EAAOqC,SAAU,MACb,CAEJ,IAAIqE,EAAUlF,EAAK3C,iBAAiB,UAAU+C,SAC9C,IAAK,MAAMuF,KAAWT,EAClBS,EAAQtF,MAAMkB,eAAiBlB,EAAMkB,gBACvCoE,EAAQ9E,SAAU,EAGrB,MAGI,GAAkB,QAAfrC,EAAOc,MAIf,GAHAd,EAAO6B,MAAQA,GAGV,oBAAoB8E,KAAK9E,GAAO,CACpC,IAAIuF,EAAW,GAOf,GAN8B,GAA3BvF,EAAMqF,MAAM,KAAK1G,OACnB4G,EAAWvF,EAAMqF,MAAM,KACY,GAA3BrF,EAAMqF,MAAM,KAAK1G,SACzB4G,EAAWvF,EAAMqF,MAAM,MAGT,IAAZE,EAAe,CACjB,IAAIC,EACAC,EACAC,EACJH,EAAStI,QAAQ0I,IACA,GAAbA,EAAGhH,OACL6G,EAAOG,EACc,GAAbA,EAAGhH,SACRgH,EAAK,GACPD,EAAMC,EAGMjH,MAAT+G,EACFA,EAAQE,EAERD,EAAMC,KAMAjH,MAAPgH,GAA6BhH,MAAT+G,GAA8B/G,MAAR8G,IAC5CrH,EAAO6B,MAAQ,GAAGwF,KAAQC,KAASC,IAErC,CACD,OACK,GAAkB,MAAfvH,EAAOyC,KAAa,CAC5B,IAAIgF,EAAiBzH,EAAOyC,KAAK7C,cAAc,gBAAgBiC,SAG/D,GAAqB,MAAlB4F,EAEF,GAAmC,MAAhCzH,EAAOL,QAAQ,cAAsB,CAIvC,IAAIgG,EAFJ3F,EAAOL,QAAQ,uBAAuBd,iBAAiB,cAAcC,QAAQC,GAAIA,EAAGkG,UAAUC,IAAI,iBAGlGuC,EAAe5F,MAAMqF,MAAM,KAAKpI,QAAQ4I,IACvC/B,EAAQrB,EAActE,EAAOL,QAAQ,eAErCgG,EAAMV,UAAUtG,OAAO,gBAEvB2H,EAAiBX,EAAM/F,cAAcI,EAAOU,SAAUgH,EAAK,GAAIlG,EAAM,IAAI,KAG1EgE,EAAaxF,EAAOL,QAAQ,wBAG5BK,EAAOL,QAAQ,uBAAuBd,iBAAiB,iBAAiBC,QAAQC,GAAIA,EAAGJ,SACxF,MACCqB,EAAO6B,MAAQ4F,EAAe5F,WAI/B7B,EAAO6B,MADC4E,EACO5E,EAGA,EAEjB,MACC7B,EAAO6B,MAAQA,EAIhB,IAAI8F,EAAM,IAAItI,MAAM,SAEpBW,EAAOZ,cAAcuI,GAGI,mBAAfpB,GACTA,EAAYvG,EAEd,CAuGA4H,eAAeC,EAAsB7H,GACpC,IAAIyF,EAAWzF,EAAOL,QAAQ,uBAC1BmI,EAAU9H,EAAO+H,UAEjBC,EAAY,IAAIC,SAChBC,EAAUzC,EAAQ7F,cAAc,8BAA8B4C,QAAQ2F,OACtEC,EAAc3C,EAAQ7F,cAAc,8BAA8B4C,QAAQ6F,YAE9EL,EAASM,OAAO,SAAUJ,GAC1BF,EAASM,OAAO,eAAgBF,GAEhC,MAAMG,EAAQ,IAAIC,IAAIxJ,OAAOyJ,UAC1BF,EAAIG,aAAa5E,IAAI,YACvBkE,EAASM,OAAO,WAAW,GAGzBC,EAAIG,aAAa5E,IAAI,QACvBkE,EAASM,OAAO,OAAO,GAGrBC,EAAIG,aAAa5E,IAAI,aACvBkE,EAASM,OAAO,YAAY,GAG7B,IAAIK,EAASvI,KAAKwI,WAAW5I,GAAQ,EAAO,8BAC5CyF,EAAQzE,UAAY2H,EAAOZ,UAE3B,IAAIc,QAAiBC,WAAWC,aAAa,0BAA2Bf,GAErEa,EACFpD,EAAQzE,UAAY6H,EAEpBF,EAAOZ,UAAYD,CAErB,CC5tBA,SAASkB,EAAeC,GACU,MAA9BA,EAAMjJ,OAAOL,QAAQ,OAAkBsJ,EAAMjJ,OAAOL,QAAQ,MAAMM,QAAQ,cAC5EgJ,EAAMC,kBAGNtK,SAASuK,oBAAoB,QAASH,GACtCI,EAAaH,EAAOrK,SAASgB,cAAc,uDAE7C,CAwDA,SAASyJ,EAAOrJ,GACfA,EAAOL,QAAQ,MAAMsF,UAAUC,IAAI,WAInC5B,EAAWtD,EAAO6F,YACF,mBAAZvC,GAA6C,KAAZA,IACpCA,EAAW,IAGZtD,EAAOgB,UAAY,6BAA6BsC,MAhEjD,SAAgCgG,GAC/B,IAAIC,EAASD,EAAKzK,iBAAiB,yBAEnC0K,EAAOzK,QAAQ0K,IAEdlG,EAAS4D,MAAM,KAAKpI,QAAQ4I,IACN,YAAlB8B,EAAU1I,MAAwC,SAAlB0I,EAAU1I,KACzC0I,EAAU3H,OAAS6F,EAAI+B,SACzBD,EAAUnH,SAAU,GAEK,UAAlBmH,EAAU1I,KAClB0I,EAAU5J,cAAc,iBAAiB8H,EAAI,MAAMgC,UAAW,EAE9DF,EAAU3H,MAAQyB,IAIC,cAAlBkG,EAAU1I,MAAiDP,MAAzBiJ,EAAUG,aAC9CvJ,KAAKC,iBAAiBmJ,GAIvBA,EAAUhK,iBAAiB,QAAS,SAASyJ,GACtB,KAAlBA,EAAMW,SACTR,EAAaH,EAEf,GAGArK,SAASY,iBAAiB,QAASwJ,GAEd,YAAlBQ,EAAU1I,MAAuC,GAAjByI,EAAO/I,SACpB,QAAlBgJ,EAAU1I,KACZ0I,EAAUhK,iBAAiB,OAAQ,SAASyJ,GAElB,IAAtBA,EAAMjJ,OAAO6B,OACfuH,EAAaH,EAEf,GAEAO,EAAUhK,iBAAiB,SAAU,SAASyJ,GAEpB,IAAtBA,EAAMjJ,OAAO6B,OACfuH,EAAaH,EAEf,GAGDO,EAAUK,UAGb,CAeCC,CAAuB9J,EACxB,CAGA4H,eAAewB,EAAaH,EAAOjJ,QACb,IAAZ,IACRA,EAASiJ,EAAMjJ,QAGhB,IAAIsJ,EAAUtJ,EAAOL,QAAQ,MACzBkC,EAAUP,EAActB,EAAQsJ,GAAM,GACtCS,EAAU/J,EAAOL,QAAQ,SAG7B,GAAIkC,GAASyB,EAAS,CAErB,IAAI0E,EAAW,IAAIC,SACnBD,EAASM,OAAO,QAAS0B,KAAKC,UAAUpI,IAExC,IAAK,IAAIqI,KAAOZ,EAAK9G,QACpBwF,EAASM,OAAO4B,EAAKZ,EAAK9G,QAAQ0H,IAEnC,IAAK,IAAIA,KAAOlK,EAAOL,QAAQ,MAAM6C,QACpCwF,EAASM,OAAO4B,EAAKlK,EAAOL,QAAQ,MAAM6C,QAAQ0H,IAGnD9J,KAAKwI,WAAWU,EAAKa,kBAEArB,WAAWC,aAAagB,EAAMvH,QAAQ+F,IAAKP,KAG/DsB,EAAKtI,UAAYa,EAKnB,MACCT,QAAQc,IAAIL,GACZ7B,EAAOL,QAAQ,MAAMqB,UAAYsC,EAGlCgG,EAAKrE,UAAUtG,OAAO,UACvB,CA6DO,SAASyL,IAEfxL,SAASC,iBAAiB,cAAcC,QAAQ,SAASiL,GAExD,IAAIM,EAAW,GACfN,EAAMlL,iBAAiB,YAAYC,QAAQ,CAACC,EAAGyF,KACpB,MAAvBzF,EAAGyD,QAAQ8H,SACbD,EAAS7F,GAASzF,EAAGyD,QAAQ8H,SAE7BD,EAAS7F,GAASzF,EAAG8G,cAKvBkE,EAAMlL,iBAAiB,YAAYC,QAAUyL,IACxCA,EAAGC,aAAa,UAAsCjK,MAA1B8J,EAASE,EAAGE,YAE3CF,EAAGG,aAAa,QAASL,EAASE,EAAGE,YAGjB,KAAlBF,EAAG1E,aAAwC,IAAlB0E,EAAG1E,aAC9B0E,EAAGtF,UAAUC,IAAI,kBAGpB,EACD,CAEA0C,eAAe+C,EAAe3K,GAC7BA,EAAO6F,YAAc,oBACrB7F,EAAOiF,UAAUW,QAAQ,OAAQ,SAEjC,IAAIgF,EAAS5K,EAAOL,QAAQ,kBAG5BX,OAAO6L,MAAQ7L,OAAO8L,YAEtB9L,OAAO+L,SAAS,EAAE,GAGlBnM,SAASgB,cAAc,QAAQE,MAAMkL,SAAW,SAEhDpM,SAASgB,cAAc,UAAUE,MAAMmL,OAAS,QAEhDL,EAAO3F,UAAUC,IAAI,cAErB0F,EAAO9K,MAAMoL,WAAa,MAE1B,IAAI3C,EAAM,IAAIC,IAAIxJ,OAAOyJ,UAEzBF,EAAIG,aAAayC,IAAI,aAAcP,EAAOhL,cAAc,SAAS4C,QAAQ2F,QAEzEnJ,OAAOoM,QAAQC,UAAU,CAAC,EAAG,GAAI9C,GAEjC+C,IAEAV,EAAOW,oBAAoBC,MAAOC,MAGnC,CAmCA,SAASH,IACR,IAIII,EAAcC,EAHdC,EADY,IAAIC,gBAAgB7M,OAAOyJ,SAASqD,QACzBhI,IAAI,cAI/BlF,SAASC,iBAAiB,cAAcC,QAASiL,IAChD,IAAItE,EAAUsE,EAAMpK,QAAQ,kBAC5B,GAAc,MAAX8F,EACF,OAGgB,MAAdmG,GACFD,EAAe,EACflG,EAAQ5G,iBAAiB,eAAeC,QAAQC,GAAK4M,EAAe5M,EAAGgN,eAEvEJ,EAAe/M,SAASgB,cAAc,UAAUmM,aAGjDL,EAAe,EACfjG,EAAQ5G,iBAAiB,qBAAqBC,QAAQC,GAAK2M,EAAe3M,EAAGgN,cAE7E,IAAIC,EAAKL,EAAeD,EAAe,GACvC3B,EAAMjK,MAAMmM,UAAY,gBAAgBD,QAE1C,CAEO,SAASE,IAEftN,SAASC,iBAAiB,kBAAkBC,QAAQ2G,IACnD,IAAI0G,EAAU,GACVC,EAAQ,EAERrC,EAAQtE,EAAQ7F,cAAc,SAClC,GAAY,MAATmK,EACF,OAED,IAAIsC,EAAQtC,EAAMuC,YAClB,GAAY,GAATD,EAAH,CAKA,GAAGrN,OAAOuN,WAAa,IACtBJ,EAAS1G,EAAQ+G,wBAAwBC,MACrC,CACJ,IAAIC,EAAO1N,OAAOuN,WAAaF,EAG3BA,EAAMrN,OAAOuN,WAAc,GACoB,MAA/C3N,SAASgB,cAAc,uBACzB8M,EAA4B,GAApB1N,OAAOuN,WAAoBF,IAGpCzN,SAAS+B,eAAe,WAAWb,MAAMmL,OAAS,EAGlDrM,SAASC,iBAAiB,kBAAkBC,QAAQC,GAAIA,EAAGe,MAAMmL,OAAS,IAK1EmB,EADEM,EAAO,GACF,GAGAA,EAAK,EAIkB,IAA5BjH,EAAQ3F,MAAMoL,aAChBzF,EAAQ3F,MAAMoL,WAAa,QAI5BiB,EAASnF,SAASvB,EAAQ+G,wBAAwBC,GAAGL,CACtD,CAEA3G,EAAQ3F,MAAMoL,WAAa,IAAIiB,KArC/B,GAuCF,CCjUAvE,eAAe,EAAW5H,EAAQyI,GAGjC,GAFAjF,EAAexD,EAAO2M,MAAMnM,OAExBgD,EAAa,EAChB,OAID,IAAIwE,EAAW,IAAIC,SAGnBD,EAASM,OAAO,SAAU,0BAE1BN,EAASM,OAAO,WAAYG,GAG5B,IAAK,IAAIjE,EAAQ,EAAGA,EAAQhB,EAAYgB,IAAS,CAChD,IAAIoI,EAAO5M,EAAO2M,MAAMnI,GACxBwD,EAASM,OAAO,UAAWsE,EAC5B,CAGA,IAAIC,EAAU,IAAIC,eAGlBD,EAAQE,mBAAqBC,EAG7BH,EAAQI,OAAOzN,iBAAiB,WAAY0N,GAAoB,GAEhEL,EAAQM,KAAK,OAAQC,IAAIC,SAAS,GAGlC9J,EAAe1E,iBAAiB,sBAAsBC,QAAQ6J,IAC7DA,EAAO1D,UAAUtG,OAAO,UACxBgK,EAAO9J,iBAAiB,kBAAkBC,QAAQC,IACjDA,EAAG8G,YAAc,mBACjB9G,EAAGkG,UAAUC,IAAI,sBAKnB3B,EAAe3D,cAAc,kBAAkBiG,YAAc,uBAC7DjH,SAAS+B,eAAe,oBAAoBsE,UAAUtG,OAAO,UAE7DkO,EAAQS,KAAKtF,EACd,CAEA,SAASkF,EAAmBK,GAC3B,GAAGA,EAAEC,iBAAiB,CACrB,IAAIC,EAAQF,EAAEG,MAGVC,EAAyB,IAFdJ,EAAEK,OAEiBH,EAClCE,EAAeE,KAAKC,MAAiB,GAAXH,GAAe,GAEzC/O,SAASC,iBAAiB,oBAAoBC,QAAQC,GAAIA,EAAG8C,MAAQ8L,GACrE/O,SAASC,iBAAiB,wBAAwBC,QAAQC,GAAIA,EAAG8G,YAAc,MAAM8H,MAElFA,GAAc,KAEhB/O,SAAS+B,eAAe,oBAAoBsE,UAAUC,IAAI,UAG1D3B,EAAe1E,iBAAiB,kBAAkBC,QAAQC,IAGxDA,EAAG8G,YADArC,EAAa,EACC,oBAEA,qBAIrB,CACD,CAEA,SAASwJ,EAAkBO,GAC1B,IAAIV,EAAUU,EAAEvN,OAGS,GAAtB6M,EAAQkB,aAENlB,EAAQmB,QAAU,KAAOnB,EAAQmB,OAAS,IAoBhDpG,eAAgCqG,GAC/B1K,EAAevC,UAAYgJ,KAAKkE,MAAMD,GAAQE,KAAO5K,EAAevC,UAEpEZ,KAAKgO,eAAe,6CAA8C,WAAW,GAE7E7K,EAAe3D,cAAc,wBAAwBqF,UAAUtG,OAAO,UAItE,MAAMsK,EAAQ,IAAI5J,MAAM,kBACxBkE,EAAenE,cAAc6J,SAQ9BrB,iBACC,IAAIyG,EAAe,GAEnB9K,EAAe1E,iBAAiB,YAAYC,QAAQ8I,MAAO0G,IAC1DD,EAAa/L,KAAKiM,EAAcD,YAG3BE,QAAQC,IAAIJ,EACnB,CAdOK,GAGNtE,GACD,CAnCGuE,CAAiB9B,EAAQ+B,eAGzBxN,QAAQD,MAAM0L,EAAQ+B,cACtBxO,KAAKgO,eAAepE,KAAKkE,MAAMrB,EAAQ+B,cAAczN,MAAM,UAI5DvC,SAASC,iBAAiB,sBAAsBC,QAC/C,SAAS6J,GACRA,EAAO1D,UAAUC,IAAI,SACtB,GAID3B,EAAe3D,cAAc,sBAAsBiC,MAAQ,GAE7D,CA8BA+F,eAAe2G,EAAcD,GAC5B,IAEC,GAAiC,MAA9BA,EAAG1O,cAAc,UACnB,OAGD,IAAIiP,EAAQP,EAAG1O,cAAc,UAAUiC,MAGnCiN,EAASR,EAAG1O,cAAc,WAAWiC,MAAM4H,OAC3ClB,EAAU,yCAAyCwG,mBAAmB,SAASF,KACtE,IAAVC,IACFvG,GAAOwG,mBAAmB,WAAWD,KAAU,YAEhDvG,GAAO,8IAEP,MAAMM,QAAkBmG,MAAMzG,GACxB4F,QAAetF,EAASoG,OAC9B,IAAIC,EAAcf,EAAW,KAAE,IAAM,GAGrC,GAAsB,GAAnBe,EAAS1O,QAAyB,IAAVsO,EAAa,CACvC,IAAI3P,EAAK,cAAc0P,EAAMM,WAAW,IAAK,KAAKA,WAAW,IAAK,MAClEb,EAAGzP,iBAAiB,WAAWC,QAAQC,GAAMA,EAAG2L,aAAa,OAAQvL,IAErE,IAAIsD,EAAO,iBAAiBtD,+BAE5BgP,EAAW,KAAErP,QAASsQ,IACI7O,MAAtB6O,EAAiB,cACnB3M,GAAQ,kBAAkB2M,EAAiB,YAAEC,cAI/C5M,GAAQ,cACR6L,EAAG1O,cAAc,YAAYoF,mBAAmB,WAAYvC,EAC7D,KAAK,CACJ,IAAI6M,EAAWJ,EAAsB,aAAK,CAACJ,GACvCrJ,EAAW6I,EAAG1O,cAAc,+BAC5B2P,EAAc9J,EAAQ7F,cAAc,cAExC0P,EAAQxQ,QAAQgQ,IACf,IAAInJ,EAASjC,EAAU6L,GACvB5J,EAAM/F,cAAc,WAAWiC,MAAQiN,EAEvCrJ,EAAQvE,YAAYyE,KAGrB4J,EAAY5Q,QACb,CAEA,IAAI6Q,EAAeN,EAAkB,SAAK,GACpC,GAAY,IAATM,EAAY,CACX,IAAKC,EAAc,uCAAuCD,UAC3DE,EAAc,uCAAuCF,UAE7DlB,EAAG1O,cAAc,UAAUoB,UAAY,4CAA4CwO,eAAmBE,gCAAuCD,2CACxI,CAEN,IAAIE,EAAWT,EAAmB,UAAK,GAEnC7H,EAAQ6H,EAA6B,oBAAK,GAC9C7H,EAASA,EAAK,IAAMA,EAEpB,IAAIuI,EAAWV,EAAmB,UAAK,GACvCU,EAAYA,EAAS,IAAMA,EAE3B,IAAIC,EAAaX,EAA0B,iBAAKA,EAAiC,wBAAK,GAElFnK,EAAO,kEAAkE4K,WAC7E5K,GAAQ,8DAA8DmK,EAAiB,QAAK,YAC5FnK,GAAQ,0DAA0DsC,WAClEtC,GAAQ,kEAAkE6K,WAC1E7K,GAAQ,4DAA4D8K,WAEpE,IAAIC,EAAcxB,EAAG1O,cAAc,gBACjB,MAAfkQ,GACFxB,EAAG1O,cAAc,aAAaiC,MAAQ8N,EACtCrB,EAAG1O,cAAc,WAAWiC,MAASqN,EAAiB,QAAK,GAC3DZ,EAAG1O,cAAc,SAASiC,MAASwF,EACnCiH,EAAG1O,cAAc,aAAaiC,MAAQ+N,EACtCtB,EAAG1O,cAAc,UAAUiC,MAASgO,GAEpCC,EAAY/H,UAAYhD,EAGnB,IAAIgL,EAAgBzB,EAAG1O,cAAc,YAAYiC,MACvDkO,EAAwCxP,MAA3B2O,EAAsB,aAAqD3O,MAApC2O,EAAsB,YAAS,MAAiBA,EAAsB,YAAS,MAAS,GAE5I,IAAIhF,EAAagF,EAAc,KAAK,GAC9B,GAAU,IAAPhF,EAAU,CACT3B,EAAW,0BAA0B2B,IAC9CoE,EAAG1O,cAAc,QAAQoB,UAAY,kDACIuH,uBAC9BA,sDAIX,MAAMyH,QAAsBhB,MAAMzG,EAAI,SAChC0H,QAAmBD,EAAaf,OAEtCc,EAAUE,EAAsB,aAAK,GAErCF,EAAUA,EAAQlO,OAASkO,EAECxP,MAAxB0P,EAAmB,UACtBA,EAAmB,SAAEnR,QAASoR,IAC7B5B,EAAGzP,iBAAiB,wBAAwBqR,OAAapR,QAASC,GAAOA,EAAGsD,SAAU,IAGnF,CAEQ,IAAX0N,IACFzB,EAAG1O,cAAc,YAAYiC,MAAQkO,EAGvC,CAAE,MAAMxC,GACPnM,QAAQD,MAAM,4BAA6BoM,EAC5C,CACD,CFkeAvO,OAAOQ,iBAAiB,SAAU,WACjCZ,SAASC,iBAAiB,gBAAgBC,QAAQqR,IACjDA,EAAIC,UAAW,EACfD,EAAItR,iBAAiB,YAAYC,QAAQC,GAAIA,EAAGJ,WAElD,GAGAK,OAAOQ,iBAAiB,UAAW,WAClCZ,SAASC,iBAAiB,gBAAgBC,QAAQqR,IACjDA,EAAIC,UAAW,EACoB,MAAhCD,EAAIvQ,cAAc,aACpBuQ,EAAInP,UAAY,uBAAuBmP,EAAInP,UAAU,UAEtDmP,EAAInP,WAAa,8CAEnB,GAEApC,SAASY,iBAAiB,QAAS,SAASyJ,GAC3C,IAAIjJ,EAASiJ,EAAMjJ,OAGnB,GAAGA,EAAOC,QAAQ,QAAQ,CACzB,IAAIoQ,EAAUrQ,EAAOL,QAAQ,cAEzBuE,EAAUI,EAAc+L,GAG5B7K,EAAaxF,EAAOL,QAAQ,wBAG5BuE,EAAQrF,iBAAiB,mBAAmBC,QAAQ,CAACC,EAAIyF,KAExD,IAAIX,EAAKnF,QAAQoF,IAAIuM,EAAQxR,iBAAiB,mBAAmB2F,GAAOrF,IACxE,GAAS,MAAN0E,EAAW,CACb,IAAIE,EAAWF,EAAGE,SAGlB,IAAK,MAAMmG,KAAOnG,EACjB3C,QAAQc,IAAI,GAAGgI,MAAQnG,EAASmG,MAEJ,iBAAlBnG,EAASmG,KAClBnG,EAASmG,GAAOnG,EAASmG,GAAKtE,QAC7B,cACA,CAAC5D,EAAOsO,EAAQ9I,IAER8I,GADWtJ,SAASQ,GAAM,KAOrC9I,QAAQ0F,KAAKL,EAEd,IAGD/D,EAAOrB,QACR,CAGGqB,EAAOC,QAAQ,YAEjB+F,EAAWhG,GAGTA,EAAOC,QAAQ,4CACjBgJ,EAAMC,kBA5zBRtB,eAA6B5H,GAC5B,IAAIwB,EAAQxB,EAAOL,QAAQ,QAG3B6B,EAAK3C,iBAAiB,6FAA6FC,QAAQC,IAEtF,MAAjCA,EAAGY,QAAQ,oBAA0C,QAAXZ,EAAG+B,MAA6F,MAA3E/B,EAAGY,QAAQ,qBAAqBC,cAAc,4BAC/Gb,EAAGwR,UAAW,KAIhB,IAAI1H,QAAiBC,WAAW0H,WAAWxQ,EAAQ,yBAEhD6I,IACF7I,EAAOL,QAAQ,mBAAmBC,cAAc,cAAcqF,UAAUC,IAAI,UAE5E9E,KAAKgO,eAAevF,GAEK,QAAtBrH,EAAKgB,QAAQiO,OACf3H,WAAW4H,UAAUlP,GAGxB,CAwyBEmP,CAAc3Q,KAGZA,EAAOC,QAAQ,wBAA0BD,EAAOC,QAAQ,8BAnL5D2H,eAAiC5H,GAChC,IAIIkI,EAJAzC,EAAUzF,EAAOL,QAAQ,qBACzBmI,EAAS9H,EAAO+H,UAEhBC,EAAW,IAAIC,SAGnB,MAAMM,EAAQ,IAAIC,IAAIxJ,OAAOyJ,UAC1BzI,EAAOC,QAAQ,wBACjB+H,EAASM,OAAO,eAAe,GAC/BC,EAAIG,aAAayC,IAAI,eAAe,GAEpCjD,EAASzC,EAAQ7F,cAAc,yBAAyB4C,QAAQ2F,SAEhEI,EAAIG,aAAakI,OAAO,eACxB1I,EAASzC,EAAQ7F,cAAc,mBAAmBiC,OAEnD7C,OAAOoM,QAAQC,UAAU,CAAC,EAAG,GAAI9C,GAEjCP,EAASM,OAAO,SAAUJ,GAE1B,IAAIS,EAASvI,KAAKwI,WAAW5I,GAAQ,EAAO,sBAC5CyF,EAAQzE,UAAY2H,EAAOZ,UAE3B,IAAIc,QAAiBC,WAAWC,aAAa,qBAAsBf,GAEhEa,GACFpD,EAAQzE,UAAY6H,EAAS9D,KFroBL,SAAU8D,EAAUpK,GAC1CF,EAAc,GACd,IAAIsS,EAAUjS,SAASiC,cAAc,OAGrCgQ,EAAK7P,UAAa6H,EAAS9D,KAC3BxG,EAAU0E,MAAM6N,UAAUC,MAAMC,KAAKH,EAAKhM,qBAAqB,WAE5DgE,EAASoI,KACRJ,EAAK7P,UAAa6H,EAASoI,GAC3B1S,EAAU,IAAIsS,EAAKK,UAAUC,OAAO5S,GACpC+B,EAAW7B,IAGZoK,EAASuI,MACRP,EAAK7P,UAAY6H,EAASuI,IAC1B,IAAIP,EAAKK,UAAUpS,QAAQC,IACvBH,SAASqC,KAAKC,YAAYnC,KAGtC,CEmnBEsS,CAAUxI,EAAUjK,WAWpB+J,EAAOZ,UAAYD,CAErB,CA0IEwJ,CAAkBtR,IAGhBA,EAAOC,QAAQ,yBAA2BD,EAAOC,QAAQ,0BAvG7D2H,eAAqC5H,GACpC,MAAMuI,EAAQ,IAAIC,IAAIxJ,OAAOyJ,UAC1BzI,EAAOC,QAAQ,wBACjBsI,EAAIG,aAAayC,IAAI,YAAY,GAEjC5C,EAAIG,aAAakI,OAAO,YAEzB5R,OAAOoM,QAAQC,UAAU,CAAC,EAAG,GAAI9C,GAEjCV,EAAsB7H,EACvB,CA8FEuR,CAAsBvR,IAGpBA,EAAOC,QAAQ,wBAA0BD,EAAOC,QAAQ,wBA/F5D2H,eAA6B5H,GAC5B,MAAMuI,EAAQ,IAAIC,IAAIxJ,OAAOyJ,UAC1BzI,EAAOC,QAAQ,uBACjBsI,EAAIG,aAAayC,IAAI,WAAW,GAChC5C,EAAIG,aAAakI,OAAO,OAAO,KAE/BrI,EAAIG,aAAayC,IAAI,OAAO,GAC5B5C,EAAIG,aAAakI,OAAO,YAEzB5R,OAAOoM,QAAQC,UAAU,CAAC,EAAG,GAAI9C,GAEjCV,EAAsB7H,EACvB,CAoFEwR,CAAcxR,EAEhB,GAEApB,SAASY,iBAAiB,SAAUC,IAEnC,GAAGA,EAAGO,OAAOC,QAAQ,gBAAkBR,EAAGO,OAAO4B,KAAK6P,SAAS,KAAK,CACnE,IAAI1S,EAAMU,EAAGO,OAAOyC,KAAK7C,cAAc,WAAWH,EAAGO,OAAO6B,aAE5D,GAAS,MAAN9C,EAAW,CAEb,IAAI8C,EAAQ9C,EAAGyD,QAAQX,MAEXtB,MAATsB,GAEFyE,EAAiB7G,EAAGO,OAAQ6B,EAAO,GAAIpC,EAAGO,OAAOL,QAAQ,QAE3D,CACD,IC91BDyB,QAAQc,IAAI,mBAmWZtD,SAASY,iBAAiB,QAASyJ,IAClC,IAAIjJ,EAASiJ,EAAMjJ,OAEE,MAAlBA,EAAOU,SA3OX,SAAmBV,GAClB,IAEIyM,EAAEiF,EAAGC,EAFL5H,EAAW/J,EAAOL,QAAQ,SAC1BiS,GAAc,EAElB,IAAIC,EAAS,MASb,IANI7R,EAAOiF,UAAUc,SAAS,UAC7B8L,EAAS,QAKHD,GAAW,CAEjBA,GAAY,EACZD,EAAQ5H,EAAM4H,KAGd,IAAK,IAAIhN,EAAI,EAAGA,EAAKgN,EAAKnR,OAAS,EAAImE,IAAK,CAM3C,GAJA8H,EAAIkF,EAAKhN,GAAGE,qBAAqB,MAAM7E,EAAOyK,WAAWzJ,UAAU+B,cACnE2O,EAAIC,EAAKhN,EAAI,GAAGE,qBAAqB,MAAM7E,EAAOyK,WAAWzJ,UAAU+B,cAGnE+O,MAAMrF,IAAOqF,MAAMJ,GAGlB,CAEJ,IAAIK,EAAQ,IAAIlL,KAAK4F,GACjBuF,EAAQ,IAAInL,KAAK6K,GACR,iBAAVK,GAA6BD,MAAMC,IAA2B,IAAjBA,EAAME,WAA2B,iBAAVD,GAA6BF,MAAME,IAA2B,IAAjBA,EAAMC,YACzHxF,EAAIsF,EAAMG,UACVR,EAAIM,EAAME,UAEZ,MAVCzF,EAAI0F,WAAW1F,GACfiF,EAAIS,WAAWT,IAYH,OAARG,GAAiBpF,EAAIiF,GAAe,QAARG,GAAmBH,EAAIjF,KAEvDkF,EAAKhN,GAAGU,WAAWC,aAAaqM,EAAKhN,EAAI,GAAIgN,EAAKhN,IAClDiN,GAAY,EAEd,CACD,CAGY,OAARC,GACH7R,EAAOiF,UAAUC,IAAI,QACrBlF,EAAOiF,UAAUW,QAAQ,MAAO,SAGhC5F,EAAOiF,UAAUW,QAAQ,OAAQ,MAEnC,CAqLEwM,CAAUpS,GAIX,IAAIuK,EAAKvK,EAAOL,QAAQ,MACrBK,EAAOC,QAAQ,YACjBgJ,EAAMC,kBACNG,EAAOrJ,IACO,MAANuK,GAAcA,EAAGtK,QAAQ,YAAgC,SAAlBD,EAAOU,SAAwC,KAAlBV,EAAOU,SAAoC,YAAlBV,EAAOU,UAA0BV,EAAOL,QAAQ,iBACrJsJ,EAAMC,kBACNG,EAAOrJ,EAAOL,QAAQ,QACdK,EAAOC,QAAQ,0BACvB0K,EAAe3K,GACPA,EAAOC,QAAQ,4BAnIzB,SAAyBD,GACxB,IAAI6K,EAAQ,IAEZ7K,EAAO6F,YAAc,mBACrB7F,EAAOiF,UAAUW,QAAQ,QAAQ,QAEdrF,MAAhBvB,OAAO6L,QACTA,EAAQ7L,OAAO6L,OAEhB7L,OAAO+L,SAAS,EAAGF,GAEnBzJ,QAAQc,IAAI,aAGZtD,SAASgB,cAAc,QAAQE,MAAMkL,SAAW,QAEhDpM,SAASgB,cAAc,UAAUE,MAAMmL,OAAS,QAEhDjL,EAAOL,QAAQ,kBAAkBsF,UAAUtG,OAAO,cAElDuN,IAEA,IAAI3D,EAAM,IAAIC,IAAIxJ,OAAOyJ,UAEzBF,EAAIG,aAAakI,OAAO,cAExB5R,OAAOoM,QAAQC,UAAU,CAAC,EAAG,GAAI9C,GAEjC3J,SAASyT,iBAET/G,GACD,CAqGEgH,CAAgBtS,KAIlBpB,SAASY,iBAAiB,mBAAoB,WAE7C0M,IACAlN,OAAOQ,iBAAiB,SAAU0M,GAGlC9B,IAEA,IACIwB,EADY,IAAIC,gBAAgB7M,OAAOyJ,SAASqD,QACzBhI,IAAI,cAE/B,GAAiB,MAAd8H,EACF,IACCjB,EAAe/L,SAASgB,cAAc,sBAAsBgM,OAAgBjM,QAAQ,kBAAkBC,cAAc,qBACrH,CAAC,MACAwB,QAAQD,MAAM,sBAAsByK,MACrC,CAGDN,GACD,GC9YAlK,QAAQc,IAAI,qBA4RZtD,SAASY,iBAAiB,mBAAoB,WAG9C,GAEAZ,SAASY,iBAAiB,QAASyJ,IAClC,IAAIjJ,EAASiJ,EAAMjJ,OAEEO,MAAlBgD,GAA+BvD,EAAOC,QAAQ,cAChDsD,EAAe1E,iBAAiB,uCAAuCC,QAAQC,GAAMA,EAAGJ,UAChFqB,EAAOC,QAAQ,aApSzB2H,eAAuB5H,GACtB,IAAIsJ,EAAStJ,EAAOL,QAAQ,MACxB4S,EAASvS,EAAOL,QAAQ,MACxBqI,EAAY,IAAIC,SAEpBsK,EAAI1T,iBAAiB,mBAAmBC,QAAQuF,KAC9B,YAAdA,EAAMvD,MAAsBuD,EAAMhC,UACpC2F,EAASM,OAAOjE,EAAMzC,KAAMyC,EAAMxC,SAIpC0Q,EAAI1T,iBAAiB,YAAYC,QAAQ0T,GAAKxK,EAASM,OAAO,QAASkK,EAAIzR,MAE3Ef,EAAOiF,UAAUC,IAAI,UACrBoE,EAAK1J,cAAc,sBAAsBqF,UAAUtG,OAAO,UAE1D,IAAIkK,QAAiBC,WAAWC,aAAa,mBAAoBf,GAE9Da,GACFS,EAAKtI,UAAY6H,EAEjBzI,KAAKgO,eAAevF,EAAS4J,WAE7BzS,EAAOiF,UAAUtG,OAAO,UACxB2K,EAAK1J,cAAc,sBAAsBqF,UAAUC,IAAI,UAEvDlF,EAAOrB,SAET,CAyQE+T,CAAQ1S,GACAA,EAAOC,QAAQ,iBACvBD,EAAOL,QAAQ,MAAMhB,WAIvBC,SAASY,iBAAiB,SAAUoI,UACnC,IAAI5H,EAASiJ,EAAMjJ,OAEnB,GAAkB,kBAAfA,EAAO4B,MAA4B5B,EAAO2M,MAAMnM,OAAS,EAAE,CAC7D+C,EAAiBvD,EAAOL,QAAQ,qBAGhC,IAAI8I,EAAWlF,EAAe3D,cAAc,kBAE5C,IADiB6I,EAASkK,iBAEzB,OAEDlK,EAAWA,EAAS5G,MAGpBjD,SAASC,iBAAiB,uBAAuBC,QAAQC,GAAMA,EAAGJ,UAElEqB,EAAOL,QAAQ,wBAAwBsF,UAAUC,IAAI,UACrD3B,EAAe1E,iBAAiB,kBAAkBC,QAAQC,GAAMA,EAAGJ,UAEnE,IAAK,MAAMiO,KAAQ5M,EAAO2M,MAAO,CAChC,IAAIiG,EAAS,IAAIC,WAEjBD,EAAOE,OAAS,SAASvF,GACxB,IAAIwF,EAASnU,SAASiC,cAAc,OACpCkS,EAAI9N,UAAUC,IAAI,iBAElB,IAAIsN,EAAS5T,SAASiC,cAAc,OACpC2R,EAAIzR,IAASwM,EAAEvN,OAAOiO,OACtBuE,EAAIvN,UAAUC,IAAI,cAClBsN,EAAI1S,MAAMmM,UAAY,QACtBuG,EAAI1S,MAAMkT,QAAW,IAErBD,EAAI7R,YAAYsR,GAEhBjP,EAAe0P,QAAQF,EACxB,EACAH,EAAOM,cAActG,GAErB,EAAW5M,EAAQyI,EACpB,CACD,MAAM,GAAGzI,EAAOC,QAAQ,mBAAmB,CAC1C,IAAIqO,EAAKtO,EAAOL,QAAQ,YAGlB4O,EAAcD,EACrB,G","sources":["webpack://library/../../../plugins/sim-plugin/includes/js/imports.js","webpack://library/../../../plugins/sim-plugin/includes/js/field_value.js","webpack://library/../../forms/js/forms.js","webpack://library/../../../plugins/sim-plugin/includes/js/table.js","webpack://library/./library.js"],"sourcesContent":["export let scripts;\r\n\r\nexport let afterScriptsLoaded\t= function (attachTo){\r\n    // load \r\n    if(typeof(tinymce) != 'undefined'){\r\n        tinymce.remove();\r\n\r\n        // Activate tinyMce's again\r\n        document.querySelectorAll('.entry-content .wp-editor-area').forEach(el =>{\r\n            window.tinyMCE.execCommand('mceAddEditor', false, el.id);\r\n        });\r\n    }    \r\n\r\n    // invoke dom content loaded events\r\n    window.document.dispatchEvent(new Event(\"DOMContentLoaded\", {\r\n        bubbles: true,\r\n        cancelable: true\r\n    }));\r\n\r\n    // Somehow the visual/text switch does not work, manually fix it\r\n    document.querySelectorAll('.wp-switch-editor').forEach(el=>el.addEventListener('click', ev=>{\r\n        let area    = el.closest('.wp-editor-wrap').querySelector('.wp-editor-area');\r\n        let panel   =  el.closest('.wp-editor-wrap').querySelector('.mce-panel');\r\n        area.style.visibility='unset';\r\n        if(ev.target.matches('.switch-tmce')){\r\n           panel.style.display='block';\r\n            area.style.display='none';\r\n        }else{\r\n            panel.style.display='none';\r\n            area.style.display='block';\r\n        }\r\n    }));\r\n\r\n    //add niceselects\r\n\tdocument.querySelectorAll('select:not(.nonice,.swal2-select)').forEach(function(select){\r\n        Main.attachNiceSelect(select);\r\n\t});\r\n\r\n    const ev = new Event('scriptsloaded');\r\n\tattachTo.dispatchEvent(ev);\r\n}\r\n\r\nexport let addStyles    = function (response, attachTo){\r\n    scripts     = [];\r\n    let temp    = document.createElement('div');\r\n\r\n    // parse inline scripts\r\n    temp.innerHTML =  response.html;\r\n    scripts = Array.prototype.slice.call(temp.getElementsByTagName('script'));\r\n\r\n    if(response.js){\r\n        temp.innerHTML =  response.js;\r\n        scripts\t= [...temp.children].concat(scripts);\r\n        addScripts(attachTo);\r\n    }\r\n\r\n    if(response.css){\r\n        temp.innerHTML = response.css;\r\n        [...temp.children].forEach(el => {\r\n            document.head.appendChild(el);\r\n        });\r\n    }\r\n}\r\n\r\nexport let addScripts\t= function (attachTo) {\r\n    if(attachTo == undefined){\r\n        return;\r\n    }\r\n\r\n    if(scripts.length == 0){\r\n        afterScriptsLoaded(attachTo);\r\n    }\r\n    let el\t= scripts.shift();\r\n\r\n    if(el == undefined){\r\n        afterScriptsLoaded(attachTo);\r\n        return;\r\n    }\r\n\r\n    // only add if needed\r\n    if(el.tagName == 'SCRIPT' && document.getElementById(el.id) == null){\r\n        var s = document.createElement('script');\r\n\r\n        if(el.type == ''){\r\n            s.type\t= 'text/javascript'; \r\n        }else{\r\n            s.type\t= el.type;\r\n        }\r\n\r\n        if(el.src != ''){\r\n            s.src \t= el.src;\r\n        }else{\r\n            s.innerHTML\t= el.innerHTML;\r\n        }\r\n        \r\n        s.id\t= el.id;\r\n        \r\n        try{\r\n            document.head.appendChild(s);\r\n        }catch (error) {\r\n            console.error(error);\r\n        }\r\n\r\n        if(scripts.length > 0){\r\n            if(el.src != ''){\r\n                s.addEventListener('load', addScripts.bind( null, attachTo ) );\r\n            }else{\r\n                addScripts(attachTo);\r\n            }\r\n        }else{\r\n            if(el.src != ''){\r\n                s.addEventListener('load', afterScriptsLoaded.bind( null, attachTo));\r\n            }else{\r\n                afterScriptsLoaded(attachTo);\r\n            }\t\t\t\r\n        }\r\n    }else if(scripts.length > 0){\r\n        // get next script\r\n        addScripts(attachTo);\r\n    }else{\r\n        afterScriptsLoaded(attachTo);\r\n    }\r\n}\r\n\r\nexport function displayMessage(message, icon, autoclose=false, no_ok=false, timer=1500){\r\n\tif(message == undefined){\r\n\t\treturn;\r\n\t}\r\n\t\r\n\tif(typeof(Swal) != 'undefined'){\r\n\t\tvar options = {\r\n\t\t\ticon: icon,\r\n\t\t\ttitle: message.toString().trim(),\r\n\t\t\tconfirmButtonColor: \"#bd2919\",\r\n\t\t\tcancelButtonColor: 'Crimson'\r\n\t\t};\r\n\r\n\t\tif(no_ok){\r\n\t\t\toptions['showConfirmButton'] = false;\r\n\t\t}\r\n\t\t\r\n\t\tif(typeof(callback) == 'function'){\r\n\t\t\toptions['didClose'] = () => callback();\r\n\t\t}\r\n\t\t\r\n\t\tif(autoclose){\r\n\t\t\toptions['timer'] = timer;\r\n\t\t}\r\n\r\n        if(document.fullscreenElement != null){\r\n\t\t\toptions['target']\t= document.fullscreenElement;\r\n\t\t}\r\n\t\t\r\n\t\treturn Swal.fire(options);\r\n\t}else{\r\n\t\treturn alert(message.trim());\r\n\t}\r\n}\r\n\r\nexport function showLoader(element, replace=true, message=''){\r\n\tif(element == null){\r\n\t\treturn;\r\n\t}\r\n\t\r\n\tlet wrapper\t= document.createElement(\"DIV\");\r\n\twrapper.setAttribute('class','loaderwrapper');\r\n\tif(message != ''){\r\n\t\twrapper.innerHTML\t= message;\r\n\t}\r\n\r\n\tlet loader\t= document.createElement(\"IMG\");\r\n\tloader.setAttribute('class','loadergif');\r\n\tloader.setAttribute(\"src\", sim.loadingGif);\r\n\tloader.style[\"height\"]= \"30px\";\r\n\r\n\twrapper.insertAdjacentElement('beforeEnd', loader);\r\n\tif(replace){\r\n\t\telement.parentNode.replaceChild(wrapper, element);\r\n\t}else{\r\n        let el  = element.nextElementSibling;\r\n        if(el == null){\r\n            element.parentNode.insertAdjacentElement('beforeEnd', wrapper);\r\n        }else{\r\n            element.parentNode.insertBefore(wrapper, el);\r\n        }\r\n\t}\r\n\r\n\treturn wrapper;\r\n}\r\n\r\n//Check if on mobile\r\nexport function isMobileDevice() {\r\n    let check = false;\r\n    (function(a){if(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);\r\n    return check;\r\n}","function getRadioValue(form, selector){\r\n\tlet el\t= form.querySelector(`${selector}:checked`);\r\n\r\n\t//There is no radio selected currently\r\n\tif(el == null){\r\n\t\t//return an empty value\r\n\t\treturn '';\r\n\t}\r\n\r\n\treturn el.value;\r\n}\r\n\r\nfunction getCheckboxValue(form, selector, compareValue, orgName){\r\n\tlet value\t\t= '';\r\n\tlet elements\t= '';\r\n\r\n\t//we are dealing with a specific checkbox\r\n\tif(orgName.type == 'checkbox' && compareValue != null ){\r\n\t\tif(orgName.checked){\r\n\t\t\treturn orgName.value;\r\n\t\t}\r\n\t\t\r\n\t\treturn '';\r\n\t}\r\n\r\n\t//we should find the checkbox with this value and check if it is checked\r\n\tif(compareValue != null){\r\n\t\telements\t= form.querySelector(`${selector}[value=\"${compareValue}\" i]:checked`);\r\n\t\tif(elements != null){\r\n\t\t\tvalue = compareValue;\r\n\t\t}\r\n\t//no compare value give just return all checked values\r\n\t}else{\r\n\t\telements\t= form.querySelectorAll(`${selector}:checked`);\r\n\t\tvalue\t\t= [];\r\n\t\telements.forEach(el=>{\r\n\t\t\tvalue.push(el.value);\r\n\t\t\t/* if(value != ''){\r\n\t\t\t\tvalue += ', ';\r\n\t\t\t}\r\n\t\t\tvalue += el.value; */\r\n\t\t});\r\n\t}\r\n\r\n\treturn value;\r\n}\r\n\r\nfunction getMultiValue(form, el){\r\n\tlet value = [];\r\n\r\n\tform.querySelectorAll(`[name=\"${el.name}\"]`).forEach(elem => value.push(elem.value));\r\n\r\n\treturn value;\r\n}\r\n\r\nexport function getDataListValue(el){\r\n\tlet value\t\t= '';\r\n\tlet origInput \t= el.list.querySelector(`[value='${el.value}' i]`);\r\n\t\t\t\r\n\tif(origInput == null){\r\n\t\tvalue =  el.value;\r\n\t}else{\r\n\t\tvalue = origInput.dataset.value;\r\n\t}\r\n\r\n\treturn value;\r\n}\r\n\r\nexport function getFieldValue(orgName, form, checkDatalist=true, compareValue=null, lowercase=false){\r\n\r\n\tlet el\t\t\t= ''; \r\n\tlet name\t\t= '';\r\n\tlet value \t\t= '';\r\n\tlet selector\t= '';\r\n\r\n\t//name is not a name but a node\r\n\tif(orgName instanceof Element){\r\n\t\tel\t\t\t= orgName;\t\t\r\n\t\t//check if valid input type\r\n\t\tif(el.tagName != 'INPUT' && el.tagName != 'TEXTAREA' && el.tagName != 'SELECT' && el.closest('.nice-select-dropdown') == null){\r\n\t\t\tel = el.querySelector('input, select, textarea');\r\n\t\t}\r\n\t\tif(el == null){\r\n\t\t\tel\t\t\t= orgName;\r\n\t\t}\r\n\t\tname\t\t= el.name;\r\n\t// We should look for an id\r\n\t}else if(orgName.match(\"E[0-9]\")){\r\n\t\tselector\t= `[id^=${orgName}]`;\r\n\t\tel\t\t\t= form.querySelector(selector);\r\n\t\tname\t\t= el.name;\r\n\t}else{\r\n\t\tname\t\t= orgName;\r\n\t\tselector\t= `[name='${name}' i]`;\r\n\t\tel\t\t\t= form.querySelector(selector);\r\n\t}\r\n\t\r\n\tif(el == null){\r\n\t\tconsole.trace();\r\n\t\tconsole.log(\"cannot find element with name \"+name);\r\n\r\n\t\treturn value;\r\n\t}\r\n\r\n\tif(el.type == 'radio'){\r\n\t\tvalue\t= getRadioValue(form, selector);\r\n\t}else if(el.type == 'checkbox'){\r\n\t\tvalue\t= getCheckboxValue(form, selector, compareValue, orgName);\t\r\n\t}else if(el.closest('.nice-select-dropdown') != null && el.dataset.value != undefined){\r\n\t\t//nice select\r\n\t\tvalue = el.dataset.value\r\n\t}else if(el.list != null && el.value != '' && checkDatalist){\r\n\t\tvalue =  getDataListValue(el);\r\n\t}else if(el.name != undefined && el.name.endsWith('[]')){\r\n\t\tvalue =  getMultiValue(form, el);\r\n\t}else if(el.value != null && el.value != 'undefined'){\r\n\t\tvalue = el.value;\r\n\t}\r\n\t\r\n\tif(lowercase){\r\n\t\treturn value.toLowerCase();\r\n\t}\r\n\treturn value;\r\n}","import { addStyles } from '../../../plugins/sim-plugin/includes/js/imports.js';\nimport { getFieldValue } from  '../../../plugins/sim-plugin/includes/js/field_value.js';\nexport{ getFieldValue };\n\nconsole.log('Forms.js is loaded');\n\nasync function saveFormInput(target){\n\tlet form\t\t= target.closest('form');\n\n\t// make all inputs required if needed\n\tform.querySelectorAll('.required:not(hidden) input, .required:not(hidden) textarea, .required:not(hidden) select').forEach(el=>{\n\t\t// do not make nice select inputs nor file uploads required\n\t\tif(el.closest('div.nice-select') == null && (el.type != 'file' || el.closest('.file_upload_wrap').querySelector('.documentpreview input') == null)){\n\t\t\tel.required\t= true;\n\t\t}\n\t});\n\n\tlet response\t= await FormSubmit.submitForm(target, 'forms/save_form_input');\n\n\tif(response){\n\t\ttarget.closest('.submit_wrapper').querySelector('.loadergif').classList.add('hidden');\n\n\t\tMain.displayMessage(response);\n\n\t\tif(form.dataset.reset == 'true'){\n\t\t\tFormSubmit.formReset(form);\n\t\t}\n\t}\n}\n\nexport function removeDefaultSelect(el){\n\tArray.from(el.options).forEach(function(option){\n\t\toption.defaultSelected = false;\n\t});\n}\n\nlet tinymceSettings = [];\nfunction prepareForCloning(originalNode){\n\t//also remove any tinymce's\n\tif(typeof(tinymce) != 'undefined'){\n\t\toriginalNode.querySelectorAll('.wp-editor-area').forEach(el =>{\n\t\t\tlet tn = tinymce.get(el.id);\n\t\t\tif(tn != null){\n\t\t\t\ttinymceSettings[el.id] = tn.settings\n\t\t\t\ttn.save();\n\t\t\t\ttn.remove();\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function cloneNode(originalNode, clear=true){\n\tprepareForCloning(originalNode);\n\t\n\t//make a clone\n\tlet newNode = originalNode.cloneNode(true);\n\n\t// remove niceselect drop down from clone\n\tnewNode.querySelectorAll('.nice-select').forEach(dropdown => dropdown.remove());\n\t\n\t//add tinymce's again\n\toriginalNode.querySelectorAll('.wp-editor-area').forEach(el =>{\n\t\tif(tinymceSettings[el.id] != undefined){\n\t\t\ttinymce.init(tinymceSettings[el.id]);\n\t\t}\n\t});\n\t\n\t//clear values in the clone\n\tif(clear){\n\t\tnewNode.querySelectorAll('input,select,textarea').forEach(input => {\n\t\t\tif(input.type == 'checkbox' || input.type == 'radio'){\n\t\t\t\tinput.checked = false;\n\t\t\t}else if(input.type != 'hidden'){\n\t\t\t\tinput.value = \"\";\n\t\t\t}\n\t\t\t\n\t\t\t//if this is a select\n\t\t\tif(input.type == \"select-one\"){\n\t\t\t\t//remove any defaults\n\t\t\t\tremoveDefaultSelect(input);\n\t\t\t}\n\t\t});\n\t}\n\n\tnewNode.querySelectorAll('select').forEach(select => {\n\t\t//remove any defaults\n\t\tremoveDefaultSelect(select);\n\n\t\tMain.attachNiceSelect(select);\n\t});\n\t\n\treturn newNode;\n}\n\nexport function copyFormInput(originalNode){\n\tlet newNode = cloneNode(originalNode);\n\t\n\t//update the data index\n\tnewNode.querySelectorAll('.upload-files').forEach(function(uploadButton){\n\t\tuploadButton.dataset.index = nodeNr;\n\t})\n\t\n\t//Clear contents of any document preview divs.\n\tnewNode.querySelectorAll('.documentpreview').forEach(function(previewDiv){\n\t\tpreviewDiv.innerHTML = '';\n\t});\n\n\t//Select\n\tlet i = 0;\n\tnewNode.querySelectorAll('select').forEach(select => {\n\t\t//Find the value of the select we have cloned\n\t\tlet previousVal = originalNode.getElementsByTagName('select')[i].selectedIndex;\n\t\t\n\t\t//Hide the value in the clone\n\t\tif(select.options[previousVal] != undefined){\n\t\t\tselect.options[previousVal].style.display = 'none';\n\t\t}\n\t\t\n\t\t//Add nice select\n\t\tMain.attachNiceSelect(select);\n\t\t\n\t\ti++;\n\t});\n\t\n\t//Add remove buttons if they are not there\n\tif(originalNode.querySelector('.remove') == null && newNode.querySelector('.remove') == null){\n \t\tlet html = `<button type=\"button\" class=\"remove button\" style=\"flex: 1;\">-</button>`;\n\n\t\t//Add minus button to the first div\n\t\toriginalNode.querySelector('.buttonwrapper').insertAdjacentHTML('beforeend', html);\n\n\t\t//Add minus button to the second div\n\t\tnewNode.querySelector('.buttonwrapper').insertAdjacentHTML('beforeend', html)\n\t}\t\n\n\t// process tab buttons\n\tif(originalNode.matches('.tabcontent')){\n\t\t// Hide original\n\t\toriginalNode.classList.add('hidden');\n\n\t\t// Add button for the new one\n\t\tlet orgButton\t= originalNode.closest('.clone_divs_wrapper').querySelector(`.tablink.active`);\n\t\tlet newButton\t= cloneNode(orgButton);\n\n\t\t// make the org butto inactive\n\t\torgButton.classList.remove('active');\n\n\t\t//Insert the clone\n\t\torgButton.parentNode.insertBefore(newButton, orgButton.nextSibling);\n\t}\n\t\n\t//Insert the clone\n\toriginalNode.parentNode.insertBefore(newNode, originalNode.nextSibling);\n\t\n\treturn newNode;\n}\n\nexport function fixNumbering(wrapper){\n\twrapper.querySelectorAll(':scope > .clone_div').forEach(updateNumbers);\n\n\twrapper.querySelectorAll(':scope > .tablink').forEach(updateNumbers);\n\n\tfunction updateNumbers(clone, index){\n\t\t//Update the new number\t\n\n\t\t// Update the ID\n\t\tif(clone.id != ''){\n\t\t\tclone.id = clone.id.replace(/[0-9]+(?!.*[0-9])/, index);\n\t\t}\n\t\t\n\t\t// Update the content\n\t\tif(clone.type == 'button' && clone.textContent != ''){\n\t\t\tclone.textContent \t\t= clone.textContent.replace(/[0-9]+(?!.*[0-9])/, index + 1);\n\n\t\t\tclone.dataset.target\t= clone.dataset.target.replace(/[0-9]+(?!.*[0-9])/, index);\n\t\t}\n\n\t\t// Update the divid attribute\n\t\tif(clone.dataset.divid  != null){\n\t\t\tclone.dataset.divid = index;\n\t\t}\n\t\t\n\t\t//Update the title\n\t\tclone.querySelectorAll('h3, h4, legend :first-child').forEach(el => {\n\t\t\tel.textContent = el.textContent.replace(/[0-9]+(?!.*[0-9])/, index + 1);\n\t\t});\n\t\t\n\t\t//Update the legend\n\t\t/* clone.querySelectorAll('legend').forEach(legend => {\n\t\t\tlegend.textContent = legend.textContent.replace(/[0-9]+(?!.*[0-9])/, ' '+(index+1));\n\t\t}); */\n\t\t\n\t\t//Update the elements\n\t\tclone.querySelectorAll('input,select,textarea').forEach(input => {\n\t\t\t//Do not copy nice selects\n\t\t\tif(!input.classList.contains('nice-select-search')){\n\t\t\t\t//Update the id\n\t\t\t\tif(input.id != '' && input.id != undefined){\n\t\t\t\t\tinput.id = input.id.replace(/[0-9]+(?!.*[0-9])/, index);\n\t\t\t\t}\n\t\t\t\t//Update the name\n\t\t\t\tif(input.name != '' && input.name != undefined){\n\t\t\t\t\tinput.name = input.name.replace(/[0-9]+(?!.*[0-9])/, index);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//Reset the select to the default\n\t\t\t\tif(input.type == 'button'){\n\t\t\t\t\tinput.value = input.value.replace(/[0-9]+(?!.*[0-9])/, index);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function removeNode(target){\n\tlet node\t\t\t= target.closest(\".clone_div\");\n\tlet parentNode\t\t= node.closest('.clone_divs_wrapper');\n\tlet allCloneDivs\t= parentNode.querySelectorAll('.clone_div');\n\t\n\t//Check if we are removing the last element\n\tif(allCloneDivs[allCloneDivs.length-1] == node){\n\t\tlet addElement = node.querySelector(\".add\");\n\t\t\n\t\t//Move the add button one up\n\t\tlet prev = node.previousElementSibling;\n\t\tif(prev.querySelector('.buttonwrapper .add') == null){\n\t\t\tprev.querySelector('.buttonwrapper').appendChild(addElement);\n\t\t}\n\t}\n\t\n\t//Remove the node\n\tnode.remove();\n\n\t//If there is only one div remaining, remove the remove button\n\tif(parentNode.querySelectorAll('.clone_div').length == 1){\n\t\tlet removeElement = parentNode.querySelector('.remove');\n\t\tremoveElement.remove();\n\t}\n\n\tfixNumbering(parentNode)\n}\n\n/* \n\tFUNCTIONS USED BY DYNAMIC FORMS JS\n */\nexport function tidyMultiInputs(){\n\t//remove unnecessary buttons on inputs with multiple values\n\tdocument.querySelectorAll('.clone_divs_wrapper').forEach( function(div){\n\t\tlet cloneDivArr\t= div.querySelectorAll(':scope > .clone_div');\n\t\t\n\t\tif(cloneDivArr.length == 1){\n\t\t\tcloneDivArr[0].querySelectorAll('.remove').forEach(el=>el.remove());\n\t\t}\n\t\t\n\t\tcloneDivArr.forEach(function(cloneDiv, index, array){\n\t\t\t//update dataset\n\t\t\tcloneDiv.dataset.divid = index;\n\t\t\t\n\t\t\t//remove add button for all but the last\n\t\t\tif(index != array.length - 1){\n\t\t\t\t// Select all add buttons but not the any nested buttons\n\t\t\t\tcloneDiv.querySelectorAll('.add:not(:scope .clone_divs_wrapper .add)').forEach(el=>el.remove());\n\t\t\t}\n\t\t})\n\t});\n}\n\nexport function updateMultiStepControls(form){\n\t// get active formsteps amount\n\tlet formsteps\t\t\t= form.querySelectorAll('.formstep');\n\tlet visibleFormsteps\t= form.querySelectorAll('.formstep:not(.hidden)');\n\tlet stepIndicators\t\t= form.querySelectorAll('.multistepcontrols_wrapper .step');\n\n\t// show all step circles\n\tstepIndicators.forEach(el => el.classList.remove('hidden'));\n\n\t// hide some step circles if needed\n\tfor(let x = visibleFormsteps.length; x < formsteps.length; x++){\n\t\tstepIndicators[x].classList.add('hidden');\n\t}\n\n\t// check if this is the last visible\n\tlet activeFormstep\t\t= form.querySelector('.formstep:not(.stephidden)');\n\tif(visibleFormsteps[visibleFormsteps.length-1] == activeFormstep){\n\t\t// make the submit button visible\n\t\tform.querySelector('.nextBtn').classList.add('hidden');\n\t\tform.querySelector('.form_submit ').classList.remove('hidden');\n\t}else{\n\t\tform.querySelector('.nextBtn').classList.remove('hidden');\n\t\tform.querySelector('.form_submit ').classList.add('hidden');\n\t}\n}\n\t\n//show a next form step\nexport function showTab(n, form) {\n\tif(typeof(form) != 'undefined'){\n\t\tif(n == 0){\n\t\t\tlet loader = form.querySelector('.formsteploader');\n\t\t\t//hide loader\n\t\t\tif(loader != null){\n\t\t\t\tloader.classList.add('hidden');\n\t\t\t\n\t\t\t\t//show form controls\n\t\t\t\tform.querySelector('.multistepcontrols').classList.remove('hidden');\n\t\t\t}\n\t\t}\n\t\t\n\t\t//hide all formsteps\n\t\tform.querySelectorAll('.formstep:not(.stephidden)').forEach(step=>step.classList.add('stephidden'));\n\t\t\n\t\t// Show the specified formstep of the form ...\n\t\tlet x = form.getElementsByClassName(\"formstep\");\n\t\t\n\t\tif(x.length == 0){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t//scroll back to top\n\t\tlet y = x[n].offsetTop - document.querySelector(\"#masthead\").offsetHeight\n\t\twindow.scrollTo({ top: y, behavior: 'auto'});\n\t\t\n\t\t//show\n\t\tx[n].classList.remove('stephidden');\n\n\t\t// This function removes the \"active\" class of all steps...\n\t\tform.querySelectorAll(\".step.active\").forEach(el=>{el.classList.remove('active');});\n\n\t\t//... and adds the \"active\" class to the current step:\n\t\tx = form.getElementsByClassName(\"step\");\n\t\ttry{\n\t\t\tx[n].classList.add(\"active\");\n\t\t}catch(err) {\n\t\t\tconsole.log(x);\n\t\t\tconsole.log(n);\n\t\t  \tconsole.error(err.message);\n\t\t}\n\t\t\n\n\t\t// ... and fix the Previous/Next buttons:\n\t\tif (n == 0) {\n\t\t\tform.querySelector('[name=\"prevBtn\"]').classList.add('hidden');\n\t\t} else {\n\t\t\tform.querySelector('[name=\"prevBtn\"]').classList.remove('hidden');\n\t\t}\n\n\t\tif (n == (x.length - 1)) {\n\t\t\tform.querySelector('[name=\"nextBtn\"]').classList.add('hidden');\n\t\t\tform.querySelector('.form_submit').classList.remove('hidden');\n\t\t} else {\n\t\t\tform.querySelector('[name=\"nextBtn\"]').classList.remove('hidden');\n\t\t\tform.querySelector('.form_submit').classList.add('hidden');\n\t\t}\n\t}else{\n\t\tconsole.log('no form defined');\n\t}\n\t\t\n}\n\n//next form step clicked\nexport function nextPrev(n) {\n\t// This function will figure out which tab to display\n\tlet x \t\t\t\t= form.querySelectorAll(\".formstep\");\n\tlet stepIndicators\t= form.querySelectorAll(\".step\");\n\tlet currentTab\t\t= 0;\n\tlet valid\t\t\t= true;\n\n\t// Find the current active tab\n\tx.forEach((el, index)=>{if(!el.matches('.stephidden')){currentTab = index}});\n\t\n\t//Check validity of this step if going forward\n\tif(n>0){\n\t\t// Report validity of each required field\n\t\tlet elements\t= x[currentTab].querySelectorAll('.required:not(.hidden) input, .required:not(.hidden) textarea, .required:not(.hidden) select');\n\t\tfor(const element of elements) {\n\t\t\tif(\n\t\t\t\telement.closest('.hidden')\t== null\t&&\n\t\t\t\telement.closest('div.nice-select') == null && \n\t\t\t\t(\n\t\t\t\t\telement.type != 'file' || \n\t\t\t\t\telement.closest('.file_upload_wrap').querySelector('.documentpreview input') == null\n\t\t\t\t)\n\t\t\t){\n\t\t\t\telement.required\t= true;\n\t\t\t\tvalid\t\t\t\t= element.reportValidity();\n\t\t\t\tif(!valid){\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif(!valid) return;\n\t\t\n\t\t//mark the last step as finished\n\t\tstepIndicators[currentTab].classList.add(\"finish\");\n\t}else{\n\t\t//mark the last step as unfinished\n\t\tstepIndicators[currentTab].classList.remove(\"finish\");\n\t}\n\t\n\t//loop over all the formsteps to hide stepindicators of them if needed\n\tArray.from(x).forEach((formstep,index) =>{\n\t\tif(formstep.classList.contains('hidden')){\n\t\t\t//hide the corresponding circle\n\t\t\tstepIndicators[index].classList.add('hidden');\n\t\t}\n\t});\n\n\t// Increase or decrease the current tab by 1:\n\tcurrentTab = currentTab + n;\n\t\n\t//check if the next tab is hidden\n\twhile(x[currentTab].classList.contains('hidden')){\n\t\t//go to the next tab\n\t\tcurrentTab = currentTab + n;\n\n\t\tif (currentTab >= x.length) {\n\t\t\tbreak;\n\t\t}\n\t}\n\t\n\t// if you have reached the end of the form... :\n\tif (currentTab >= x.length) {\n\t\treturn false;\n\t}\n\t// Otherwise, display the correct tab:\n\tshowTab(currentTab,form);\n\n\treturn true;\n}\n\nexport function changeFieldValue(selector, value, functionRef, form, addition='', forceValue=false){\n\tif(value == undefined){\n\t\treturn;\n\t}\n\n\tlet name\t\t= '';\n\tlet target\t\t= '';\n\n\tif(selector instanceof Element){\n\t\ttarget\t\t= selector;\n\t\tname\t\t= target.name;\n\t\tif(target.id == ''){\n\t\t\tselector\t= `[name^=\"${target.name}\" i]`;\n\t\t}else{\n\t\t\tselector\t= `[id^=${target.id}]`;\n\t\t}\n\t\t\n\t}else{\n\t\ttarget \t\t= form.querySelector(selector);\n\n\t\ttry{\n\t\t\tname\t\t= target.name;\n\t\t}catch{\n\t\t\tconsole.log(target);\n\t\t}\n\t}\n\n\tlet oldValue\t= getFieldValue(target, form, false, value);\n\t// nothing to change\n\tif(oldValue == value){\n\t\treturn;\n\t}\n\n\t// Check if we are dealing with a multi input field\n\tif(target == null){\n\t\tlet targets \t= form.querySelectorAll(`.clone_div [name^=\"${name}\" i]`);\n\t\tif(targets.length === 0){\n\t\t\treturn;\n\t\t}else if(targets.length == 1){\n\t\t\ttarget\t= targets[0];\n\t\t\ttargets\t= '';\n\t\t}else{\n\t\t\ttarget\t= targets[0];\n\n\t\t\ttargets.forEach((el, index) =>{\n\t\t\t\tif(index == 0){\n\t\t\t\t\tchangeFieldValue(el, '', '', form);\n\t\t\t\t}else{\n\t\t\t\t\tremoveNode(el);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t// calculate the new value\n\tif(addition != ''){\n\t\t// check if a date\n\t\tif (/\\d{4}-\\d{2}-\\d{2}/.test(value)){\n\t\t\tlet date\t= new Date(value);\n\t\t\tdate.setDate(date.getDate() + parseInt(addition));\n\t\t\tvalue\t= date.toISOString().split('T')[0];\n\t\t}else{\n\t\t\tvalue\t= value + parseInt(addition);\n\t\t}\n\t}\n\t\n\tif(target.type == 'radio' || target.type == 'checkbox'){\n\t\t// uncheck all\n\t\tif(value == ''){\n\t\t\tif(selector != ''){\n\t\t\t\tform.querySelectorAll(selector).forEach(el=>el.checked=false);\n\t\t\t}\n\t\t}else{\n\t\t\t// Check if the current target is the one we need to check\n\t\t\tif(target.value.toLowerCase() == value.toLowerCase()){\n\t\t\t\ttarget.checked = true;\n\t\t\t}else{\n\t\t\t\t// find the element with the given value and check it\n\t\t\t\tlet targets = form.querySelectorAll(`[name=\"${name}\" i]`);\n\t\t\t\tfor (const element of targets) {\n\t\t\t\t\tif(element.value.toLowerCase() == value.toLowerCase()){\n\t\t\t\t\t\telement.checked = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t//the target has a list attached to it\n\t}else if(target.type == 'date'){\n\t\ttarget.value = value;\n\t\t\n\t\t// convert a date to the right format\n\t\tif (!/\\d{4}-\\d{2}-\\d{2}/.test(value)){\n\t\t\tlet splitted = '';\n\t\t\tif(value.split('-').length == 3){\n\t\t\t\tsplitted\t= value.split('-');\n\t\t\t}else if(value.split('/').length == 3){\n\t\t\t\tsplitted\t= value.split('/');\n\t\t\t}\n\n\t\t\tif(splitted != ''){\n\t\t\t\tlet year;\n\t\t\t\tlet month;\n\t\t\t\tlet day;\n\t\t\t\tsplitted.forEach(nr=>{\n\t\t\t\t\tif(nr.length == 4){\n\t\t\t\t\t\tyear\t= nr;\n\t\t\t\t\t}else if(nr.length == 2){\n\t\t\t\t\t\tif(nr > 12){\n\t\t\t\t\t\t\tday\t= nr;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t// does not have a value yet\n\t\t\t\t\t\t\tif(month == undefined){\n\t\t\t\t\t\t\t\tmonth\t= nr;\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\tday\t= nr;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif(day != undefined && month != undefined && year != undefined){\n\t\t\t\t\ttarget.value = `${year}-${month}-${day}`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}else if(target.list != null){\n\t\tlet dataListOption = target.list.querySelector(`[data-value=\"${value}\" i]`);\n\n\t\t//we found a match\n\t\tif(dataListOption != null){\n\t\t\t// We found a cloned field, add as many inputs as needed\n\t\t\tif(target.closest('.clone_div') != null){\n\t\t\t\t// mark the existing ones for deletion, we can delete right now as we need to copy the existing ones first\n\t\t\t\ttarget.closest('.clone_divs_wrapper').querySelectorAll('.clone_div').forEach(el=>el.classList.add('shouldremove'));\n\n\t\t\t\tlet clone;\n\t\t\t\tdataListOption.value.split(';').forEach(val=>{\n\t\t\t\t\tclone = copyFormInput(target.closest('.clone_div'));\n\n\t\t\t\t\tclone.classList.remove('shouldremove');\n\n\t\t\t\t\tchangeFieldValue(clone.querySelector(target.tagName), val, '', form, '', true);\n\t\t\t\t});\n\n\t\t\t\tfixNumbering(target.closest('.clone_divs_wrapper'));\n\n\t\t\t\t// delete the old ones\n\t\t\t\ttarget.closest('.clone_divs_wrapper').querySelectorAll('.shouldremove').forEach(el=>el.remove());\n\t\t\t}else{\n\t\t\t\ttarget.value = dataListOption.value;\n\t\t\t}\n\t\t// We did not find a match, we are filling in the given value\n\t\t}else if(forceValue){\n\t\t\ttarget.value = value;\n\t\t// We did not find a match, empty value\n\t\t}else{\n\t\t\ttarget.value = '';\n\t\t}\n\t}else{\n\t\ttarget.value = value;\n\t}\n\t\n\t//create a new event\n\tlet evt = new Event('input');\n\t//attach the target\n\ttarget.dispatchEvent(evt);\n\t\n\t//run the originating function with this event\n\tif(typeof functionRef == 'function'){\n\t\tfunctionRef(target);\n\t}\n}\n\nexport function changeVisibility(action, el, functionRef){\n\tlet wrapper\t= el.closest('.inputwrapper');\n\tif(wrapper == null){\n\t\twrapper\t= el\n\t}\n\t\n\tif(action == 'add'){\n\t\tif(wrapper.matches('.hidden')){\n\t\t\treturn;\n\t\t}\n\t\twrapper.classList.add('hidden');\n\t}else{\n\t\tif(!wrapper.matches('.hidden')){\n\t\t\treturn;\n\t\t}\n\t\twrapper.classList.remove('hidden');\n\t}\n\n\t//create a new event\n\tlet evt = new Event('input');\n\t//attach the target\n\twrapper.dispatchEvent(evt);\n\t\n\t//run the originating function with this event\n\tif(typeof functionRef == 'function'){\n\t\tfunctionRef(el);\n\t}\n}\n\nexport function changeFieldProperty(selector, att, value, functionRef, form, addition=''){\n\t//first change the value\n\tlet target = form.querySelector(selector);\n\n\t// calculate the new value\n\tif(addition != ''){\n\t\t// check if a date\n\t\tif (/\\d{4}-\\d{2}-\\d{2}/.test(value)){\n\t\t\tlet date\t= new Date(value);\n\t\t\tdate.setDate(date.getDate() + parseInt(addition));\n\t\t\tvalue\t= date.toISOString().split('T')[0];\n\t\t}else{\n\t\t\tvalue\t= value + parseInt(addition);\n\t\t}\n\t}\n\n\ttarget[att] = value;\n\t\n\t//create a new event\n\tlet evt = new Event('input');\n\n\t//attach the target\n\ttarget.dispatchEvent(evt);\n\n\t//run the originating function with this event\n\tfunctionRef(target);\n}\n\nasync function formbuilderSwitch(target){\n\tlet wrapper\t= target.closest('.sim-form-wrapper');\n\tlet button\t= target.outerHTML;\n\n\tlet formData = new FormData();\n\tlet formId;\n\n\tconst url \t\t= new URL(window.location);\n\tif(target.matches('.formbuilder-switch')){\n\t\tformData.append('formbuilder', true);\n\t\turl.searchParams.set('formbuilder', true);\n\n\t\tformId\t= wrapper.querySelector('form.sim-form-wrapper').dataset.formid;\n\t}else{\n\t\turl.searchParams.delete('formbuilder');\n\t\tformId\t= wrapper.querySelector('[name=\"formid\"]').value;\n\t}\n\twindow.history.pushState({}, '', url);\n\n\tformData.append('formid', formId);\n\n\tlet loader\t= Main.showLoader(target, false, 'Requesting form...');\n\twrapper.innerHTML\t= loader.outerHTML;\n\n\tlet response = await FormSubmit.fetchRestApi('forms/form_builder', formData);\n\n\tif(response){\n\t\twrapper.innerHTML\t= response.html;\n\n\t\taddStyles(response, document);\n\n\t\t// Activate tinyMce's again\n\t/* \twrapper.querySelectorAll('.wp-editor-area').forEach(el =>{\n\t\t\twindow.tinyMCE.execCommand('mceAddEditor', false, el.id);\n\t\t});\n\n\t\twrapper.querySelectorAll('select').forEach(function(select){\n\t\t\tMain.attachNiceSelect(select);\n\t\t}); */\n\t}else{\n\t\tloader.outerHTML\t= button;\n\t}\n}\n\nasync function requestNewFormResults(target){\n\tlet wrapper\t\t= target.closest('.form.table-wrapper');\n\tlet button\t\t= target.outerHTML;\n\n\tlet formData \t= new FormData();\n\tlet formId\t\t= wrapper.querySelector('.sim-table.form-data-table').dataset.formid;\n\tlet shortcodeId\t= wrapper.querySelector('.sim-table.form-data-table').dataset.shortcodeid;\n\n\tformData.append('formid', formId);\n\tformData.append('shortcode_id', shortcodeId);\n\n\tconst url \t\t= new URL(window.location);\n\tif(url.searchParams.get('onlyown')){\n\t\tformData.append('onlyown', true);\n\t}\n\n\tif(url.searchParams.get('all')){\n\t\tformData.append('all', true);\n\t}\n\n\tif(url.searchParams.get('archived')){\n\t\tformData.append('archived', true);\n\t}\n\n\tlet loader\t= Main.showLoader(target, false, 'Requesting form results...');\n\twrapper.innerHTML\t= loader.outerHTML;\n\n\tlet response = await FormSubmit.fetchRestApi('forms/show_form_results', formData);\n\n\tif(response){\n\t\twrapper.innerHTML\t= response;\n\t}else{\n\t\tloader.outerHTML\t= button;\n\t}\n}\n\nasync function archivedEntriesSwitch(target){\n\tconst url \t\t= new URL(window.location);\n\tif(target.matches('.archive-switch-show')){\n\t\turl.searchParams.set('archived', true);\n\t}else{\n\t\turl.searchParams.delete('archived');\n\t}\n\twindow.history.pushState({}, '', url);\n\n\trequestNewFormResults(target);\n}\n\nasync function onlyOwnSwitch(target){\n\tconst url \t\t= new URL(window.location);\n\tif(target.matches('.onlyown-switch-on')){\n\t\turl.searchParams.set('onlyown', true);\n\t\turl.searchParams.delete('all', true);\n\t}else{\n\t\turl.searchParams.set('all', true);\n\t\turl.searchParams.delete('onlyown');\n\t}\n\twindow.history.pushState({}, '', url);\n\n\trequestNewFormResults(target);\n}\n\n//we are online again\nwindow.addEventListener('online', function(){\n\tdocument.querySelectorAll('.form_submit').forEach(btn=>{\n\t\tbtn.disabled = false\n\t\tbtn.querySelectorAll('.offline').forEach(el=>el.remove());\n\t});\n});\n\n//prevent form submit when offline\nwindow.addEventListener('offline', function(){\n\tdocument.querySelectorAll('.form_submit').forEach(btn=>{\n\t\tbtn.disabled = true;\n\t\tif(btn.querySelector('.online') == null){\n\t\t\tbtn.innerHTML = '<div class=\"online\">'+btn.innerHTML+'</div>';\n\t\t}\n\t\tbtn.innerHTML += '<div class=\"offline\">You are offline</div>'\n\t});\n});\n\ndocument.addEventListener('click', function(event) {\n\tlet target = event.target;\n\t\n\t//add element\n\tif(target.matches('.add')){\n\t\tlet orgNode\t= target.closest(\".clone_div\");\n\n\t\tlet newNode = copyFormInput(orgNode);\n\n\t\t// Fix in nodes\n\t\tfixNumbering(target.closest('.clone_divs_wrapper'));\n\n\t\t//add tinymce's can only be done when node is inserted and id is unique\n\t\tnewNode.querySelectorAll('.wp-editor-area').forEach((el, index) =>{\n\t\t\t// find org node settings\n\t\t\tlet tn = tinymce.get(orgNode.querySelectorAll('.wp-editor-area')[index].id);\n\t\t\tif(tn != null){\n\t\t\t\tlet settings\t= tn.settings;\n\n\t\t\t\t// update the settings for the clone\n\t\t\t\tfor (const key in settings) {\n\t\t\t\t\tconsole.log(`${key}: ${settings[key]}`);\n\n\t\t\t\t\tif(typeof(settings[key]) == 'string'){\n\t\t\t\t\t\tsettings[key]\t= settings[key].replace(\n\t\t\t\t\t\t\t/(.*)([0-9])/, \n\t\t\t\t\t\t\t(match, prefix, nr) => {\n\t\t\t\t\t\t\t\tconst newNumber = parseInt(nr) + 1;\n\t\t\t\t\t\t\t\treturn prefix + newNumber;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttinymce.init(settings);\n\t\t\t\t//window.tinyMCE.execCommand('mceAddEditor', false, el.id);\n\t\t\t}\n\t\t});\n\n\t\ttarget.remove();\n\t}\n\t\n\t//remove element\n\tif(target.matches('.remove')){\n\t\t//Remove node clicked\n\t\tremoveNode(target);\n\t}\n\n\tif(target.matches('.sim-form-wrapper [name=\"submit_form\"]')){\n\t\tevent.stopPropagation();\n\t\t\n\t\tsaveFormInput(target);\n\t}\n\n\tif(target.matches('.formbuilder-switch') || target.matches('.formbuilder-switch-back')){\n\t\tformbuilderSwitch(target);\n\t}\n\n\tif(target.matches('.archive-switch-hide') || target.matches('.archive-switch-show')){\n\t\tarchivedEntriesSwitch(target);\n\t}\n\n\tif(target.matches('.onlyown-switch-all') || target.matches('.onlyown-switch-on')){\n\t\tonlyOwnSwitch(target);\n\t}\n});\n\ndocument.addEventListener('change', ev=>{\n\t// select all elements with a datalist attached\n\tif(ev.target.matches('input[list]') && ev.target.name.includes('[')){\n\t\tlet el\t\t= ev.target.list.querySelector(`[value=\"${ev.target.value}\" i]`);\n\n\t\tif(el != null){\n\t\t\t// find the dataset value of the given element value\n\t\t\tlet value\t= el.dataset.value;\n\n\t\t\tif(value != undefined){\n\t\t\t\t// change the value to create extra inputs if necessary\n\t\t\t\tchangeFieldValue(ev.target, value, '', ev.target.closest('form'));\n\t\t\t}\n\t\t}\n\t}\n})","import { getFieldValue } from './field_value.js';\r\n\r\nlet oldValue;\r\n\r\nconsole.log(\"Table.js loaded\");\r\n\r\nfunction outsideClicked(event){\r\n\tif(event.target.closest('td') == null || !event.target.closest('td').matches('.editing')){\r\n\t\tevent.stopPropagation();\r\n\t\t\r\n\t\t//remove as soon as we come here\r\n\t\tdocument.removeEventListener('click', outsideClicked);\r\n\t\tprocessInput(event, document.querySelector('.editing input, .editing select, .editing textarea'));\r\n\t}\r\n}\r\n\r\nfunction addInputEventListeners(cell){\r\n\tlet inputs\t= cell.querySelectorAll('input,select,textarea');\r\n\t\t\r\n\tinputs.forEach(inputnode => {\r\n\t\t//add old value\r\n\t\toldValue.split(',').forEach(val=>{\r\n\t\t\tif(inputnode.type == 'checkbox' || inputnode.type == 'radio'){\r\n\t\t\t\tif(inputnode.value == val.trim()){\r\n\t\t\t\t\tinputnode.checked = true;\r\n\t\t\t\t}\r\n\t\t\t}else if(inputnode.type == 'select'){\r\n\t\t\t\tinputnode.querySelector('option[value=\"'+val+'\"]').selected = true;\r\n\t\t\t}else{\r\n\t\t\t\tinputnode.value\t= oldValue;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tif(inputnode.type == 'select-one' && inputnode._niceselect == undefined){\r\n\t\t\tMain.attachNiceSelect(inputnode);\r\n\t\t}\r\n\t\t\r\n\t\t//Add a keyboard\r\n\t\tinputnode.addEventListener(\"keyup\", function(event){\r\n\t\t\tif (event.keyCode === 13) {\r\n\t\t\t\tprocessInput(event);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t//add a listener for clicks outside the cell\r\n\t\tdocument.addEventListener('click', outsideClicked);\r\n\t\t\r\n\t\tif(inputnode.type != 'checkbox' || inputs.length == 1){\r\n\t\t\tif(inputnode.type == 'date'){\r\n\t\t\t\tinputnode.addEventListener(\"blur\", function(event){\r\n\t\t\t\t\t//only process if we added a value\r\n\t\t\t\t\tif(event.target.value != ''){\r\n\t\t\t\t\t\tprocessInput(event);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\tinputnode.addEventListener(\"change\", function(event){\r\n\t\t\t\t\t//only process if we added a value\r\n\t\t\t\t\tif(event.target.value != ''){\r\n\t\t\t\t\t\tprocessInput(event);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tinputnode.focus();\r\n\t\t}\r\n\t});\r\n}\r\n\r\n//function to change a cells contents\r\nfunction editTd(target){\r\n\ttarget.closest('td').classList.add('editing');\r\n\r\n\t//element is already edited\r\n\r\n\toldValue\t= target.textContent;\r\n\tif (oldValue == \"Click to update\" || oldValue == \"X\"){\r\n\t\toldValue = \"\";\r\n\t}\r\n\t\r\n\ttarget.innerHTML = `<input type=\"text\" value=\"${oldValue}\">`;\r\n\r\n\taddInputEventListeners(target);\r\n}\r\n\r\n//function to get the temp input value and save it using the rest api\r\nasync function processInput(event, target){\r\n\tif(typeof(target) == 'undefined'){\r\n\t\ttarget\t= event.target;\r\n\t}\r\n\t\r\n\tlet cell \t\t\t= target.closest('td');\t\r\n\tlet value\t\t\t= getFieldValue(target, cell, false);\r\n\tlet table\t\t\t= target.closest('table');\r\n\t\r\n\t//Only update when needed\r\n\tif (value != oldValue){\t\t\r\n\t\t//get the updated fieldname from the column header\r\n\t\tlet formData = new FormData();\r\n\t\tformData.append('value', JSON.stringify(value));\r\n\r\n\t\tfor( let key in cell.dataset){\r\n\t\t\tformData.append(key, cell.dataset[key]);\r\n\t\t}\r\n\t\tfor( let key in target.closest('tr').dataset){\r\n\t\t\tformData.append(key, target.closest('tr').dataset[key]);\r\n\t\t}\r\n\t\t\r\n\t\tMain.showLoader(cell.firstChild);\r\n\t\t\r\n\t\tlet response = await FormSubmit.fetchRestApi(table.dataset.url, formData);\r\n\r\n\t\tif(response){\r\n\t\t\tcell.innerHTML = value;\r\n\r\n\t\t\t//reset editing indicator\r\n\t\t\t//let editedel = '';\r\n\t\t}\r\n\t}else{\r\n\t\tconsole.log(value)\r\n\t\ttarget.closest('td').innerHTML = oldValue;\r\n\t}\r\n\r\n\tcell.classList.remove('editing');\r\n}\r\n\r\n//function to sort a table by column\r\nfunction sortTable(target){\r\n\tlet table \t\t\t= target.closest('table');\r\n\tlet switching\t \t= true;\r\n\tlet x,y, rows;\r\n\tvar sort \t\t= 'asc';\r\n\t\r\n\t//Check the sort order\r\n\tif (target.classList.contains('desc')){\r\n\t\tsort \t\t= 'desc';\r\n\t}\r\n\t\r\n\t/*Make a loop that will continue until\r\n\tno switching has been done:*/\r\n\twhile (switching) {\r\n\t\t//start by saying: no switching is done:\r\n\t\tswitching\t= false;\r\n\t\trows\t\t= table.rows;\r\n\t\t/*Loop through all table rows (except the\r\n\t\tfirst, which contains table headers):*/\r\n\t\tfor (let i = 1; i < (rows.length - 1); i++) {\r\n\t\t\t// Get the lowercase cell contents\r\n\t\t\tx = rows[i].getElementsByTagName(\"TD\")[target.cellIndex].innerHTML.toLowerCase();\r\n\t\t\ty = rows[i + 1].getElementsByTagName(\"TD\")[target.cellIndex].innerHTML.toLowerCase();\r\n\t\t\t\r\n\t\t\t//check if numeric\r\n\t\t\tif(!isNaN(x) && !isNaN(y)){\r\n\t\t\t\tx = parseFloat(x);\r\n\t\t\t\ty = parseFloat(y);\r\n\t\t\t}else{\r\n\t\t\t\t//check if these are dates\r\n\t\t\t\tlet datex = new Date(x);\r\n\t\t\t\tlet datey = new Date(y);\r\n\t\t\t\tif(datex !== \"Invalid Date\" && !isNaN(datex) && datex.getYear()!=70 && datey !== \"Invalid Date\" && !isNaN(datey) && datey.getYear()!=70){\r\n\t\t\t\t\tx = datex.getTime();\r\n\t\t\t\t\ty = datey.getTime();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//check if the two rows should switch place ASC:\r\n\t\t\tif ((sort == 'asc' && x > y) || (sort == 'desc'  && y > x)) {\r\n\t\t\t\t//Switch positions of the rows and start over\r\n\t\t\t\trows[i].parentNode.insertBefore(rows[i + 1], rows[i]);\r\n\t\t\t\tswitching = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t//Mark the row to sort desc the next time\r\n\tif (sort == 'asc'){\r\n\t\ttarget.classList.add('desc');\r\n\t\ttarget.classList.replace('asc', 'desc');\r\n\t//Mark the row to sort asc the next time\r\n\t}else{\r\n\t\ttarget.classList.replace('desc', 'asc');\r\n\t}\r\n}\r\n\r\n//Store the table headers as td attribute for use on smaller screens\r\nexport function setTableLabel() {\r\n\t//Loop over all tables\r\n\tdocument.querySelectorAll('.sim-table').forEach(function(table){\r\n\t\t//Get all heading elements\r\n\t\tlet tdLabels = [];\r\n\t\ttable.querySelectorAll('thead th').forEach((el,index) => {\r\n\t\t\tif(el.dataset.nicename != null){\r\n\t\t\t\ttdLabels[index]\t= el.dataset.nicename;\r\n\t\t\t}else{\r\n\t\t\t\ttdLabels[index]\t= el.textContent;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t//loop over all table rows\r\n\t\ttable.querySelectorAll('tbody td').forEach( (td) => {\r\n\t\t\tif(!td.hasAttribute('label') && tdLabels[td.cellIndex] != undefined){\r\n\t\t\t\t//set the header text as label\r\n\t\t\t\ttd.setAttribute('label', tdLabels[td.cellIndex]);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(td.textContent == 'X' || td.textContent == ''){\r\n\t\t\t\ttd.classList.add('mobile-hidden');\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\nasync function showFullscreen(target){\r\n\ttarget.textContent\t= 'Close full screen';\r\n\ttarget.classList.replace('show', 'close');\r\n\r\n\tlet parent\t= target.closest('.table-wrapper');\r\n\r\n\t//store current y position\r\n\twindow.lastY\t= window.pageYOffset;\r\n\r\n\twindow.scrollTo(0,0);\r\n\r\n\t// remove scrollbars from body\r\n\tdocument.querySelector('body').style.overflow\t= 'hidden';\r\n\r\n\tdocument.querySelector('header').style.zIndex\t= 'unset';\r\n\r\n\tparent.classList.add('fullscreen');\r\n\r\n\tparent.style.marginLeft\t= '0px';\r\n\r\n\tlet url = new URL(window.location);\r\n\r\n\turl.searchParams.set('fullscreen', parent.querySelector('table').dataset.formid);\r\n\r\n\twindow.history.pushState({}, '', url);\r\n\r\n\tsetTableHeight();\r\n\r\n\tparent.requestFullscreen().catch((err) => {\r\n\t\t// does not work without user interaction\r\n\t});\r\n}\r\n\r\nfunction closeFullscreen(target){\r\n\tlet lastY\t= 100;\r\n\r\n\ttarget.textContent\t= 'Show full screen';\r\n\ttarget.classList.replace('close','show');\r\n\r\n\tif(window.lastY != undefined){\r\n\t\tlastY\t= window.lastY;\r\n\t}\r\n\twindow.scrollTo(0, lastY);\r\n\t\r\n\tconsole.log('scrolling')\r\n\r\n\t// remove scrollbars from body\r\n\tdocument.querySelector('body').style.overflow\t= 'unset';\r\n\r\n\tdocument.querySelector('header').style.zIndex\t= '99999';\r\n\r\n\ttarget.closest('.table-wrapper').classList.remove('fullscreen');\r\n\r\n\tpositionTable();\r\n\r\n\tlet url = new URL(window.location);\r\n\r\n\turl.searchParams.delete('fullscreen');\r\n\r\n\twindow.history.pushState({}, '', url);\r\n\r\n\tdocument.exitFullscreen();\r\n\r\n\tsetTableHeight();\r\n}\r\n\r\nfunction setTableHeight(){\r\n\tlet urlParams = new URLSearchParams(window.location.search);\r\n\tlet\tfullscreen\t= urlParams.get('fullscreen');\r\n\r\n\t// calculate how heigh the table should be\r\n\tlet footerHeight, headerHeight;\r\n\tdocument.querySelectorAll('.sim-table').forEach( table => {\r\n\t\tlet wrapper\t= table.closest('.table-wrapper');\r\n\t\tif(wrapper == null){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif(fullscreen != null){\r\n\t\t\theaderHeight\t= 0;\r\n\t\t\twrapper.querySelectorAll('.table-head').forEach(el=> headerHeight = el.offsetHeight);\r\n\t\t}else{\r\n\t\t\theaderHeight\t= document.querySelector('header').offsetHeight;\r\n\t\t}\r\n\t\t\r\n\t\tfooterHeight\t= 0;\r\n\t\twrapper.querySelectorAll('.sim-table-footer').forEach(el=> footerHeight\t= el.offsetHeight);\r\n\r\n\t\tlet px\t= headerHeight + footerHeight + 40;\r\n\t\ttable.style.maxHeight\t= `calc(100vh - ${px}px)`;\r\n\t});\t\r\n}\r\n\r\nexport function positionTable(){\r\n\t//use whole page width for tables\r\n\tdocument.querySelectorAll(\".table-wrapper\").forEach(wrapper=>{\r\n\t\tlet offset\t\t= '';\r\n\t\tlet newX\t\t= 0;\r\n\r\n\t\tlet table\t= wrapper.querySelector('table');\r\n\t\tif(table == null){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet width\t= table.scrollWidth;\r\n\t\tif(width == 0){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\t// If on small width use full screen\r\n\t\tif(window.innerWidth < 570){\r\n\t\t\toffset\t= wrapper.getBoundingClientRect().x\r\n\t\t}else{\r\n\t\t\tlet diff\t= window.innerWidth - width;\r\n\t\t\t\r\n\t\t\t//calculate if room for sidebar if one exists\r\n\t\t\tif((width/window.innerWidth) < 0.7){\r\n\t\t\t\tif(document.querySelector('.is-right-sidebar') != null){\r\n\t\t\t\t\tdiff\t= (window.innerWidth * 0.7) - width;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tdocument.getElementById('primary').style.zIndex = 1;\r\n\r\n\t\t\t\t//sidebar behind table\r\n\t\t\t\tdocument.querySelectorAll('#right-sidebar').forEach(el=>el.style.zIndex = 0);\r\n\t\t\t}\r\n\r\n\t\t\t//Table needs full screen width\r\n\t\t\tif(diff < 20){\r\n\t\t\t\tnewX = 10;\r\n\t\t\t//center the table\r\n\t\t\t}else{\r\n\t\t\t\tnewX = diff/2; \r\n\t\t\t}\t\t\t\r\n\t\t\t\r\n\t\t\t//first set it back to default\r\n\t\t\tif(wrapper.style.marginLeft != ''){\r\n\t\t\t\twrapper.style.marginLeft = '-0px';\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//then calculate the required offset\r\n\t\t\toffset\t= parseInt(wrapper.getBoundingClientRect().x)-newX;\r\n\t\t}\r\n\r\n\t\twrapper.style.marginLeft = `-${offset}px`;\r\n\t});\r\n}\r\n\r\ndocument.addEventListener(\"click\", event=>{\r\n\tlet target = event.target;\r\n\t\r\n\tif(target.tagName == 'TH'){\r\n\t\tsortTable(target);\r\n\t}\r\n\t\r\n\t//Edit data\r\n\tlet td = target.closest('td');\r\n\tif(target.matches('td.edit')){\r\n\t\tevent.stopPropagation();\r\n\t\teditTd(target);\r\n\t}else if(td != null && td.matches('td.edit') && target.tagName != 'INPUT' && target.tagName != 'A' && target.tagName != 'TEXTAREA' && !target.closest('.nice-select') ){\r\n\t\tevent.stopPropagation();\r\n\t\teditTd(target.closest('td'));\r\n\t}else if(target.matches('.show.fullscreenbutton')){\r\n\t\tshowFullscreen(target);\r\n\t}else if(target.matches('.close.fullscreenbutton')){\r\n\t\tcloseFullscreen(target);\r\n\t}\r\n});\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", function() {\r\n\t\r\n\tpositionTable();\r\n\twindow.addEventListener('resize', positionTable);\r\n\t\r\n\t//add label attribute\r\n\tsetTableLabel();\r\n\r\n\tlet urlParams = new URLSearchParams(window.location.search);\r\n\tlet\tfullscreen\t= urlParams.get('fullscreen');\r\n\r\n\tif(fullscreen != null){\r\n\t\ttry{\r\n\t\t\tshowFullscreen(document.querySelector(`table[data-formid=\"${fullscreen}\"]`).closest('.table-wrapper').querySelector('.fullscreenbutton')); \r\n\t\t}catch{\r\n\t\t\tconsole.error(`table[data-formid=\"${fullscreen}\"]`);\r\n\t\t}\r\n\t}\r\n\r\n\tsetTableHeight();\r\n});\r\n","import { cloneNode } from \"../../forms/js/forms\";\r\nimport { setTableLabel } from \"../../../plugins/sim-plugin/includes/js/table.js\";\r\n\r\nconsole.log(\"library.js loaded\");\r\n\r\nasync function addBook(target){\r\n\tlet cell\t\t\t= target.closest('td');\r\n\tlet row\t\t\t\t= target.closest('tr');\r\n\tlet formData\t\t= new FormData();\r\n\r\n\trow.querySelectorAll('input, textarea').forEach(input => {\r\n\t\tif(input.type != 'checkbox' || input.checked){\r\n\t\t\tformData.append(input.name, input.value);\r\n\t\t}\r\n\t});\r\n\r\n\trow.querySelectorAll('td > img').forEach(img=>formData.append('image', img.src));\r\n\r\n\ttarget.classList.add('hidden');\r\n\tcell.querySelector(`.loadergif_wrapper`).classList.remove('hidden');\r\n\r\n\tlet response\t= await FormSubmit.fetchRestApi('library/add_book', formData);\r\n\t\r\n\tif(response){\r\n\t\tcell.innerHTML\t= response;\r\n\r\n\t\tMain.displayMessage(response.message);\r\n\t}else{\r\n\t\ttarget.classList.remove('hidden');\r\n\t\tcell.querySelector(`.loadergif_wrapper`).classList.add('hidden');\r\n\r\n\t\ttarget.remove();\r\n\t}\r\n}\r\n\r\nlet fileUploadWrap, totalFiles;\r\nasync function fileUpload(target, location){\r\n\ttotalFiles \t\t= target.files.length;\r\n\r\n\tif (totalFiles < 0){\r\n\t\treturn;\r\n\t}\r\n\t\r\n\t//Create a formData element\r\n\tlet formData = new FormData();\r\n\t\r\n\t//Add the ajax action name\r\n\tformData.append('action', 'process_library_upload');\r\n\r\n\tformData.append('location', location);\r\n\r\n\t//Add all the files to the formData\r\n\tfor (let index = 0; index < totalFiles; index++) {\r\n\t\tlet file\t= target.files[index];\r\n\t\tformData.append('files[]', file);\r\n\t}\r\n\t\r\n\t//AJAX request\r\n\tlet request = new XMLHttpRequest();\r\n\t\r\n\t//Listen to the state changes\r\n\trequest.onreadystatechange = readyStateChanged;\r\n\t\r\n\t//Listen to the upload status\r\n\trequest.upload.addEventListener('progress', fileUploadProgress, false);\r\n\t\r\n\trequest.open('POST', sim.ajaxUrl, true);\r\n\t\r\n\t//Show loading gif\r\n\tfileUploadWrap.querySelectorAll(\".loadergif_wrapper\").forEach(loader =>{\r\n\t\tloader.classList.remove('hidden');\r\n\t\tloader.querySelectorAll(\".uploadmessage\").forEach(el =>{\r\n\t\t\tel.textContent = \"Preparing upload\";\r\n\t\t\tel.classList.add('upload-message');\r\n\t\t});\r\n\t});\r\n\t\r\n\t//Send AJAX request\r\n\tfileUploadWrap.querySelector('.uploadmessage').textContent = \"Uploading Picture(s)\";\r\n\tdocument.getElementById('progress-wrapper').classList.remove('hidden');\r\n\r\n\trequest.send(formData);\r\n}\r\n\r\nfunction fileUploadProgress(e){\r\n\tif(e.lengthComputable){\r\n\t\tlet max \t\t= e.total;\r\n\t\tlet current \t= e.loaded;\r\n\r\n\t\tlet percentage \t= (current * 100)/max;\r\n\t\tpercentage \t\t= Math.round(percentage*10)/10\r\n\t\t\r\n\t\tdocument.querySelectorAll(\"#upload_progress\").forEach(el=>el.value = percentage);\r\n\t\tdocument.querySelectorAll(\"#progress_percentage\").forEach(el=>el.textContent\t= `   ${percentage}%`);\r\n\r\n\t\tif(percentage >= 99){\r\n\t\t\t//Remove progress barr\r\n\t\t\tdocument.getElementById(\"progress-wrapper\").classList.add('hidden');\r\n\t\t\t\r\n\t\t\t// process completed\r\n\t\t\tfileUploadWrap.querySelectorAll(\".uploadmessage\").forEach(el =>{\r\n\t\t\t\t//Change message text\r\n\t\t\t\tif (totalFiles > 1){\r\n\t\t\t\t\tel.textContent = \"Processing images\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\tel.textContent = \"Processing image\";\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}  \r\n}\r\n\r\nfunction readyStateChanged(e){\r\n\tlet request\t= e.target;\r\n\t\r\n\t//If finished\r\n\tif(request.readyState == 4){\r\n\t\t//Success\r\n\t\tif (request.status >= 200 && request.status < 400) {\r\n\t\t\tfileUploadSucces(request.responseText)\r\n\t\t//Error\r\n\t\t}else{\r\n\t\t\tconsole.error(request.responseText);\r\n\t\t\tMain.displayMessage(JSON.parse(request.responseText).error,'error');\r\n\t\t}\r\n\t\t\r\n\t\t//Hide loading gif\r\n\t\tdocument.querySelectorAll(\".loadergif_wrapper\").forEach(\r\n\t\t\tfunction(loader){\r\n\t\t\t\tloader.classList.add('hidden');\r\n\t\t\t}\r\n\t\t);\r\n\t\t\t\r\n\t\t//Clear the input\r\n\t\tfileUploadWrap.querySelector('input[type=\"file\"]').value = \"\";\r\n\t}\r\n}\r\n\r\nasync function fileUploadSucces(result){\r\n\tfileUploadWrap.innerHTML\t= JSON.parse(result).data + fileUploadWrap.innerHTML;\r\n\r\n\tMain.displayMessage(\"The files have been processed succesfully.\", 'success', true);\r\n\r\n\tfileUploadWrap.querySelector('.image-selector-wrap').classList.remove('hidden');\r\n\r\n\t// Create a custom event so others can listen to it.\r\n\t// Used by formstable uploads\r\n\tconst event = new Event('uploadfinished');\r\n\tfileUploadWrap.dispatchEvent(event);\r\n\r\n\tawait fetchMetaDatas();\r\n\r\n\t// Run this only when all rows are processed\r\n\tsetTableLabel();\r\n}\r\n\r\nasync function fetchMetaDatas(){\r\n\tlet promiseArray = [];\r\n\r\n\tfileUploadWrap.querySelectorAll('table tr').forEach(async (tr) => {\r\n\t\tpromiseArray.push(fetchMetaData(tr));\r\n\t});\r\n\r\n\tawait Promise.all(promiseArray);\r\n}\r\n\r\nasync function fetchMetaData(tr){\r\n\ttry{\r\n\t\t// Check if a book row\r\n\t\tif(tr.querySelector('.title') == null){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet title\t= tr.querySelector('.title').value;\r\n\r\n\t\t// Only search for the first author\r\n\t\tlet author\t= tr.querySelector('.author').value.trim();\r\n\t\tlet url     = `https://openlibrary.org/search.json?q=`+encodeURIComponent(`title:${title}`);\r\n\t\tif(author != ''){\r\n\t\t\turl += encodeURIComponent(` author:${author}`)+'&limit=1';\r\n\t\t}\r\n\t\turl += '&fields=key,title,author_name,subtitle,alternative_subtitle,cover_i,language,number_of_pages_median,first_publish_year,description,subjects';\r\n\r\n\t\tconst response \t= await fetch(url);\r\n\t\tconst data \t\t= await response.json();\r\n\t\tlet bookData    = data['docs'][0] ?? [];\r\n\r\n\t\t// If no book data found, create a list with possible authors\r\n\t\tif(bookData.length == 0 && author == ''){\r\n\t\t\tlet id\t= `authorlist-${title.replaceAll(\" \", \"_\").replaceAll(\"'\", \"\")}`;\r\n\t\t\ttr.querySelectorAll('.author').forEach(el => el.setAttribute(\"list\", id));\r\n\r\n\t\t\tlet list = `<datalist id='${id}' class='author-selection'>`;\r\n\r\n\t\t\tdata['docs'].forEach((doc) => {\r\n\t\t\t\tif(doc['author_name'] != undefined){\r\n\t\t\t\t\tlist += `<option value='${doc['author_name'].join()}'>`;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tlist += `</datalist>`;\r\n\t\t\ttr.querySelector('.authors').insertAdjacentHTML('afterEnd', list);\r\n\t\t}else{\r\n\t\t\tlet authors \t= bookData['author_name'] ?? [author];\r\n\t\t\tlet wrapper \t= tr.querySelector(`.authors.clone_divs_wrapper`);\r\n\t\t\tlet baseElement = wrapper.querySelector(`.clone_div`);\r\n\r\n\t\t\tauthors.forEach(author => {\r\n\t\t\t\tlet clone\t\t= cloneNode(baseElement);\r\n\t\t\t\tclone.querySelector('.author').value = author;\r\n\r\n\t\t\t\twrapper.appendChild(clone);\r\n\t\t\t});\t\t\r\n\t\t\t\r\n\t\t\tbaseElement.remove()\r\n\t\t}\r\n\r\n\t\tlet image        = bookData['cover_i'] ?? '';\r\n        if(image != ''){\r\n           \tlet  smallUrl    = `https://covers.openlibrary.org/b/id/${image}-S.jpg`;\r\n\t\t   \tlet  largeUrl    = `https://covers.openlibrary.org/b/id/${image}-L.jpg`;\r\n\r\n\t\t\ttr.querySelector('.image').innerHTML = `<input type='hidden' name='image' value='${image}'><a href='${largeUrl}' target='_blank'><img src='${smallUrl}' class='book-image' loading='lazy'></a>`;\r\n        }\r\n\r\n\t\tlet subtitle\t= bookData['subtitle'] ?? '';\r\n\r\n\t\tlet year\t\t= bookData['first_publish_year'] ?? '';\r\n\t\tyear\t\t\t= year[0] ?? year;\r\n\r\n\t\tlet language\t= bookData['language'] ?? '';\r\n\t\tlanguage\t\t= language[0] ?? language;\r\n\r\n\t\tlet pageCount\t\t= bookData['number_of_pages'] ?? bookData['number_of_pages_median'] ?? '';\r\n\r\n\t\tlet html = `<td><input type='text' name='subtitle' class='subtitle' value='${subtitle}'></td>`;\r\n\t\thtml += `<td><input type='text' name='series' class='series' value='${bookData['series'] ?? ''}'></td>`;\r\n\t\thtml += `<td><input type='text' name='year' class='year' value='${year}'></td>`;\r\n\t\thtml += `<td><input type='text' name='language' class='language' value='${language}'></td>`;\r\n\t\thtml += `<td><input type='text' name='pages' class='pages' value='${pageCount}'></td>`;\r\n\r\n\t\tlet placeholder\t= tr.querySelector('.placeholder');\r\n\t\tif(placeholder == null){\r\n\t\t\ttr.querySelector('.subtitle').value = subtitle;\r\n\t\t\ttr.querySelector('.series').value \t= bookData['series'] ?? '';\r\n\t\t\ttr.querySelector('.year').value \t= year;\r\n\t\t\ttr.querySelector('.language').value = language;\r\n\t\t\ttr.querySelector('.pages').value \t= pageCount;\r\n\t\t}else{\r\n\t\t\tplaceholder.outerHTML = html;\r\n\t\t}\r\n\r\n        let summary      \t= tr.querySelector('.summary').value\r\n\t\tsummary\t\t\t\t= bookData['description'] != undefined ? bookData['description']['value'] != undefined ? bookData['description']['value'] : '' : '';\r\n\r\n\t\tlet key        = bookData['key'] ?? '';\r\n        if(key != ''){\r\n            url      = `https://openlibrary.org${key}`;\r\n\t\t\ttr.querySelector('.url').innerHTML = `\r\n\t\t\t<input type='hidden' name='url' value='${url}'>\r\n\t\t\t<a href='${url}' target='_blank'>View on Open Library</a>\r\n\t\t\t`;\r\n\r\n\t\t\t// Fetch the summary from the Open Library API\r\n\t\t\tconst workResponse \t= await fetch(url+'.json');\r\n\t\t\tconst workJson \t\t= await workResponse.json();\r\n\r\n\t\t\tsummary = workJson['description'] ?? '';\t\r\n\t\t\t\r\n\t\t\tsummary = summary.value ?? summary;\r\n\r\n\t\t\tif(\tworkJson['subjects'] != undefined ){\r\n\t\t\t\tworkJson['subjects'].forEach((subject) => {\r\n\t\t\t\t\ttr.querySelectorAll(`.category[data-name=\"${subject}\"]`).forEach((el) => el.checked = true);\r\n\t\t\t\t});\r\n\t\t\t}\r\n        }\r\n\r\n\t\tif(summary != ''){\r\n\t\t\ttr.querySelector('.summary').value = summary;\r\n\t\t}\r\n\r\n\t} catch(e){\r\n\t\tconsole.error('Error fetching book data:', e);\r\n\t}\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", function() {\r\n\t\r\n\r\n});\r\n\r\ndocument.addEventListener(\"click\", event =>{\r\n\tlet target = event.target;\r\n\r\n\tif(fileUploadWrap != undefined && target.matches(`.add-books`)){\r\n\t\tfileUploadWrap.querySelectorAll('.image-preview, .book.table-wrapper').forEach(el => el.remove());\r\n\t}else if(target.matches(`.add-book`)){\r\n\t\taddBook(target);\r\n\t}else if(target.matches(`.delete-book`)){\r\n\t\ttarget.closest('tr').remove();\r\n\t}\r\n});\r\n\r\ndocument.addEventListener(\"change\", async event =>{\r\n\tlet target = event.target;\r\n\r\n\tif(target.name == 'image-selector' && target.files.length > 0){\r\n\t\tfileUploadWrap\t= target.closest('.file_upload_wrap');\r\n\t\t\r\n\t\t// Make sure we have a location\r\n\t\tlet location\t= fileUploadWrap.querySelector(`.book-location`);\r\n\t\tconst isValid \t= location.reportValidity();\r\n\t\tif (!isValid) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlocation = location.value;\r\n\t\t\r\n\t\t// Remove previous result tables\r\n\t\tdocument.querySelectorAll('.book-table-wrapper').forEach(el => el.remove());\r\n\t\t\r\n\t\ttarget.closest('.image-selector-wrap').classList.add('hidden');\r\n\t\tfileUploadWrap.querySelectorAll('.image-preview').forEach(el => el.remove());\r\n\t\t\r\n\t\tfor (const file of target.files) {\r\n\t\t\tlet reader = new FileReader();\r\n\r\n\t\t\treader.onload = function(e) {\r\n\t\t\t\tlet div \t\t\t= document.createElement('div');\r\n\t\t\t\tdiv.classList.add('image-preview');\r\n\r\n\t\t\t\tlet img \t\t\t= document.createElement('img');\r\n\t\t\t\timg.src \t\t\t= e.target.result;\r\n\t\t\t\timg.classList.add('book-image');\r\n\t\t\t\timg.style.maxHeight\t= \"100px\";\r\n\t\t\t\timg.style.padding\t=  \"0\";\r\n\r\n\t\t\t\tdiv.appendChild(img);\r\n\t\t\t\t\r\n\t\t\t\tfileUploadWrap.prepend(div);\r\n\t\t\t}\r\n\t\t\treader.readAsDataURL(file);\r\n\r\n\t\t\tfileUpload(target, location);\r\n\t\t}\r\n\t}else if(target.matches('.title, .author')){\r\n\t\tlet tr = target.closest('tr');\r\n\t\t\r\n\t\t// Update metadata for the book row\r\n\t\tawait fetchMetaData(tr);\r\n\t}\r\n});"],"names":["scripts","afterScriptsLoaded","attachTo","tinymce","remove","document","querySelectorAll","forEach","el","window","tinyMCE","execCommand","id","dispatchEvent","Event","bubbles","cancelable","addEventListener","ev","area","closest","querySelector","panel","style","visibility","target","matches","display","select","Main","attachNiceSelect","addScripts","undefined","length","shift","tagName","getElementById","s","createElement","type","src","innerHTML","head","appendChild","error","console","bind","getFieldValue","orgName","form","checkDatalist","compareValue","lowercase","name","value","selector","Element","match","trace","log","getRadioValue","elements","checked","push","getCheckboxValue","dataset","list","origInput","getDataListValue","endsWith","elem","getMultiValue","toLowerCase","removeDefaultSelect","Array","from","options","option","defaultSelected","oldValue","fileUploadWrap","totalFiles","tinymceSettings","cloneNode","originalNode","clear","tn","get","settings","save","prepareForCloning","newNode","dropdown","init","input","copyFormInput","uploadButton","index","nodeNr","previewDiv","i","previousVal","getElementsByTagName","selectedIndex","html","insertAdjacentHTML","classList","add","orgButton","newButton","parentNode","insertBefore","nextSibling","fixNumbering","wrapper","updateNumbers","clone","replace","textContent","divid","contains","removeNode","node","allCloneDivs","addElement","prev","previousElementSibling","changeFieldValue","functionRef","addition","forceValue","targets","test","date","Date","setDate","getDate","parseInt","toISOString","split","element","splitted","year","month","day","nr","dataListOption","val","evt","async","requestNewFormResults","button","outerHTML","formData","FormData","formId","formid","shortcodeId","shortcodeid","append","url","URL","location","searchParams","loader","showLoader","response","FormSubmit","fetchRestApi","outsideClicked","event","stopPropagation","removeEventListener","processInput","editTd","cell","inputs","inputnode","trim","selected","_niceselect","keyCode","focus","addInputEventListeners","table","JSON","stringify","key","firstChild","setTableLabel","tdLabels","nicename","td","hasAttribute","cellIndex","setAttribute","showFullscreen","parent","lastY","pageYOffset","scrollTo","overflow","zIndex","marginLeft","set","history","pushState","setTableHeight","requestFullscreen","catch","err","footerHeight","headerHeight","fullscreen","URLSearchParams","search","offsetHeight","px","maxHeight","positionTable","offset","newX","width","scrollWidth","innerWidth","getBoundingClientRect","x","diff","files","file","request","XMLHttpRequest","onreadystatechange","readyStateChanged","upload","fileUploadProgress","open","sim","ajaxUrl","send","e","lengthComputable","max","total","percentage","loaded","Math","round","readyState","status","result","parse","data","displayMessage","promiseArray","tr","fetchMetaData","Promise","all","fetchMetaDatas","fileUploadSucces","responseText","title","author","encodeURIComponent","fetch","json","bookData","replaceAll","doc","join","authors","baseElement","image","smallUrl","largeUrl","subtitle","language","pageCount","placeholder","summary","workResponse","workJson","subject","btn","disabled","orgNode","prefix","required","submitForm","reset","formReset","saveFormInput","delete","temp","prototype","slice","call","js","children","concat","css","addStyles","formbuilderSwitch","archivedEntriesSwitch","onlyOwnSwitch","includes","y","rows","switching","sort","isNaN","datex","datey","getYear","getTime","parseFloat","sortTable","exitFullscreen","closeFullscreen","row","img","message","addBook","reportValidity","reader","FileReader","onload","div","padding","prepend","readAsDataURL"],"sourceRoot":""}