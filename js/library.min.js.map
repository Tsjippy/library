{"version":3,"file":"library.min.js","mappings":"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","sources":["webpack://library/../../../plugins/sim-plugin/includes/js/imports.js","webpack://library/../../forms/js/forms.js","webpack://library/./library.js","webpack://library/../../../plugins/sim-plugin/includes/js/field_value.js"],"sourcesContent":["export let scripts;\r\n\r\nexport let afterScriptsLoaded\t= function (attachTo){\r\n    // load \r\n    if(typeof(tinymce) != 'undefined'){\r\n        tinymce.remove();\r\n\r\n        // Activate tinyMce's again\r\n        document.querySelectorAll('.entry-content .wp-editor-area').forEach(el =>{\r\n            window.tinyMCE.execCommand('mceAddEditor', false, el.id);\r\n        });\r\n    }    \r\n\r\n    // invoke dom content loaded events\r\n    window.document.dispatchEvent(new Event(\"DOMContentLoaded\", {\r\n        bubbles: true,\r\n        cancelable: true\r\n    }));\r\n\r\n    // Somehow the visual/text switch does not work, manually fix it\r\n    document.querySelectorAll('.wp-switch-editor').forEach(el=>el.addEventListener('click', ev=>{\r\n        let area    = el.closest('.wp-editor-wrap').querySelector('.wp-editor-area');\r\n        let panel   =  el.closest('.wp-editor-wrap').querySelector('.mce-panel');\r\n        area.style.visibility='unset';\r\n        if(ev.target.matches('.switch-tmce')){\r\n           panel.style.display='block';\r\n            area.style.display='none';\r\n        }else{\r\n            panel.style.display='none';\r\n            area.style.display='block';\r\n        }\r\n    }));\r\n\r\n    //add niceselects\r\n\tdocument.querySelectorAll('select:not(.nonice,.swal2-select)').forEach(function(select){\r\n        Main.attachNiceSelect(select);\r\n\t});\r\n\r\n    const ev = new Event('scriptsloaded');\r\n\tattachTo.dispatchEvent(ev);\r\n}\r\n\r\nexport let addStyles    = function (response, attachTo){\r\n    scripts     = [];\r\n    let temp    = document.createElement('div');\r\n\r\n    // parse inline scripts\r\n    temp.innerHTML =  response.html;\r\n    scripts = Array.prototype.slice.call(temp.getElementsByTagName('script'));\r\n\r\n    if(response.js){\r\n        temp.innerHTML =  response.js;\r\n        scripts\t= [...temp.children].concat(scripts);\r\n        addScripts(attachTo);\r\n    }\r\n\r\n    if(response.css){\r\n        temp.innerHTML = response.css;\r\n        [...temp.children].forEach(el => {\r\n            document.head.appendChild(el);\r\n        });\r\n    }\r\n}\r\n\r\nexport let addScripts\t= function (attachTo) {\r\n    if(attachTo == undefined){\r\n        return;\r\n    }\r\n\r\n    if(scripts.length == 0){\r\n        afterScriptsLoaded(attachTo);\r\n    }\r\n    let el\t= scripts.shift();\r\n\r\n    if(el == undefined){\r\n        afterScriptsLoaded(attachTo);\r\n        return;\r\n    }\r\n\r\n    // only add if needed\r\n    if(el.tagName == 'SCRIPT' && document.getElementById(el.id) == null){\r\n        var s = document.createElement('script');\r\n\r\n        if(el.type == ''){\r\n            s.type\t= 'text/javascript'; \r\n        }else{\r\n            s.type\t= el.type;\r\n        }\r\n\r\n        if(el.src != ''){\r\n            s.src \t= el.src;\r\n        }else{\r\n            s.innerHTML\t= el.innerHTML;\r\n        }\r\n        \r\n        s.id\t= el.id;\r\n        \r\n        try{\r\n            document.head.appendChild(s);\r\n        }catch (error) {\r\n            console.error(error);\r\n        }\r\n\r\n        if(scripts.length > 0){\r\n            if(el.src != ''){\r\n                s.addEventListener('load', addScripts.bind( null, attachTo ) );\r\n            }else{\r\n                addScripts(attachTo);\r\n            }\r\n        }else{\r\n            if(el.src != ''){\r\n                s.addEventListener('load', afterScriptsLoaded.bind( null, attachTo));\r\n            }else{\r\n                afterScriptsLoaded(attachTo);\r\n            }\t\t\t\r\n        }\r\n    }else if(scripts.length > 0){\r\n        // get next script\r\n        addScripts(attachTo);\r\n    }else{\r\n        afterScriptsLoaded(attachTo);\r\n    }\r\n}\r\n\r\nexport function displayMessage(message, icon, autoclose=false, no_ok=false, timer=1500){\r\n\tif(message == undefined){\r\n\t\treturn;\r\n\t}\r\n\t\r\n\tif(typeof(Swal) != 'undefined'){\r\n\t\tvar options = {\r\n\t\t\ticon: icon,\r\n\t\t\ttitle: message.toString().trim(),\r\n\t\t\tconfirmButtonColor: \"#bd2919\",\r\n\t\t\tcancelButtonColor: 'Crimson'\r\n\t\t};\r\n\r\n\t\tif(no_ok){\r\n\t\t\toptions['showConfirmButton'] = false;\r\n\t\t}\r\n\t\t\r\n\t\tif(typeof(callback) == 'function'){\r\n\t\t\toptions['didClose'] = () => callback();\r\n\t\t}\r\n\t\t\r\n\t\tif(autoclose){\r\n\t\t\toptions['timer'] = timer;\r\n\t\t}\r\n\r\n        if(document.fullscreenElement != null){\r\n\t\t\toptions['target']\t= document.fullscreenElement;\r\n\t\t}\r\n\t\t\r\n\t\treturn Swal.fire(options);\r\n\t}else{\r\n\t\treturn alert(message.trim());\r\n\t}\r\n}\r\n\r\nexport function showLoader(element, replace=true, message=''){\r\n\tif(element == null){\r\n\t\treturn;\r\n\t}\r\n\t\r\n\tlet wrapper\t= document.createElement(\"DIV\");\r\n\twrapper.setAttribute('class','loaderwrapper');\r\n\tif(message != ''){\r\n\t\twrapper.innerHTML\t= message;\r\n\t}\r\n\r\n\tlet loader\t= document.createElement(\"IMG\");\r\n\tloader.setAttribute('class','loadergif');\r\n\tloader.setAttribute(\"src\", sim.loadingGif);\r\n\tloader.style[\"height\"]= \"30px\";\r\n\r\n\twrapper.insertAdjacentElement('beforeEnd', loader);\r\n\tif(replace){\r\n\t\telement.parentNode.replaceChild(wrapper, element);\r\n\t}else{\r\n        let el  = element.nextElementSibling;\r\n        if(el == null){\r\n            element.parentNode.insertAdjacentElement('beforeEnd', wrapper);\r\n        }else{\r\n            element.parentNode.insertBefore(wrapper, el);\r\n        }\r\n\t}\r\n\r\n\treturn wrapper;\r\n}\r\n\r\n//Check if on mobile\r\nexport function isMobileDevice() {\r\n    let check = false;\r\n    (function(a){if(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);\r\n    return check;\r\n}","import { addStyles } from '../../../plugins/sim-plugin/includes/js/imports.js';\nimport { getFieldValue } from  '../../../plugins/sim-plugin/includes/js/field_value.js';\nexport{ getFieldValue };\n\nconsole.log('Forms.js is loaded');\n\nasync function saveFormInput(target){\n\tlet form\t\t= target.closest('form');\n\n\t// make all inputs required if needed\n\tform.querySelectorAll('.required:not(hidden) input, .required:not(hidden) textarea, .required:not(hidden) select').forEach(el=>{\n\t\t// do not make nice select inputs nor file uploads required\n\t\tif(el.closest('div.nice-select') == null && (el.type != 'file' || el.closest('.file_upload_wrap').querySelector('.documentpreview input') == null)){\n\t\t\tel.required\t= true;\n\t\t}\n\t});\n\n\tlet response\t= await FormSubmit.submitForm(target, 'forms/save_form_input');\n\n\tif(response){\n\t\ttarget.closest('.submit_wrapper').querySelector('.loadergif').classList.add('hidden');\n\n\t\tMain.displayMessage(response);\n\n\t\tif(form.dataset.reset == 'true'){\n\t\t\tFormSubmit.formReset(form);\n\t\t}\n\t}\n}\n\nexport function removeDefaultSelect(el){\n\tArray.from(el.options).forEach(function(option){\n\t\toption.defaultSelected = false;\n\t});\n}\n\nlet tinymceSettings = [];\nfunction prepareForCloning(originalNode){\n\t//also remove any tinymce's\n\tif(typeof(tinymce) != 'undefined'){\n\t\toriginalNode.querySelectorAll('.wp-editor-area').forEach(el =>{\n\t\t\tlet tn = tinymce.get(el.id);\n\t\t\tif(tn != null){\n\t\t\t\ttinymceSettings[el.id] = tn.settings\n\t\t\t\ttn.save();\n\t\t\t\ttn.remove();\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function cloneNode(originalNode, clear=true){\n\tprepareForCloning(originalNode);\n\t\n\t//make a clone\n\tlet newNode = originalNode.cloneNode(true);\n\n\t// remove niceselect drop down from clone\n\tnewNode.querySelectorAll('.nice-select').forEach(dropdown => dropdown.remove());\n\t\n\t//add tinymce's again\n\toriginalNode.querySelectorAll('.wp-editor-area').forEach(el =>{\n\t\tif(tinymceSettings[el.id] != undefined){\n\t\t\ttinymce.init(tinymceSettings[el.id]);\n\t\t}\n\t});\n\t\n\t//clear values in the clone\n\tif(clear){\n\t\tnewNode.querySelectorAll('input,select,textarea').forEach(input => {\n\t\t\tif(input.type == 'checkbox' || input.type == 'radio'){\n\t\t\t\tinput.checked = false;\n\t\t\t}else if(input.type != 'hidden'){\n\t\t\t\tinput.value = \"\";\n\t\t\t}\n\t\t\t\n\t\t\t//if this is a select\n\t\t\tif(input.type == \"select-one\"){\n\t\t\t\t//remove any defaults\n\t\t\t\tremoveDefaultSelect(input);\n\t\t\t}\n\t\t});\n\t}\n\n\tnewNode.querySelectorAll('select').forEach(select => {\n\t\t//remove any defaults\n\t\tremoveDefaultSelect(select);\n\n\t\tMain.attachNiceSelect(select);\n\t});\n\t\n\treturn newNode;\n}\n\nexport function copyFormInput(originalNode){\n\tlet newNode = cloneNode(originalNode);\n\t\n\t//update the data index\n\tnewNode.querySelectorAll('.upload-files').forEach(function(uploadButton){\n\t\tuploadButton.dataset.index = nodeNr;\n\t})\n\t\n\t//Clear contents of any document preview divs.\n\tnewNode.querySelectorAll('.documentpreview').forEach(function(previewDiv){\n\t\tpreviewDiv.innerHTML = '';\n\t});\n\n\t//Select\n\tlet i = 0;\n\tnewNode.querySelectorAll('select').forEach(select => {\n\t\t//Find the value of the select we have cloned\n\t\tlet previousVal = originalNode.getElementsByTagName('select')[i].selectedIndex;\n\t\t\n\t\t//Hide the value in the clone\n\t\tif(select.options[previousVal] != undefined){\n\t\t\tselect.options[previousVal].style.display = 'none';\n\t\t}\n\t\t\n\t\t//Add nice select\n\t\tMain.attachNiceSelect(select);\n\t\t\n\t\ti++;\n\t});\n\t\n\t//Add remove buttons if they are not there\n\tif(originalNode.querySelector('.remove') == null && newNode.querySelector('.remove') == null){\n \t\tlet html = `<button type=\"button\" class=\"remove button\" style=\"flex: 1;\">-</button>`;\n\n\t\t//Add minus button to the first div\n\t\toriginalNode.querySelector('.buttonwrapper').insertAdjacentHTML('beforeend', html);\n\n\t\t//Add minus button to the second div\n\t\tnewNode.querySelector('.buttonwrapper').insertAdjacentHTML('beforeend', html)\n\t}\t\n\n\t// process tab buttons\n\tif(originalNode.matches('.tabcontent')){\n\t\t// Hide original\n\t\toriginalNode.classList.add('hidden');\n\n\t\t// Add button for the new one\n\t\tlet orgButton\t= originalNode.closest('.clone_divs_wrapper').querySelector(`.tablink.active`);\n\t\tlet newButton\t= cloneNode(orgButton);\n\n\t\t// make the org butto inactive\n\t\torgButton.classList.remove('active');\n\n\t\t//Insert the clone\n\t\torgButton.parentNode.insertBefore(newButton, orgButton.nextSibling);\n\t}\n\t\n\t//Insert the clone\n\toriginalNode.parentNode.insertBefore(newNode, originalNode.nextSibling);\n\t\n\treturn newNode;\n}\n\nexport function fixNumbering(wrapper){\n\twrapper.querySelectorAll(':scope > .clone_div').forEach(updateNumbers);\n\n\twrapper.querySelectorAll(':scope > .tablink').forEach(updateNumbers);\n\n\tfunction updateNumbers(clone, index){\n\t\t//Update the new number\t\n\n\t\t// Update the ID\n\t\tif(clone.id != ''){\n\t\t\tclone.id = clone.id.replace(/[0-9]+(?!.*[0-9])/, index);\n\t\t}\n\t\t\n\t\t// Update the content\n\t\tif(clone.type == 'button' && clone.textContent != ''){\n\t\t\tclone.textContent \t\t= clone.textContent.replace(/[0-9]+(?!.*[0-9])/, index + 1);\n\n\t\t\tclone.dataset.target\t= clone.dataset.target.replace(/[0-9]+(?!.*[0-9])/, index);\n\t\t}\n\n\t\t// Update the divid attribute\n\t\tif(clone.dataset.divid  != null){\n\t\t\tclone.dataset.divid = index;\n\t\t}\n\t\t\n\t\t//Update the title\n\t\tclone.querySelectorAll('h3, h4, legend :first-child').forEach(el => {\n\t\t\tel.textContent = el.textContent.replace(/[0-9]+(?!.*[0-9])/, index + 1);\n\t\t});\n\t\t\n\t\t//Update the legend\n\t\t/* clone.querySelectorAll('legend').forEach(legend => {\n\t\t\tlegend.textContent = legend.textContent.replace(/[0-9]+(?!.*[0-9])/, ' '+(index+1));\n\t\t}); */\n\t\t\n\t\t//Update the elements\n\t\tclone.querySelectorAll('input,select,textarea').forEach(input => {\n\t\t\t//Do not copy nice selects\n\t\t\tif(!input.classList.contains('nice-select-search')){\n\t\t\t\t//Update the id\n\t\t\t\tif(input.id != '' && input.id != undefined){\n\t\t\t\t\tinput.id = input.id.replace(/[0-9]+(?!.*[0-9])/, index);\n\t\t\t\t}\n\t\t\t\t//Update the name\n\t\t\t\tif(input.name != '' && input.name != undefined){\n\t\t\t\t\tinput.name = input.name.replace(/[0-9]+(?!.*[0-9])/, index);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//Reset the select to the default\n\t\t\t\tif(input.type == 'button'){\n\t\t\t\t\tinput.value = input.value.replace(/[0-9]+(?!.*[0-9])/, index);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function removeNode(target){\n\tlet node\t\t\t= target.closest(\".clone_div\");\n\tlet parentNode\t\t= node.closest('.clone_divs_wrapper');\n\tlet allCloneDivs\t= parentNode.querySelectorAll('.clone_div');\n\t\n\t//Check if we are removing the last element\n\tif(allCloneDivs[allCloneDivs.length-1] == node){\n\t\tlet addElement = node.querySelector(\".add\");\n\t\t\n\t\t//Move the add button one up\n\t\tlet prev = node.previousElementSibling;\n\t\tif(prev.querySelector('.buttonwrapper .add') == null){\n\t\t\tprev.querySelector('.buttonwrapper').appendChild(addElement);\n\t\t}\n\t}\n\t\n\t//Remove the node\n\tnode.remove();\n\n\t//If there is only one div remaining, remove the remove button\n\tif(parentNode.querySelectorAll('.clone_div').length == 1){\n\t\tlet removeElement = parentNode.querySelector('.remove');\n\t\tremoveElement.remove();\n\t}\n\n\tfixNumbering(parentNode)\n}\n\n/* \n\tFUNCTIONS USED BY DYNAMIC FORMS JS\n */\nexport function tidyMultiInputs(){\n\t//remove unnecessary buttons on inputs with multiple values\n\tdocument.querySelectorAll('.clone_divs_wrapper').forEach( function(div){\n\t\tlet cloneDivArr\t= div.querySelectorAll(':scope > .clone_div');\n\t\t\n\t\tif(cloneDivArr.length == 1){\n\t\t\tcloneDivArr[0].querySelectorAll('.remove').forEach(el=>el.remove());\n\t\t}\n\t\t\n\t\tcloneDivArr.forEach(function(cloneDiv, index, array){\n\t\t\t//update dataset\n\t\t\tcloneDiv.dataset.divid = index;\n\t\t\t\n\t\t\t//remove add button for all but the last\n\t\t\tif(index != array.length - 1){\n\t\t\t\t// Select all add buttons but not the any nested buttons\n\t\t\t\tcloneDiv.querySelectorAll('.add:not(:scope .clone_divs_wrapper .add)').forEach(el=>el.remove());\n\t\t\t}\n\t\t})\n\t});\n}\n\nexport function updateMultiStepControls(form){\n\t// get active formsteps amount\n\tlet formsteps\t\t\t= form.querySelectorAll('.formstep');\n\tlet visibleFormsteps\t= form.querySelectorAll('.formstep:not(.hidden)');\n\tlet stepIndicators\t\t= form.querySelectorAll('.multistepcontrols_wrapper .step');\n\n\t// show all step circles\n\tstepIndicators.forEach(el => el.classList.remove('hidden'));\n\n\t// hide some step circles if needed\n\tfor(let x = visibleFormsteps.length; x < formsteps.length; x++){\n\t\tstepIndicators[x].classList.add('hidden');\n\t}\n\n\t// check if this is the last visible\n\tlet activeFormstep\t\t= form.querySelector('.formstep:not(.stephidden)');\n\tif(visibleFormsteps[visibleFormsteps.length-1] == activeFormstep){\n\t\t// make the submit button visible\n\t\tform.querySelector('.nextBtn').classList.add('hidden');\n\t\tform.querySelector('.form_submit ').classList.remove('hidden');\n\t}else{\n\t\tform.querySelector('.nextBtn').classList.remove('hidden');\n\t\tform.querySelector('.form_submit ').classList.add('hidden');\n\t}\n}\n\t\n//show a next form step\nexport function showTab(n, form) {\n\tif(typeof(form) != 'undefined'){\n\t\tif(n == 0){\n\t\t\tlet loader = form.querySelector('.formsteploader');\n\t\t\t//hide loader\n\t\t\tif(loader != null){\n\t\t\t\tloader.classList.add('hidden');\n\t\t\t\n\t\t\t\t//show form controls\n\t\t\t\tform.querySelector('.multistepcontrols').classList.remove('hidden');\n\t\t\t}\n\t\t}\n\t\t\n\t\t//hide all formsteps\n\t\tform.querySelectorAll('.formstep:not(.stephidden)').forEach(step=>step.classList.add('stephidden'));\n\t\t\n\t\t// Show the specified formstep of the form ...\n\t\tlet x = form.getElementsByClassName(\"formstep\");\n\t\t\n\t\tif(x.length == 0){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t//scroll back to top\n\t\tlet y = x[n].offsetTop - document.querySelector(\"#masthead\").offsetHeight\n\t\twindow.scrollTo({ top: y, behavior: 'auto'});\n\t\t\n\t\t//show\n\t\tx[n].classList.remove('stephidden');\n\n\t\t// This function removes the \"active\" class of all steps...\n\t\tform.querySelectorAll(\".step.active\").forEach(el=>{el.classList.remove('active');});\n\n\t\t//... and adds the \"active\" class to the current step:\n\t\tx = form.getElementsByClassName(\"step\");\n\t\ttry{\n\t\t\tx[n].classList.add(\"active\");\n\t\t}catch(err) {\n\t\t\tconsole.log(x);\n\t\t\tconsole.log(n);\n\t\t  \tconsole.error(err.message);\n\t\t}\n\t\t\n\n\t\t// ... and fix the Previous/Next buttons:\n\t\tif (n == 0) {\n\t\t\tform.querySelector('[name=\"prevBtn\"]').classList.add('hidden');\n\t\t} else {\n\t\t\tform.querySelector('[name=\"prevBtn\"]').classList.remove('hidden');\n\t\t}\n\n\t\tif (n == (x.length - 1)) {\n\t\t\tform.querySelector('[name=\"nextBtn\"]').classList.add('hidden');\n\t\t\tform.querySelector('.form_submit').classList.remove('hidden');\n\t\t} else {\n\t\t\tform.querySelector('[name=\"nextBtn\"]').classList.remove('hidden');\n\t\t\tform.querySelector('.form_submit').classList.add('hidden');\n\t\t}\n\t}else{\n\t\tconsole.log('no form defined');\n\t}\n\t\t\n}\n\n//next form step clicked\nexport function nextPrev(n) {\n\t// This function will figure out which tab to display\n\tlet x \t\t\t\t= form.querySelectorAll(\".formstep\");\n\tlet stepIndicators\t= form.querySelectorAll(\".step\");\n\tlet currentTab\t\t= 0;\n\tlet valid\t\t\t= true;\n\n\t// Find the current active tab\n\tx.forEach((el, index)=>{if(!el.matches('.stephidden')){currentTab = index}});\n\t\n\t//Check validity of this step if going forward\n\tif(n>0){\n\t\t// Report validity of each required field\n\t\tlet elements\t= x[currentTab].querySelectorAll('.required:not(.hidden) input, .required:not(.hidden) textarea, .required:not(.hidden) select');\n\t\tfor(const element of elements) {\n\t\t\tif(\n\t\t\t\telement.closest('.hidden')\t== null\t&&\n\t\t\t\telement.closest('div.nice-select') == null && \n\t\t\t\t(\n\t\t\t\t\telement.type != 'file' || \n\t\t\t\t\telement.closest('.file_upload_wrap').querySelector('.documentpreview input') == null\n\t\t\t\t)\n\t\t\t){\n\t\t\t\telement.required\t= true;\n\t\t\t\tvalid\t\t\t\t= element.reportValidity();\n\t\t\t\tif(!valid){\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif(!valid) return;\n\t\t\n\t\t//mark the last step as finished\n\t\tstepIndicators[currentTab].classList.add(\"finish\");\n\t}else{\n\t\t//mark the last step as unfinished\n\t\tstepIndicators[currentTab].classList.remove(\"finish\");\n\t}\n\t\n\t//loop over all the formsteps to hide stepindicators of them if needed\n\tArray.from(x).forEach((formstep,index) =>{\n\t\tif(formstep.classList.contains('hidden')){\n\t\t\t//hide the corresponding circle\n\t\t\tstepIndicators[index].classList.add('hidden');\n\t\t}\n\t});\n\n\t// Increase or decrease the current tab by 1:\n\tcurrentTab = currentTab + n;\n\t\n\t//check if the next tab is hidden\n\twhile(x[currentTab].classList.contains('hidden')){\n\t\t//go to the next tab\n\t\tcurrentTab = currentTab + n;\n\n\t\tif (currentTab >= x.length) {\n\t\t\tbreak;\n\t\t}\n\t}\n\t\n\t// if you have reached the end of the form... :\n\tif (currentTab >= x.length) {\n\t\treturn false;\n\t}\n\t// Otherwise, display the correct tab:\n\tshowTab(currentTab,form);\n\n\treturn true;\n}\n\nexport function changeFieldValue(selector, value, functionRef, form, addition='', forceValue=false){\n\tif(value == undefined){\n\t\treturn;\n\t}\n\n\tlet name\t\t= '';\n\tlet target\t\t= '';\n\n\tif(selector instanceof Element){\n\t\ttarget\t\t= selector;\n\t\tname\t\t= target.name;\n\t\tif(target.id == ''){\n\t\t\tselector\t= `[name^=\"${target.name}\" i]`;\n\t\t}else{\n\t\t\tselector\t= `[id^=${target.id}]`;\n\t\t}\n\t\t\n\t}else{\n\t\ttarget \t\t= form.querySelector(selector);\n\n\t\ttry{\n\t\t\tname\t\t= target.name;\n\t\t}catch{\n\t\t\tconsole.log(target);\n\t\t}\n\t}\n\n\tlet oldValue\t= getFieldValue(target, form, false, value);\n\t// nothing to change\n\tif(oldValue == value){\n\t\treturn;\n\t}\n\n\t// Check if we are dealing with a multi input field\n\tif(target == null){\n\t\tlet targets \t= form.querySelectorAll(`.clone_div [name^=\"${name}\" i]`);\n\t\tif(targets.length === 0){\n\t\t\treturn;\n\t\t}else if(targets.length == 1){\n\t\t\ttarget\t= targets[0];\n\t\t\ttargets\t= '';\n\t\t}else{\n\t\t\ttarget\t= targets[0];\n\n\t\t\ttargets.forEach((el, index) =>{\n\t\t\t\tif(index == 0){\n\t\t\t\t\tchangeFieldValue(el, '', '', form);\n\t\t\t\t}else{\n\t\t\t\t\tremoveNode(el);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t// calculate the new value\n\tif(addition != ''){\n\t\t// check if a date\n\t\tif (/\\d{4}-\\d{2}-\\d{2}/.test(value)){\n\t\t\tlet date\t= new Date(value);\n\t\t\tdate.setDate(date.getDate() + parseInt(addition));\n\t\t\tvalue\t= date.toISOString().split('T')[0];\n\t\t}else{\n\t\t\tvalue\t= value + parseInt(addition);\n\t\t}\n\t}\n\t\n\tif(target.type == 'radio' || target.type == 'checkbox'){\n\t\t// uncheck all\n\t\tif(value == ''){\n\t\t\tif(selector != ''){\n\t\t\t\tform.querySelectorAll(selector).forEach(el=>el.checked=false);\n\t\t\t}\n\t\t}else{\n\t\t\t// Check if the current target is the one we need to check\n\t\t\tif(target.value.toLowerCase() == value.toLowerCase()){\n\t\t\t\ttarget.checked = true;\n\t\t\t}else{\n\t\t\t\t// find the element with the given value and check it\n\t\t\t\tlet targets = form.querySelectorAll(`[name=\"${name}\" i]`);\n\t\t\t\tfor (const element of targets) {\n\t\t\t\t\tif(element.value.toLowerCase() == value.toLowerCase()){\n\t\t\t\t\t\telement.checked = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t//the target has a list attached to it\n\t}else if(target.type == 'date'){\n\t\ttarget.value = value;\n\t\t\n\t\t// convert a date to the right format\n\t\tif (!/\\d{4}-\\d{2}-\\d{2}/.test(value)){\n\t\t\tlet splitted = '';\n\t\t\tif(value.split('-').length == 3){\n\t\t\t\tsplitted\t= value.split('-');\n\t\t\t}else if(value.split('/').length == 3){\n\t\t\t\tsplitted\t= value.split('/');\n\t\t\t}\n\n\t\t\tif(splitted != ''){\n\t\t\t\tlet year;\n\t\t\t\tlet month;\n\t\t\t\tlet day;\n\t\t\t\tsplitted.forEach(nr=>{\n\t\t\t\t\tif(nr.length == 4){\n\t\t\t\t\t\tyear\t= nr;\n\t\t\t\t\t}else if(nr.length == 2){\n\t\t\t\t\t\tif(nr > 12){\n\t\t\t\t\t\t\tday\t= nr;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t// does not have a value yet\n\t\t\t\t\t\t\tif(month == undefined){\n\t\t\t\t\t\t\t\tmonth\t= nr;\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\tday\t= nr;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif(day != undefined && month != undefined && year != undefined){\n\t\t\t\t\ttarget.value = `${year}-${month}-${day}`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}else if(target.list != null){\n\t\tlet dataListOption = target.list.querySelector(`[data-value=\"${value}\" i]`);\n\n\t\t//we found a match\n\t\tif(dataListOption != null){\n\t\t\t// We found a cloned field, add as many inputs as needed\n\t\t\tif(target.closest('.clone_div') != null){\n\t\t\t\t// mark the existing ones for deletion, we can delete right now as we need to copy the existing ones first\n\t\t\t\ttarget.closest('.clone_divs_wrapper').querySelectorAll('.clone_div').forEach(el=>el.classList.add('shouldremove'));\n\n\t\t\t\tlet clone;\n\t\t\t\tdataListOption.value.split(';').forEach(val=>{\n\t\t\t\t\tclone = copyFormInput(target.closest('.clone_div'));\n\n\t\t\t\t\tclone.classList.remove('shouldremove');\n\n\t\t\t\t\tchangeFieldValue(clone.querySelector(target.tagName), val, '', form, '', true);\n\t\t\t\t});\n\n\t\t\t\tfixNumbering(target.closest('.clone_divs_wrapper'));\n\n\t\t\t\t// delete the old ones\n\t\t\t\ttarget.closest('.clone_divs_wrapper').querySelectorAll('.shouldremove').forEach(el=>el.remove());\n\t\t\t}else{\n\t\t\t\ttarget.value = dataListOption.value;\n\t\t\t}\n\t\t// We did not find a match, we are filling in the given value\n\t\t}else if(forceValue){\n\t\t\ttarget.value = value;\n\t\t// We did not find a match, empty value\n\t\t}else{\n\t\t\ttarget.value = '';\n\t\t}\n\t}else{\n\t\ttarget.value = value;\n\t}\n\t\n\t//create a new event\n\tlet evt = new Event('input');\n\t//attach the target\n\ttarget.dispatchEvent(evt);\n\t\n\t//run the originating function with this event\n\tif(typeof functionRef == 'function'){\n\t\tfunctionRef(target);\n\t}\n}\n\nexport function changeVisibility(action, el, functionRef){\n\tlet wrapper\t= el.closest('.inputwrapper');\n\tif(wrapper == null){\n\t\twrapper\t= el\n\t}\n\t\n\tif(action == 'add'){\n\t\tif(wrapper.matches('.hidden')){\n\t\t\treturn;\n\t\t}\n\t\twrapper.classList.add('hidden');\n\t}else{\n\t\tif(!wrapper.matches('.hidden')){\n\t\t\treturn;\n\t\t}\n\t\twrapper.classList.remove('hidden');\n\t}\n\n\t//create a new event\n\tlet evt = new Event('input');\n\t//attach the target\n\twrapper.dispatchEvent(evt);\n\t\n\t//run the originating function with this event\n\tif(typeof functionRef == 'function'){\n\t\tfunctionRef(el);\n\t}\n}\n\nexport function changeFieldProperty(selector, att, value, functionRef, form, addition=''){\n\t//first change the value\n\tlet target = form.querySelector(selector);\n\n\t// calculate the new value\n\tif(addition != ''){\n\t\t// check if a date\n\t\tif (/\\d{4}-\\d{2}-\\d{2}/.test(value)){\n\t\t\tlet date\t= new Date(value);\n\t\t\tdate.setDate(date.getDate() + parseInt(addition));\n\t\t\tvalue\t= date.toISOString().split('T')[0];\n\t\t}else{\n\t\t\tvalue\t= value + parseInt(addition);\n\t\t}\n\t}\n\n\ttarget[att] = value;\n\t\n\t//create a new event\n\tlet evt = new Event('input');\n\n\t//attach the target\n\ttarget.dispatchEvent(evt);\n\n\t//run the originating function with this event\n\tfunctionRef(target);\n}\n\nasync function formbuilderSwitch(target){\n\tlet wrapper\t= target.closest('.sim-form-wrapper');\n\tlet button\t= target.outerHTML;\n\n\tlet formData = new FormData();\n\tlet formId;\n\n\tconst url \t\t= new URL(window.location);\n\tif(target.matches('.formbuilder-switch')){\n\t\tformData.append('formbuilder', true);\n\t\turl.searchParams.set('formbuilder', true);\n\n\t\tformId\t= wrapper.querySelector('form.sim-form-wrapper').dataset.formid;\n\t}else{\n\t\turl.searchParams.delete('formbuilder');\n\t\tformId\t= wrapper.querySelector('[name=\"formid\"]').value;\n\t}\n\twindow.history.pushState({}, '', url);\n\n\tformData.append('formid', formId);\n\n\tlet loader\t= Main.showLoader(target, false, 'Requesting form...');\n\twrapper.innerHTML\t= loader.outerHTML;\n\n\tlet response = await FormSubmit.fetchRestApi('forms/form_builder', formData);\n\n\tif(response){\n\t\twrapper.innerHTML\t= response.html;\n\n\t\taddStyles(response, document);\n\n\t\t// Activate tinyMce's again\n\t/* \twrapper.querySelectorAll('.wp-editor-area').forEach(el =>{\n\t\t\twindow.tinyMCE.execCommand('mceAddEditor', false, el.id);\n\t\t});\n\n\t\twrapper.querySelectorAll('select').forEach(function(select){\n\t\t\tMain.attachNiceSelect(select);\n\t\t}); */\n\t}else{\n\t\tloader.outerHTML\t= button;\n\t}\n}\n\nasync function requestNewFormResults(target){\n\tlet wrapper\t\t= target.closest('.form.table-wrapper');\n\tlet button\t\t= target.outerHTML;\n\n\tlet formData \t= new FormData();\n\tlet formId\t\t= wrapper.querySelector('.sim-table.form-data-table').dataset.formid;\n\tlet shortcodeId\t= wrapper.querySelector('.sim-table.form-data-table').dataset.shortcodeid;\n\n\tformData.append('formid', formId);\n\tformData.append('shortcode_id', shortcodeId);\n\n\tconst url \t\t= new URL(window.location);\n\tif(url.searchParams.get('onlyown')){\n\t\tformData.append('onlyown', true);\n\t}\n\n\tif(url.searchParams.get('all')){\n\t\tformData.append('all', true);\n\t}\n\n\tif(url.searchParams.get('archived')){\n\t\tformData.append('archived', true);\n\t}\n\n\tlet loader\t= Main.showLoader(target, false, 'Requesting form results...');\n\twrapper.innerHTML\t= loader.outerHTML;\n\n\tlet response = await FormSubmit.fetchRestApi('forms/show_form_results', formData);\n\n\tif(response){\n\t\twrapper.innerHTML\t= response;\n\t}else{\n\t\tloader.outerHTML\t= button;\n\t}\n}\n\nasync function archivedEntriesSwitch(target){\n\tconst url \t\t= new URL(window.location);\n\tif(target.matches('.archive-switch-show')){\n\t\turl.searchParams.set('archived', true);\n\t}else{\n\t\turl.searchParams.delete('archived');\n\t}\n\twindow.history.pushState({}, '', url);\n\n\trequestNewFormResults(target);\n}\n\nasync function onlyOwnSwitch(target){\n\tconst url \t\t= new URL(window.location);\n\tif(target.matches('.onlyown-switch-on')){\n\t\turl.searchParams.set('onlyown', true);\n\t\turl.searchParams.delete('all', true);\n\t}else{\n\t\turl.searchParams.set('all', true);\n\t\turl.searchParams.delete('onlyown');\n\t}\n\twindow.history.pushState({}, '', url);\n\n\trequestNewFormResults(target);\n}\n\n//we are online again\nwindow.addEventListener('online', function(){\n\tdocument.querySelectorAll('.form_submit').forEach(btn=>{\n\t\tbtn.disabled = false\n\t\tbtn.querySelectorAll('.offline').forEach(el=>el.remove());\n\t});\n});\n\n//prevent form submit when offline\nwindow.addEventListener('offline', function(){\n\tdocument.querySelectorAll('.form_submit').forEach(btn=>{\n\t\tbtn.disabled = true;\n\t\tif(btn.querySelector('.online') == null){\n\t\t\tbtn.innerHTML = '<div class=\"online\">'+btn.innerHTML+'</div>';\n\t\t}\n\t\tbtn.innerHTML += '<div class=\"offline\">You are offline</div>'\n\t});\n});\n\ndocument.addEventListener('click', function(event) {\n\tlet target = event.target;\n\t\n\t//add element\n\tif(target.matches('.add')){\n\t\tlet orgNode\t= target.closest(\".clone_div\");\n\n\t\tlet newNode = copyFormInput(orgNode);\n\n\t\t// Fix in nodes\n\t\tfixNumbering(target.closest('.clone_divs_wrapper'));\n\n\t\t//add tinymce's can only be done when node is inserted and id is unique\n\t\tnewNode.querySelectorAll('.wp-editor-area').forEach((el, index) =>{\n\t\t\t// find org node settings\n\t\t\tlet tn = tinymce.get(orgNode.querySelectorAll('.wp-editor-area')[index].id);\n\t\t\tif(tn != null){\n\t\t\t\tlet settings\t= tn.settings;\n\n\t\t\t\t// update the settings for the clone\n\t\t\t\tfor (const key in settings) {\n\t\t\t\t\tconsole.log(`${key}: ${settings[key]}`);\n\n\t\t\t\t\tif(typeof(settings[key]) == 'string'){\n\t\t\t\t\t\tsettings[key]\t= settings[key].replace(\n\t\t\t\t\t\t\t/(.*)([0-9])/, \n\t\t\t\t\t\t\t(match, prefix, nr) => {\n\t\t\t\t\t\t\t\tconst newNumber = parseInt(nr) + 1;\n\t\t\t\t\t\t\t\treturn prefix + newNumber;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttinymce.init(settings);\n\t\t\t\t//window.tinyMCE.execCommand('mceAddEditor', false, el.id);\n\t\t\t}\n\t\t});\n\n\t\ttarget.remove();\n\t}\n\t\n\t//remove element\n\tif(target.matches('.remove')){\n\t\t//Remove node clicked\n\t\tremoveNode(target);\n\t}\n\n\tif(target.matches('.sim-form-wrapper [name=\"submit_form\"]')){\n\t\tevent.stopPropagation();\n\t\t\n\t\tsaveFormInput(target);\n\t}\n\n\tif(target.matches('.formbuilder-switch') || target.matches('.formbuilder-switch-back')){\n\t\tformbuilderSwitch(target);\n\t}\n\n\tif(target.matches('.archive-switch-hide') || target.matches('.archive-switch-show')){\n\t\tarchivedEntriesSwitch(target);\n\t}\n\n\tif(target.matches('.onlyown-switch-all') || target.matches('.onlyown-switch-on')){\n\t\tonlyOwnSwitch(target);\n\t}\n});\n\ndocument.addEventListener('change', ev=>{\n\t// select all elements with a datalist attached\n\tif(ev.target.matches('input[list]') && ev.target.name.includes('[')){\n\t\tlet el\t\t= ev.target.list.querySelector(`[value=\"${ev.target.value}\" i]`);\n\n\t\tif(el != null){\n\t\t\t// find the dataset value of the given element value\n\t\t\tlet value\t= el.dataset.value;\n\n\t\t\tif(value != undefined){\n\t\t\t\t// change the value to create extra inputs if necessary\n\t\t\t\tchangeFieldValue(ev.target, value, '', ev.target.closest('form'));\n\t\t\t}\n\t\t}\n\t}\n})","import { cloneNode } from \"../../forms/js/forms\";\r\n\r\nconsole.log(\"library.js loaded\");\r\n\r\nasync function addBook(target){\r\n\tlet cell\t\t\t= target.closest('td');\r\n\tlet row\t\t\t\t= target.closest('tr');\r\n\tlet formData\t\t= new FormData();\r\n\r\n\trow.querySelectorAll('input, textarea').forEach(input=>formData.append(input.name, input.value));\r\n\trow.querySelectorAll('td > img').forEach(img=>formData.append('image', img.src));\r\n\r\n\ttarget.classList.add('hidden');\r\n\tcell.querySelector(`.loadergif_wrapper`).classList.remove('hidden');\r\n\r\n\tlet response\t= await FormSubmit.fetchRestApi('library/add_book', formData);\r\n\t\r\n\tif(response){\r\n\t\tcell.innerHTML\t= response;\r\n\r\n\t\tMain.displayMessage(response.message);\r\n\t}else{\r\n\t\ttarget.classList.remove('hidden');\r\n\t\tcell.querySelector(`.loadergif_wrapper`).classList.add('hidden');\r\n\r\n\t\ttarget.remove();\r\n\t}\r\n}\r\n\r\nlet fileUploadWrap, totalFiles;\r\nasync function fileUpload(target, location){\r\n\ttotalFiles \t\t= target.files.length;\r\n\r\n\tif (totalFiles < 0){\r\n\t\treturn;\r\n\t}\r\n\t\r\n\t//Create a formData element\r\n\tlet formData = new FormData();\r\n\t\r\n\t//Add the ajax action name\r\n\tformData.append('action', 'process_library_upload');\r\n\r\n\tformData.append('location', location);\r\n\r\n\t//Add all the files to the formData\r\n\tfor (let index = 0; index < totalFiles; index++) {\r\n\t\tlet file\t= target.files[index];\r\n\t\tformData.append('files[]', file);\r\n\t}\r\n\t\r\n\t//AJAX request\r\n\tlet request = new XMLHttpRequest();\r\n\t\r\n\t//Listen to the state changes\r\n\trequest.onreadystatechange = readyStateChanged;\r\n\t\r\n\t//Listen to the upload status\r\n\trequest.upload.addEventListener('progress', fileUploadProgress, false);\r\n\t\r\n\trequest.open('POST', sim.ajaxUrl, true);\r\n\t\r\n\t//Show loading gif\r\n\tfileUploadWrap.querySelectorAll(\".loadergif_wrapper\").forEach(loader =>{\r\n\t\tloader.classList.remove('hidden');\r\n\t\tloader.querySelectorAll(\".uploadmessage\").forEach(el =>{\r\n\t\t\tel.textContent = \"Preparing upload\";\r\n\t\t\tel.classList.add('upload-message');\r\n\t\t});\r\n\t});\r\n\t\r\n\t//Send AJAX request\r\n\tfileUploadWrap.querySelector('.uploadmessage').textContent = \"Uploading Picture(s)\";\r\n\tdocument.getElementById('progress-wrapper').classList.remove('hidden');\r\n\r\n\trequest.send(formData);\r\n}\r\n\r\nfunction fileUploadProgress(e){\r\n\tif(e.lengthComputable){\r\n\t\tlet max \t\t= e.total;\r\n\t\tlet current \t= e.loaded;\r\n\r\n\t\tlet percentage \t= (current * 100)/max;\r\n\t\tpercentage \t\t= Math.round(percentage*10)/10\r\n\t\t\r\n\t\tdocument.querySelectorAll(\"#upload_progress\").forEach(el=>el.value = percentage);\r\n\t\tdocument.querySelectorAll(\"#progress_percentage\").forEach(el=>el.textContent\t= `   ${percentage}%`);\r\n\r\n\t\tif(percentage >= 99){\r\n\t\t\t//Remove progress barr\r\n\t\t\tdocument.getElementById(\"progress-wrapper\").classList.add('hidden');\r\n\t\t\t\r\n\t\t\t// process completed\r\n\t\t\tfileUploadWrap.querySelectorAll(\".uploadmessage\").forEach(el =>{\r\n\t\t\t\t//Change message text\r\n\t\t\t\tif (totalFiles > 1){\r\n\t\t\t\t\tel.textContent = \"Processing images\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\tel.textContent = \"Processing image\";\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}  \r\n}\r\n\r\nfunction readyStateChanged(e){\r\n\tlet request\t= e.target;\r\n\t\r\n\t//If finished\r\n\tif(request.readyState == 4){\r\n\t\t//Success\r\n\t\tif (request.status >= 200 && request.status < 400) {\r\n\t\t\tfileUploadSucces(request.responseText)\r\n\t\t//Error\r\n\t\t}else{\r\n\t\t\tconsole.error(request.responseText);\r\n\t\t\tMain.displayMessage(JSON.parse(request.responseText).error,'error');\r\n\t\t}\r\n\t\t\r\n\t\t//Hide loading gif\r\n\t\tdocument.querySelectorAll(\".loadergif_wrapper\").forEach(\r\n\t\t\tfunction(loader){\r\n\t\t\t\tloader.classList.add('hidden');\r\n\t\t\t}\r\n\t\t);\r\n\t\t\t\r\n\t\t//Clear the input\r\n\t\tfileUploadWrap.querySelector('input[type=\"file\"]').value = \"\";\r\n\t}\r\n}\r\n\r\nfunction fileUploadSucces(result){\r\n\tfileUploadWrap.innerHTML\t= JSON.parse(result).data + fileUploadWrap.innerHTML;\r\n\t\r\n\tMain.displayMessage(\"The files have been processed succesfully.\", 'success', true);\r\n\r\n\tfileUploadWrap.querySelector('.image-selector-wrap').classList.remove('hidden');\r\n\r\n\t// Create a custom event so others can listen to it.\r\n\t// Used by formstable uploads\r\n\tconst event = new Event('uploadfinished');\r\n\tfileUploadWrap.dispatchEvent(event);\r\n\r\n\tfetchMetaDatas();\r\n}\r\n\r\nasync function fetchMetaDatas(){\r\n\tfileUploadWrap.querySelectorAll('table tr').forEach(async (tr) => {\r\n\t\tfetchMetaData(tr);\r\n\t});\r\n}\r\n\r\nasync function fetchMetaData(tr){\r\n\ttry{\r\n\t\t// Check if a book row\r\n\t\tif(tr.querySelector('.title') == null){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet title\t= tr.querySelector('.title').value;\r\n\r\n\t\t// Only search for the first author\r\n\t\tlet author\t= tr.querySelector('.author').value.trim();\r\n\t\tlet url     = `https://openlibrary.org/search.json?q=`+encodeURIComponent(`title:${title}`);\r\n\t\tif(author != ''){\r\n\t\t\turl += encodeURIComponent(` author:${author}`)+'&limit=1';\r\n\t\t}\r\n\t\turl += '&fields=key,title,author_name,subtitle,alternative_subtitle,cover_i,language,number_of_pages_median,first_publish_year,description';\r\n\r\n\t\tconst response \t= await fetch(url);\r\n\t\tconst data \t\t= await response.json();\r\n\t\tlet bookData    = data['docs'][0] ?? [];\r\n\r\n\t\tif(bookData.length == 0 && author == ''){\r\n\t\t\tlet id\t= `authorlist-${title.replaceAll(\" \", \"_\").replaceAll(\"'\", \"\")}`;\r\n\t\t\ttr.querySelectorAll('.author').forEach(el => el.setAttribute(\"list\", id));\r\n\r\n\t\t\tlet list = `<datalist id='${id}' class='author-selection'>`;\r\n\r\n\t\t\tdata['docs'].forEach((doc) => {\r\n\t\t\t\tif(doc['author_name'] != undefined){\r\n\t\t\t\t\tlist += `<option value='${doc['author_name'].join()}'>`;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tlist += `</datalist>`;\r\n\t\t\ttr.querySelector('.authors').insertAdjacentHTML('afterEnd', list);\r\n\t\t}else{\r\n\t\t\tlet authors \t= bookData['author_name'] ?? [author];\r\n\t\t\tlet wrapper \t= tr.querySelector(`.authors.clone_divs_wrapper`);\r\n\t\t\tlet baseElement = wrapper.querySelector(`.clone_div`);\r\n\r\n\t\t\tauthors.forEach(author => {\r\n\t\t\t\tlet clone\t\t= cloneNode(baseElement);\r\n\t\t\t\tclone.querySelector('.author').value = author;\r\n\r\n\t\t\t\twrapper.appendChild(clone);\r\n\t\t\t});\t\t\r\n\t\t\t\r\n\t\t\tbaseElement.remove()\r\n\t\t}\r\n\r\n\t\tlet image        = bookData['cover_i'] ?? '';\r\n        if(image != ''){\r\n           \tlet  smallUrl    = `https://covers.openlibrary.org/b/id/${image}-S.jpg`;\r\n\t\t   \tlet  largeUrl    = `https://covers.openlibrary.org/b/id/${image}-L.jpg`;\r\n\r\n\t\t\ttr.querySelector('.image').innerHTML = `<input type='hidden' name='image' value='${image}'><a href='${largeUrl}' target='_blank'><img src='${smallUrl}' class='book-image' loading='lazy'></a>`;\r\n        }\r\n\r\n\t\tlet subtitle\t= bookData['subtitle'] ?? '';\r\n\r\n\t\tlet year\t\t= bookData['first_publish_year'] ?? '';\r\n\t\tyear\t\t\t= year[0] ?? year;\r\n\r\n\t\tlet language\t= bookData['language'] ?? '';\r\n\t\tlanguage\t\t= language[0] ?? language;\r\n\r\n\t\tlet pageCount\t\t= bookData['number_of_pages'] ?? bookData['number_of_pages_median'] ?? '';\r\n\r\n\t\tlet html = `<td><input type='text' name='subtitle' class='subtitle' value='${subtitle}'></td>`;\r\n\t\thtml += `<td><input type='text' name='series' class='series' value='${bookData['series'] ?? ''}'></td>`;\r\n\t\thtml += `<td><input type='text' name='year' class='year' value='${year}'></td>`;\r\n\t\thtml += `<td><input type='text' name='language' class='language' value='${language}'></td>`;\r\n\t\thtml += `<td><input type='text' name='pages' class='pages' value='${pageCount}'></td>`;\r\n\r\n\t\tlet placeholder\t= tr.querySelector('.placeholder');\r\n\t\tif(placeholder == null){\r\n\t\t\ttr.querySelector('.subtitle').value = subtitle;\r\n\t\t\ttr.querySelector('.series').value \t= bookData['series'] ?? '';\r\n\t\t\ttr.querySelector('.year').value \t= year;\r\n\t\t\ttr.querySelector('.language').value = language;\r\n\t\t\ttr.querySelector('.pages').value \t= pageCount;\r\n\t\t}else{\r\n\t\t\tplaceholder.outerHTML = html;\r\n\t\t}\r\n\r\n        let summary      \t= tr.querySelector('.summary').value\r\n\t\tsummary\t\t\t\t= bookData['description'] != undefined ? bookData['description']['value'] != undefined ? bookData['description']['value'] : '' : '';\r\n\r\n\t\tlet key        = bookData['key'] ?? '';\r\n        if(key != ''){\r\n            url      = `https://openlibrary.org${key}`;\r\n\t\t\ttr.querySelector('.url').innerHTML = `\r\n\t\t\t<input type='hidden' name='url' value='${url}'>\r\n\t\t\t<a href='${url}' target='_blank'>View on Open Library</a>\r\n\t\t\t`;\r\n\r\n\t\t\t// Fetch the summary if not already set or needs to be updated\r\n\t\t\tif(summary == '' || placeholder == null){\r\n\t\t\t\t// Fetch the summary from the Open Library API\r\n\t\t\t\tconst descriptionResponse \t= await fetch(url+'.json');\r\n\t\t\t\tconst description \t\t\t= await descriptionResponse.json();\r\n\r\n\t\t\t\tsummary = description['description'] ?? '';\t\r\n\t\t\t\t\r\n\t\t\t\tsummary = summary.value ?? summary;\r\n\t\t\t}\r\n        }\r\n\r\n\t\tif(summary != ''){\r\n\t\t\ttr.querySelector('.summary').value = summary;\r\n\t\t}\r\n\r\n\t} catch(e){\r\n\t\tconsole.error('Error fetching book data:', e);\r\n\t}\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", function() {\r\n\t\r\n\r\n});\r\n\r\ndocument.addEventListener(\"click\", event =>{\r\n\tlet target = event.target;\r\n\r\n\tif(fileUploadWrap != undefined && target.matches(`.add-books`)){\r\n\t\tfileUploadWrap.querySelectorAll('.image-preview, .book-table-wrapper').forEach(el => el.remove());\r\n\t}else if(target.matches(`.add-book`)){\r\n\t\taddBook(target);\r\n\t}else if(target.matches(`.delete-book`)){\r\n\t\ttarget.closest('tr').remove();\r\n\t}\r\n});\r\n\r\ndocument.addEventListener(\"change\", async event =>{\r\n\tlet target = event.target;\r\n\r\n\tif(target.name == 'image-selector' && target.files.length > 0){\r\n\t\tfileUploadWrap\t= target.closest('.file_upload_wrap');\r\n\t\t\r\n\t\t// Make sure we have a location\r\n\t\tlet location\t= fileUploadWrap.querySelector(`.book-location`);\r\n\t\tconst isValid \t= location.reportValidity();\r\n\t\tif (!isValid) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlocation = location.value;\r\n\t\t\r\n\t\t// Remove previous result tables\r\n\t\tdocument.querySelectorAll('.book-table-wrapper').forEach(el => el.remove());\r\n\t\t\r\n\t\ttarget.closest('.image-selector-wrap').classList.add('hidden');\r\n\t\tfileUploadWrap.querySelectorAll('.image-preview').forEach(el => el.remove());\r\n\t\t\r\n\t\tfor (const file of target.files) {\r\n\t\t\tlet reader = new FileReader();\r\n\r\n\t\t\treader.onload = function(e) {\r\n\t\t\t\tlet div \t\t\t= document.createElement('div');\r\n\t\t\t\tdiv.classList.add('image-preview');\r\n\r\n\t\t\t\tlet img \t\t\t= document.createElement('img');\r\n\t\t\t\timg.src \t\t\t= e.target.result;\r\n\t\t\t\timg.classList.add('book-image');\r\n\t\t\t\timg.style.maxHeight\t= \"100px\";\r\n\t\t\t\timg.style.padding\t=  \"0\";\r\n\r\n\t\t\t\tdiv.appendChild(img);\r\n\t\t\t\t\r\n\t\t\t\tfileUploadWrap.prepend(div);\r\n\t\t\t}\r\n\t\t\treader.readAsDataURL(file);\r\n\r\n\t\t\tfileUpload(target, location);\r\n\t\t}\r\n\t}else if(target.matches('.title, .author')){\r\n\t\tlet tr = target.closest('tr');\r\n\t\t\r\n\t\t// Update metadata for the book row\r\n\t\tawait fetchMetaData(tr);\r\n\t}\r\n});","function getRadioValue(form, selector){\r\n\tlet el\t= form.querySelector(`${selector}:checked`);\r\n\r\n\t//There is no radio selected currently\r\n\tif(el == null){\r\n\t\t//return an empty value\r\n\t\treturn '';\r\n\t}\r\n\r\n\treturn el.value;\r\n}\r\n\r\nfunction getCheckboxValue(form, selector, compareValue, orgName){\r\n\tlet value\t\t= '';\r\n\tlet elements\t= '';\r\n\r\n\t//we are dealing with a specific checkbox\r\n\tif(orgName.type == 'checkbox' && compareValue != null ){\r\n\t\tif(orgName.checked){\r\n\t\t\treturn orgName.value;\r\n\t\t}\r\n\t\t\r\n\t\treturn '';\r\n\t}\r\n\r\n\t//we should find the checkbox with this value and check if it is checked\r\n\tif(compareValue != null){\r\n\t\telements\t= form.querySelector(`${selector}[value=\"${compareValue}\" i]:checked`);\r\n\t\tif(elements != null){\r\n\t\t\tvalue = compareValue;\r\n\t\t}\r\n\t//no compare value give just return all checked values\r\n\t}else{\r\n\t\telements\t= form.querySelectorAll(`${selector}:checked`);\r\n\t\tvalue\t\t= [];\r\n\t\telements.forEach(el=>{\r\n\t\t\tvalue.push(el.value);\r\n\t\t\t/* if(value != ''){\r\n\t\t\t\tvalue += ', ';\r\n\t\t\t}\r\n\t\t\tvalue += el.value; */\r\n\t\t});\r\n\t}\r\n\r\n\treturn value;\r\n}\r\n\r\nfunction getMultiValue(form, el){\r\n\tlet value = [];\r\n\r\n\tform.querySelectorAll(`[name=\"${el.name}\"]`).forEach(elem => value.push(elem.value));\r\n\r\n\treturn value;\r\n}\r\n\r\nexport function getDataListValue(el){\r\n\tlet value\t\t= '';\r\n\tlet origInput \t= el.list.querySelector(`[value='${el.value}' i]`);\r\n\t\t\t\r\n\tif(origInput == null){\r\n\t\tvalue =  el.value;\r\n\t}else{\r\n\t\tvalue = origInput.dataset.value;\r\n\t}\r\n\r\n\treturn value;\r\n}\r\n\r\nexport function getFieldValue(orgName, form, checkDatalist=true, compareValue=null, lowercase=false){\r\n\r\n\tlet el\t\t\t= ''; \r\n\tlet name\t\t= '';\r\n\tlet value \t\t= '';\r\n\tlet selector\t= '';\r\n\r\n\t//name is not a name but a node\r\n\tif(orgName instanceof Element){\r\n\t\tel\t\t\t= orgName;\t\t\r\n\t\t//check if valid input type\r\n\t\tif(el.tagName != 'INPUT' && el.tagName != 'TEXTAREA' && el.tagName != 'SELECT' && el.closest('.nice-select-dropdown') == null){\r\n\t\t\tel = el.querySelector('input, select, textarea');\r\n\t\t}\r\n\t\tif(el == null){\r\n\t\t\tel\t\t\t= orgName;\r\n\t\t}\r\n\t\tname\t\t= el.name;\r\n\t// We should look for an id\r\n\t}else if(orgName.match(\"E[0-9]\")){\r\n\t\tselector\t= `[id^=${orgName}]`;\r\n\t\tel\t\t\t= form.querySelector(selector);\r\n\t\tname\t\t= el.name;\r\n\t}else{\r\n\t\tname\t\t= orgName;\r\n\t\tselector\t= `[name='${name}' i]`;\r\n\t\tel\t\t\t= form.querySelector(selector);\r\n\t}\r\n\t\r\n\tif(el == null){\r\n\t\tconsole.trace();\r\n\t\tconsole.log(\"cannot find element with name \"+name);\r\n\r\n\t\treturn value;\r\n\t}\r\n\r\n\tif(el.type == 'radio'){\r\n\t\tvalue\t= getRadioValue(form, selector);\r\n\t}else if(el.type == 'checkbox'){\r\n\t\tvalue\t= getCheckboxValue(form, selector, compareValue, orgName);\t\r\n\t}else if(el.closest('.nice-select-dropdown') != null && el.dataset.value != undefined){\r\n\t\t//nice select\r\n\t\tvalue = el.dataset.value\r\n\t}else if(el.list != null && el.value != '' && checkDatalist){\r\n\t\tvalue =  getDataListValue(el);\r\n\t}else if(el.name != undefined && el.name.endsWith('[]')){\r\n\t\tvalue =  getMultiValue(form, el);\r\n\t}else if(el.value != null && el.value != 'undefined'){\r\n\t\tvalue = el.value;\r\n\t}\r\n\t\r\n\tif(lowercase){\r\n\t\treturn value.toLowerCase();\r\n\t}\r\n\treturn value;\r\n}"],"names":["scripts","afterScriptsLoaded","attachTo","tinymce","remove","document","querySelectorAll","forEach","el","window","tinyMCE","execCommand","id","dispatchEvent","Event","bubbles","cancelable","addEventListener","ev","area","closest","querySelector","panel","style","visibility","target","matches","display","select","Main","attachNiceSelect","addScripts","undefined","length","shift","tagName","getElementById","s","createElement","type","src","innerHTML","head","appendChild","error","console","bind","removeDefaultSelect","Array","from","options","option","defaultSelected","log","fileUploadWrap","totalFiles","tinymceSettings","cloneNode","originalNode","clear","tn","get","settings","save","prepareForCloning","newNode","dropdown","init","input","checked","value","copyFormInput","uploadButton","dataset","index","nodeNr","previewDiv","i","previousVal","getElementsByTagName","selectedIndex","html","insertAdjacentHTML","classList","add","orgButton","newButton","parentNode","insertBefore","nextSibling","fixNumbering","wrapper","updateNumbers","clone","replace","textContent","divid","contains","name","removeNode","node","allCloneDivs","addElement","prev","previousElementSibling","changeFieldValue","selector","functionRef","form","addition","forceValue","Element","oldValue","orgName","checkDatalist","compareValue","lowercase","match","trace","getRadioValue","elements","push","getCheckboxValue","list","origInput","getDataListValue","endsWith","elem","getMultiValue","toLowerCase","getFieldValue","targets","test","date","Date","setDate","getDate","parseInt","toISOString","split","element","splitted","year","month","day","nr","dataListOption","val","evt","async","requestNewFormResults","button","outerHTML","formData","FormData","formId","formid","shortcodeId","shortcodeid","append","url","URL","location","searchParams","loader","showLoader","response","FormSubmit","fetchRestApi","files","file","request","XMLHttpRequest","onreadystatechange","readyStateChanged","upload","fileUploadProgress","open","sim","ajaxUrl","send","e","lengthComputable","max","total","percentage","loaded","Math","round","readyState","status","result","JSON","parse","data","displayMessage","event","tr","fetchMetaData","fetchMetaDatas","fileUploadSucces","responseText","title","author","trim","encodeURIComponent","fetch","json","bookData","replaceAll","setAttribute","doc","join","authors","baseElement","image","smallUrl","largeUrl","subtitle","language","pageCount","placeholder","summary","key","descriptionResponse","btn","disabled","orgNode","prefix","stopPropagation","required","submitForm","reset","formReset","saveFormInput","set","delete","history","pushState","temp","prototype","slice","call","js","children","concat","css","addStyles","formbuilderSwitch","archivedEntriesSwitch","onlyOwnSwitch","includes","cell","row","img","message","addBook","reportValidity","reader","FileReader","onload","div","maxHeight","padding","prepend","readAsDataURL"],"sourceRoot":""}