{"version":3,"file":"library.min.js","mappings":"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","sources":["webpack://library/../../forms/js/form_exports.js","webpack://library/../../../plugins/sim-plugin/includes/js/table.js","webpack://library/../../../plugins/sim-plugin/includes/js/field_value.js","webpack://library/./library.js"],"sourcesContent":["import { getFieldValue } from  '../../../plugins/sim-plugin/includes/js/field_value.js';\n\nexport function removeDefaultSelect(el){\n\tArray.from(el.options).forEach(function(option){\n\t\toption.defaultSelected = false;\n\t});\n}\n\nlet tinymceSettings = [];\nfunction prepareForCloning(originalNode){\n\t//also remove any tinymce's\n\tif(typeof(tinymce) != 'undefined'){\n\t\toriginalNode.querySelectorAll('.wp-editor-area').forEach(el =>{\n\t\t\tlet tn = tinymce.get(el.id);\n\t\t\tif(tn != null){\n\t\t\t\ttinymceSettings[el.id] = tn.settings\n\t\t\t\ttn.save();\n\t\t\t\ttn.remove();\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function cloneNode(originalNode, clear=true){\n\tprepareForCloning(originalNode);\n\t\n\t//make a clone\n\tlet newNode = originalNode.cloneNode(true);\n\n\t// remove niceselect drop down from clone\n\tnewNode.querySelectorAll('.nice-select').forEach(dropdown => dropdown.remove());\n\t\n\t//add tinymce's again\n\toriginalNode.querySelectorAll('.wp-editor-area').forEach(el =>{\n\t\tif(tinymceSettings[el.id] != undefined){\n\t\t\ttinymce.init(tinymceSettings[el.id]);\n\t\t}\n\t});\n\t\n\t//clear values in the clone\n\tif(clear){\n\t\tnewNode.querySelectorAll('input,select,textarea').forEach(input => {\n\t\t\tif(input.type == 'checkbox' || input.type == 'radio'){\n\t\t\t\tinput.checked = false;\n\t\t\t}else if(input.type != 'hidden'){\n\t\t\t\tinput.value = \"\";\n\t\t\t}\n\t\t\t\n\t\t\t//if this is a select\n\t\t\tif(input.type == \"select-one\"){\n\t\t\t\t//remove any defaults\n\t\t\t\tremoveDefaultSelect(input);\n\t\t\t}\n\t\t});\n\t}\n\n\tnewNode.querySelectorAll('select').forEach(select => {\n\t\t//remove any defaults\n\t\tremoveDefaultSelect(select);\n\n\t\tMain.attachNiceSelect(select);\n\t});\n\t\n\treturn newNode;\n}\n\nexport function copyFormInput(originalNode){\n\tlet newNode = cloneNode(originalNode);\n\t\n\t//update the data index\n\tnewNode.querySelectorAll('.upload-files').forEach(function(uploadButton){\n\t\tuploadButton.dataset.index = nodeNr;\n\t})\n\t\n\t//Clear contents of any document preview divs.\n\tnewNode.querySelectorAll('.documentpreview').forEach(function(previewDiv){\n\t\tpreviewDiv.innerHTML = '';\n\t});\n\n\t//Select\n\tlet i = 0;\n\tnewNode.querySelectorAll('select').forEach(select => {\n\t\t//Find the value of the select we have cloned\n\t\tlet previousVal = originalNode.getElementsByTagName('select')[i].selectedIndex;\n\t\t\n\t\t//Hide the value in the clone\n\t\tif(select.options[previousVal] != undefined){\n\t\t\tselect.options[previousVal].style.display = 'none';\n\t\t}\n\t\t\n\t\t//Add nice select\n\t\tMain.attachNiceSelect(select);\n\t\t\n\t\ti++;\n\t});\n\t\n\t//Add remove buttons if they are not there\n\tif(originalNode.querySelector('.remove') == null && newNode.querySelector('.remove') == null){\n \t\tlet html = `<button type=\"button\" class=\"remove button\" style=\"flex: 1;\">-</button>`;\n\n\t\t//Add minus button to the first div\n\t\toriginalNode.querySelector('.button-wrapper').insertAdjacentHTML('beforeend', html);\n\n\t\t//Add minus button to the second div\n\t\tnewNode.querySelector('.button-wrapper').insertAdjacentHTML('beforeend', html)\n\t}\t\n\n\t// process tab buttons\n\tif(originalNode.matches('.tabcontent')){\n\t\t// Hide original\n\t\toriginalNode.classList.add('hidden');\n\n\t\t// Add button for the new one\n\t\tlet orgButton\t= originalNode.closest('.clone-divs-wrapper').querySelector(`.tablink.active`);\n\t\tlet newButton\t= cloneNode(orgButton);\n\n\t\t// make the org butto inactive\n\t\torgButton.classList.remove('active');\n\n\t\t//Insert the clone\n\t\torgButton.parentNode.insertBefore(newButton, orgButton.nextSibling);\n\t}\n\t\n\t//Insert the clone\n\toriginalNode.parentNode.insertBefore(newNode, originalNode.nextSibling);\n\t\n\treturn newNode;\n}\n\nexport function fixNumbering(wrapper){\n\twrapper.querySelectorAll(':scope > .clone-div').forEach(updateNumbers);\n\n\twrapper.querySelectorAll(':scope > .tablink').forEach(updateNumbers);\n\n\tfunction updateNumbers(clone, index){\n\t\t//Update the new number\t\n\n\t\t// Update the ID\n\t\tif(clone.id != ''){\n\t\t\tclone.id = clone.id.replace(/[0-9]+(?!.*[0-9])/, index);\n\t\t}\n\t\t\n\t\t// Update the content\n\t\tif(clone.type == 'button' && clone.textContent != ''){\n\t\t\tclone.textContent \t\t= clone.textContent.replace(/[0-9]+(?!.*[0-9])/, index + 1);\n\n\t\t\tclone.dataset.target\t= clone.dataset.target.replace(/[0-9]+(?!.*[0-9])/, index);\n\t\t}\n\n\t\t// Update the divid attribute\n\t\tif(clone.dataset.divid  != null){\n\t\t\tclone.dataset.divid = index;\n\t\t}\n\t\t\n\t\t//Update the title\n\t\tclone.querySelectorAll('h3, h4, legend :first-child').forEach(el => {\n\t\t\tel.textContent = el.textContent.replace(/[0-9]+(?!.*[0-9])/, index + 1);\n\t\t});\n\t\t\n\t\t//Update the legend\n\t\t/* clone.querySelectorAll('legend').forEach(legend => {\n\t\t\tlegend.textContent = legend.textContent.replace(/[0-9]+(?!.*[0-9])/, ' '+(index+1));\n\t\t}); */\n\t\t\n\t\t//Update the elements\n\t\tclone.querySelectorAll('input,select,textarea').forEach(input => {\n\t\t\t//Do not copy nice selects\n\t\t\tif(!input.classList.contains('nice-select-search')){\n\t\t\t\t//Update the id\n\t\t\t\tif(input.id != '' && input.id != undefined){\n\t\t\t\t\tinput.id = input.id.replace(/[0-9]+(?!.*[0-9])/, index);\n\t\t\t\t}\n\t\t\t\t//Update the name\n\t\t\t\tif(input.name != '' && input.name != undefined){\n\t\t\t\t\tinput.name = input.name.replace(/[0-9]+(?!.*[0-9])/, index);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//Reset the select to the default\n\t\t\t\tif(input.type == 'button'){\n\t\t\t\t\tinput.value = input.value.replace(/[0-9]+(?!.*[0-9])/, index);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function removeNode(target){\n\tlet node\t\t\t= target.closest(\".clone-div\");\n\tlet parentNode\t\t= node.closest('.clone-divs-wrapper');\n\tlet allCloneDivs\t= parentNode.querySelectorAll('.clone-div');\n\t\n\t//Check if we are removing the last element\n\tif(allCloneDivs[allCloneDivs.length-1] == node){\n\t\tlet addElement = node.querySelector(\".add\");\n\t\t\n\t\t//Move the add button one up\n\t\tlet prev = node.previousElementSibling;\n\t\tif(prev.querySelector('.button-wrapper .add') == null){\n\t\t\tprev.querySelector('.button-wrapper').appendChild(addElement);\n\t\t}\n\t}\n\t\n\t//Remove the node\n\tnode.remove();\n\n\t//If there is only one div remaining, remove the remove button\n\tif(parentNode.querySelectorAll('.clone-div').length == 1){\n\t\tlet removeElement = parentNode.querySelector('.remove');\n\t\tremoveElement.remove();\n\t}\n\n\tfixNumbering(parentNode)\n}\n\n/* \n\tFUNCTIONS USED BY DYNAMIC FORMS JS\n */\nexport function tidyMultiInputs(){\n\t//remove unnecessary buttons on inputs with multiple values\n\tdocument.querySelectorAll('.clone-divs-wrapper').forEach( function(div){\n\t\tlet cloneDivArr\t= div.querySelectorAll(':scope > .clone-div');\n\t\t\n\t\tif(cloneDivArr.length == 1){\n\t\t\tcloneDivArr[0].querySelectorAll('.remove').forEach(el=>el.remove());\n\t\t}\n\t\t\n\t\tcloneDivArr.forEach(function(cloneDiv, index, array){\n\t\t\t//update dataset\n\t\t\tcloneDiv.dataset.divid = index;\n\t\t\t\n\t\t\t//remove add button for all but the last\n\t\t\tif(index != array.length - 1){\n\t\t\t\t// Select all add buttons but not the any nested buttons\n\t\t\t\tcloneDiv.querySelectorAll('.add:not(:scope .clone-divs-wrapper .add)').forEach(el=>el.remove());\n\t\t\t}\n\t\t})\n\t});\n}\n\nexport function updateMultiStepControls(form){\n\t// get active formsteps amount\n\tlet formsteps\t\t\t= form.querySelectorAll('.formstep');\n\tlet visibleFormsteps\t= form.querySelectorAll('.formstep:not(.hidden)');\n\tlet stepIndicators\t\t= form.querySelectorAll('.multi-step-controls-wrapper .step');\n\n\t// show all step circles\n\tstepIndicators.forEach(el => el.classList.remove('hidden'));\n\n\t// hide some step circles if needed\n\tfor(let x = visibleFormsteps.length; x < formsteps.length; x++){\n\t\tstepIndicators[x].classList.add('hidden');\n\t}\n\n\t// check if this is the last visible\n\tlet activeFormstep\t\t= form.querySelector('.formstep:not(.step-hidden)');\n\tif(visibleFormsteps[visibleFormsteps.length-1] == activeFormstep){\n\t\t// make the submit button visible\n\t\tform.querySelector('.nextBtn').classList.add('hidden');\n\t\tform.querySelector('.form-submit ').classList.remove('hidden');\n\t}else{\n\t\tform.querySelector('.nextBtn').classList.remove('hidden');\n\t\tform.querySelector('.form-submit ').classList.add('hidden');\n\t}\n}\n\t\n//show a next form step\nexport function showTab(n, form) {\n\tif(typeof(form) != 'undefined'){\n\t\tif(n == 0){\n\t\t\tlet loader = form.querySelector('.loader-wrapper:not(.hidden)' );\n\t\t\t//hide loader\n\t\t\tif(loader != null){\n\t\t\t\tloader.classList.add('hidden');\n\t\t\t\n\t\t\t\t//show form controls\n\t\t\t\tform.querySelector('.multistepcontrols').classList.remove('hidden');\n\t\t\t}\n\t\t}\n\t\t\n\t\t//hide all formsteps\n\t\tform.querySelectorAll('.formstep:not(.step-hidden)').forEach(step=>step.classList.add('step-hidden'));\n\t\t\n\t\t// Show the specified formstep of the form ...\n\t\tlet x = form.getElementsByClassName(\"formstep\");\n\t\t\n\t\tif(x.length == 0){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t//scroll back to top\n\t\tlet y = x[n].offsetTop - document.querySelector(\"#masthead\").offsetHeight\n\t\twindow.scrollTo({ top: y, behavior: 'auto'});\n\t\t\n\t\t//show\n\t\tx[n].classList.remove('step-hidden');\n\n\t\t// This function removes the \"active\" class of all steps...\n\t\tform.querySelectorAll(\".step.active\").forEach(el=>{el.classList.remove('active');});\n\n\t\t//... and adds the \"active\" class to the current step:\n\t\tx = form.getElementsByClassName(\"step\");\n\t\ttry{\n\t\t\tx[n].classList.add(\"active\");\n\t\t}catch(err) {\n\t\t\tconsole.log(x);\n\t\t\tconsole.log(n);\n\t\t  \tconsole.error(err.message);\n\t\t}\n\t\t\n\n\t\t// ... and fix the Previous/Next buttons:\n\t\tif (n == 0) {\n\t\t\tform.querySelector('[name=\"prevBtn\"]').classList.add('hidden');\n\t\t} else {\n\t\t\tform.querySelector('[name=\"prevBtn\"]').classList.remove('hidden');\n\t\t}\n\n\t\tif (n == (x.length - 1)) {\n\t\t\tform.querySelector('[name=\"nextBtn\"]').classList.add('hidden');\n\t\t\tform.querySelector('.form-submit').classList.remove('hidden');\n\t\t} else {\n\t\t\tform.querySelector('[name=\"nextBtn\"]').classList.remove('hidden');\n\t\t\tform.querySelector('.form-submit').classList.add('hidden');\n\t\t}\n\t}else{\n\t\tconsole.log('no form defined');\n\t}\n\t\t\n}\n\n//next form step clicked\nexport function nextPrev(n, form) {\n\t// This function will figure out which tab to display\n\tlet x \t\t\t\t= form.querySelectorAll(\".formstep\");\n\tlet stepIndicators\t= form.querySelectorAll(\".step\");\n\tlet currentTab\t\t= 0;\n\tlet valid\t\t\t= true;\n\n\t// Find the current active tab\n\tx.forEach((el, index)=>{if(!el.matches('.step-hidden')){currentTab = index}});\n\t\n\t//Check validity of this step if going forward\n\tif(n>0){\n\t\t// Report validity of each required field\n\t\tlet elements\t= x[currentTab].querySelectorAll('.required:not(.hidden) input, .required:not(.hidden) textarea, .required:not(.hidden) select');\n\t\tfor(const element of elements) {\n\t\t\tif(\n\t\t\t\telement.closest('.hidden')\t== null\t&&\n\t\t\t\telement.closest('div.nice-select') == null && \n\t\t\t\t(\n\t\t\t\t\telement.type != 'file' || \n\t\t\t\t\telement.closest('.file-upload-wrap').querySelector('.documentpreview input') == null\n\t\t\t\t)\n\t\t\t){\n\t\t\t\telement.required\t= true;\n\t\t\t\tvalid\t\t\t\t= element.reportValidity();\n\t\t\t\tif(!valid){\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif(!valid) return;\n\t\t\n\t\t//mark the last step as finished\n\t\tstepIndicators[currentTab].classList.add(\"finish\");\n\t}else{\n\t\t//mark the last step as unfinished\n\t\tstepIndicators[currentTab].classList.remove(\"finish\");\n\t}\n\t\n\t//loop over all the formsteps to hide stepindicators of them if needed\n\tArray.from(x).forEach((formstep,index) =>{\n\t\tif(formstep.classList.contains('hidden')){\n\t\t\t//hide the corresponding circle\n\t\t\tstepIndicators[index].classList.add('hidden');\n\t\t}\n\t});\n\n\t// Increase or decrease the current tab by 1:\n\tcurrentTab = currentTab + n;\n\t\n\t//check if the next tab is hidden\n\twhile(x[currentTab].classList.contains('hidden')){\n\t\t//go to the next tab\n\t\tcurrentTab = currentTab + n;\n\n\t\tif (currentTab >= x.length) {\n\t\t\tbreak;\n\t\t}\n\t}\n\t\n\t// if you have reached the end of the form... :\n\tif (currentTab >= x.length) {\n\t\treturn false;\n\t}\n\t// Otherwise, display the correct tab:\n\tshowTab(currentTab,form);\n\n\treturn true;\n}\n\nexport function changeFieldValue(selector, value, functionRef, form, addition='', forceValue=false){\n\tif(value == undefined){\n\t\treturn;\n\t}\n\n\tlet name\t\t= '';\n\tlet target\t\t= '';\n\n\tif(selector instanceof Element){\n\t\ttarget\t\t= selector;\n\t\tname\t\t= target.name;\n\t\tif(target.id == ''){\n\t\t\tselector\t= `[name^=\"${target.name}\" i]`;\n\t\t}else{\n\t\t\tselector\t= `[id^=${target.id}]`;\n\t\t}\n\t\t\n\t}else{\n\t\ttarget \t\t= form.querySelector(selector);\n\n\t\ttry{\n\t\t\tname\t\t= target.name;\n\t\t}catch{\n\t\t\tconsole.log(target);\n\t\t}\n\t}\n\n\tlet oldValue\t= getFieldValue(target, form, false, value);\n\t// nothing to change\n\tif(oldValue == value){\n\t\treturn;\n\t}\n\n\t// Check if we are dealing with a multi input field\n\tif(target == null){\n\t\tlet targets \t= form.querySelectorAll(`.clone-div [name^=\"${name}\" i]`);\n\t\tif(targets.length === 0){\n\t\t\treturn;\n\t\t}else if(targets.length == 1){\n\t\t\ttarget\t= targets[0];\n\t\t\ttargets\t= '';\n\t\t}else{\n\t\t\ttarget\t= targets[0];\n\n\t\t\ttargets.forEach((el, index) =>{\n\t\t\t\tif(index == 0){\n\t\t\t\t\tchangeFieldValue(el, '', '', form);\n\t\t\t\t}else{\n\t\t\t\t\tremoveNode(el);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t// calculate the new value\n\tif(addition != ''){\n\t\t// check if a date\n\t\tif (/\\d{4}-\\d{2}-\\d{2}/.test(value)){\n\t\t\tlet date\t= new Date(value);\n\t\t\tdate.setDate(date.getDate() + parseInt(addition));\n\t\t\tvalue\t= date.toISOString().split('T')[0];\n\t\t}else{\n\t\t\tvalue\t= value + parseInt(addition);\n\t\t}\n\t}\n\t\n\tif(target.type == 'radio' || target.type == 'checkbox'){\n\t\t// uncheck all\n\t\tif(value == ''){\n\t\t\tif(selector != ''){\n\t\t\t\tform.querySelectorAll(selector).forEach(el=>el.checked=false);\n\t\t\t}\n\t\t}else{\n\t\t\t// Check if the current target is the one we need to check\n\t\t\tif(target.value.toLowerCase() == value.toLowerCase()){\n\t\t\t\ttarget.checked = true;\n\t\t\t}else{\n\t\t\t\t// find the element with the given value and check it\n\t\t\t\tlet targets = form.querySelectorAll(`[name=\"${name}\" i]`);\n\t\t\t\tfor (const element of targets) {\n\t\t\t\t\tif(element.value.toLowerCase() == value.toLowerCase()){\n\t\t\t\t\t\telement.checked = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t//the target has a list attached to it\n\t}else if(target.type == 'date'){\n\t\ttarget.value = value;\n\t\t\n\t\t// convert a date to the right format\n\t\tif (!/\\d{4}-\\d{2}-\\d{2}/.test(value)){\n\t\t\tlet splitted = '';\n\t\t\tif(value.split('-').length == 3){\n\t\t\t\tsplitted\t= value.split('-');\n\t\t\t}else if(value.split('/').length == 3){\n\t\t\t\tsplitted\t= value.split('/');\n\t\t\t}\n\n\t\t\tif(splitted != ''){\n\t\t\t\tlet year;\n\t\t\t\tlet month;\n\t\t\t\tlet day;\n\t\t\t\tsplitted.forEach(nr=>{\n\t\t\t\t\tif(nr.length == 4){\n\t\t\t\t\t\tyear\t= nr;\n\t\t\t\t\t}else if(nr.length == 2){\n\t\t\t\t\t\tif(nr > 12){\n\t\t\t\t\t\t\tday\t= nr;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t// does not have a value yet\n\t\t\t\t\t\t\tif(month == undefined){\n\t\t\t\t\t\t\t\tmonth\t= nr;\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\tday\t= nr;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif(day != undefined && month != undefined && year != undefined){\n\t\t\t\t\ttarget.value = `${year}-${month}-${day}`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}else if(target.list != null){\n\t\tlet dataListOption = target.list.querySelector(`[data-value=\"${value}\" i]`);\n\n\t\t//we found a match\n\t\tif(dataListOption != null){\n\t\t\t// We found a cloned field, add as many inputs as needed\n\t\t\tif(target.closest('.clone-div') != null){\n\t\t\t\t// mark the existing ones for deletion, we can delete right now as we need to copy the existing ones first\n\t\t\t\ttarget.closest('.clone-divs-wrapper').querySelectorAll('.clone-div').forEach(el=>el.classList.add('shouldremove'));\n\n\t\t\t\tlet clone;\n\t\t\t\tdataListOption.value.split(';').forEach(val=>{\n\t\t\t\t\tclone = copyFormInput(target.closest('.clone-div'));\n\n\t\t\t\t\tclone.classList.remove('shouldremove');\n\n\t\t\t\t\tchangeFieldValue(clone.querySelector(target.tagName), val, '', form, '', true);\n\t\t\t\t});\n\n\t\t\t\tfixNumbering(target.closest('.clone-divs-wrapper'));\n\n\t\t\t\t// delete the old ones\n\t\t\t\ttarget.closest('.clone-divs-wrapper').querySelectorAll('.shouldremove').forEach(el=>el.remove());\n\t\t\t}else{\n\t\t\t\ttarget.value = dataListOption.value;\n\t\t\t}\n\t\t// We did not find a match, we are filling in the given value\n\t\t}else if(forceValue){\n\t\t\ttarget.value = value;\n\t\t// We did not find a match, empty value\n\t\t}else{\n\t\t\ttarget.value = '';\n\t\t}\n\t}else{\n\t\ttarget.value = value;\n\t}\n\t\n\t//create a new event\n\tlet evt = new Event('input');\n\t//attach the target\n\ttarget.dispatchEvent(evt);\n\t\n\t//run the originating function with this event\n\tif(typeof functionRef == 'function'){\n\t\tfunctionRef(target);\n\t}\n}\n\nexport function changeVisibility(action, el, functionRef){\n\tlet wrapper\t= el.closest('.input-wrapper');\n\tif(wrapper == null){\n\t\twrapper\t= el\n\t}\n\t\n\tif(action == 'add'){\n\t\tif(wrapper.matches('.hidden')){\n\t\t\treturn;\n\t\t}\n\t\twrapper.classList.add('hidden');\n\t}else{\n\t\tif(!wrapper.matches('.hidden')){\n\t\t\treturn;\n\t\t}\n\t\twrapper.classList.remove('hidden');\n\t}\n\n\t//create a new event\n\tlet evt = new Event('input');\n\t//attach the target\n\twrapper.dispatchEvent(evt);\n\t\n\t//run the originating function with this event\n\tif(typeof functionRef == 'function'){\n\t\tfunctionRef(el);\n\t}\n}\n\nexport function changeFieldProperty(selector, att, value, functionRef, form, addition=''){\n\t//first change the value\n\tlet target = form.querySelector(selector);\n\n\t// calculate the new value\n\tif(addition != ''){\n\t\t// check if a date\n\t\tif (/\\d{4}-\\d{2}-\\d{2}/.test(value)){\n\t\t\tlet date\t= new Date(value);\n\t\t\tdate.setDate(date.getDate() + parseInt(addition));\n\t\t\tvalue\t= date.toISOString().split('T')[0];\n\t\t}else{\n\t\t\tvalue\t= value + parseInt(addition);\n\t\t}\n\t}\n\n\ttarget[att] = value;\n\t\n\t//create a new event\n\tlet evt = new Event('input');\n\n\t//attach the target\n\ttarget.dispatchEvent(evt);\n\n\t//run the originating function with this event\n\tfunctionRef(target);\n}","import { getFieldValue } from './field_value.js';\r\n\r\nlet oldValue;\r\n\r\nconsole.log(\"Table.js loaded\");\r\n\r\nfunction outsideClicked(event){\r\n\tif(event.target.closest('td') == null || !event.target.closest('td').matches('.editing')){\r\n\t\tevent.stopPropagation();\r\n\t\t\r\n\t\t//remove as soon as we come here\r\n\t\tdocument.removeEventListener('click', outsideClicked);\r\n\t\tprocessInput(event, document.querySelector('.editing input, .editing select, .editing textarea'));\r\n\t}\r\n}\r\n\r\nfunction addInputEventListeners(cell){\r\n\tlet inputs\t= cell.querySelectorAll('input,select,textarea');\r\n\t\t\r\n\tinputs.forEach(inputnode => {\r\n\t\t//add old value\r\n\t\toldValue.split(',').forEach(val=>{\r\n\t\t\tif(inputnode.type == 'checkbox' || inputnode.type == 'radio'){\r\n\t\t\t\tif(inputnode.value == val.trim()){\r\n\t\t\t\t\tinputnode.checked = true;\r\n\t\t\t\t}\r\n\t\t\t}else if(inputnode.type == 'select'){\r\n\t\t\t\tinputnode.querySelector('option[value=\"'+val+'\"]').selected = true;\r\n\t\t\t}else{\r\n\t\t\t\tinputnode.value\t= oldValue;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tif(inputnode.type == 'select-one' && inputnode._niceSelect == undefined){\r\n\t\t\tMain.attachNiceSelect(inputnode);\r\n\t\t}\r\n\t\t\r\n\t\t//Add a keyboard\r\n\t\tinputnode.addEventListener(\"keyup\", function(event){\r\n\t\t\tif (event.keyCode === 13) {\r\n\t\t\t\tprocessInput(event);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t//add a listener for clicks outside the cell\r\n\t\tdocument.addEventListener('click', outsideClicked);\r\n\t\t\r\n\t\tif(inputnode.type != 'checkbox' || inputs.length == 1){\r\n\t\t\tif(inputnode.type == 'date'){\r\n\t\t\t\tinputnode.addEventListener(\"blur\", function(event){\r\n\t\t\t\t\t//only process if we added a value\r\n\t\t\t\t\tif(event.target.value != ''){\r\n\t\t\t\t\t\tprocessInput(event);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\tinputnode.addEventListener(\"change\", function(event){\r\n\t\t\t\t\t//only process if we added a value\r\n\t\t\t\t\tif(event.target.value != ''){\r\n\t\t\t\t\t\tprocessInput(event);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tinputnode.focus();\r\n\t\t}\r\n\t});\r\n}\r\n\r\n//function to change a cells contents\r\nfunction editTd(target){\r\n\ttarget.closest('td').classList.add('editing');\r\n\r\n\t//element is already edited\r\n\r\n\toldValue\t= target.textContent;\r\n\tif (oldValue == \"Click to update\" || oldValue == \"X\"){\r\n\t\toldValue = \"\";\r\n\t}\r\n\t\r\n\ttarget.innerHTML = `<input type=\"text\" value=\"${oldValue}\">`;\r\n\r\n\taddInputEventListeners(target);\r\n}\r\n\r\n//function to get the temp input value and save it using the rest api\r\nasync function processInput(event, target){\r\n\tif(typeof(target) == 'undefined'){\r\n\t\ttarget\t= event.target;\r\n\t}\r\n\t\r\n\tlet cell \t\t\t= target.closest('td');\t\r\n\tlet value\t\t\t= getFieldValue(target, cell, false);\r\n\tlet table\t\t\t= target.closest('table');\r\n\t\r\n\t//Only update when needed\r\n\tif (value != oldValue){\t\t\r\n\t\t//get the updated fieldname from the column header\r\n\t\tlet formData = new FormData();\r\n\t\tformData.append('value', JSON.stringify(value));\r\n\r\n\t\tfor( let key in cell.dataset){\r\n\t\t\tformData.append(key, cell.dataset[key]);\r\n\t\t}\r\n\t\tfor( let key in target.closest('tr').dataset){\r\n\t\t\tformData.append(key, target.closest('tr').dataset[key]);\r\n\t\t}\r\n\t\t\r\n\t\tMain.showLoader(cell.firstChild);\r\n\t\t\r\n\t\tlet response = await FormSubmit.fetchRestApi(table.dataset.url, formData);\r\n\r\n\t\tif(response){\r\n\t\t\tcell.innerHTML = value;\r\n\r\n\t\t\t//reset editing indicator\r\n\t\t\t//let editedel = '';\r\n\t\t}\r\n\t}else{\r\n\t\tconsole.log(value)\r\n\t\ttarget.closest('td').innerHTML = oldValue;\r\n\t}\r\n\r\n\tcell.classList.remove('editing');\r\n}\r\n\r\n//function to sort a table by column\r\nfunction sortTable(target){\r\n\tlet table \t\t\t= target.closest('table');\r\n\tlet switching\t \t= true;\r\n\tlet x,y, rows;\r\n\tvar sort \t\t= 'asc';\r\n\t\r\n\t//Check the sort order\r\n\tif (target.classList.contains('desc')){\r\n\t\tsort \t\t= 'desc';\r\n\t}\r\n\t\r\n\t/*Make a loop that will continue until\r\n\tno switching has been done:*/\r\n\twhile (switching) {\r\n\t\t//start by saying: no switching is done:\r\n\t\tswitching\t= false;\r\n\t\trows\t\t= table.rows;\r\n\t\t/*Loop through all table rows (except the\r\n\t\tfirst, which contains table headers):*/\r\n\t\tfor (let i = 1; i < (rows.length - 1); i++) {\r\n\t\t\t// Get the lowercase cell contents\r\n\t\t\tx = rows[i].getElementsByTagName(\"TD\")[target.cellIndex].innerHTML.toLowerCase();\r\n\t\t\ty = rows[i + 1].getElementsByTagName(\"TD\")[target.cellIndex].innerHTML.toLowerCase();\r\n\t\t\t\r\n\t\t\t//check if numeric\r\n\t\t\tif(!isNaN(x) && !isNaN(y)){\r\n\t\t\t\tx = parseFloat(x);\r\n\t\t\t\ty = parseFloat(y);\r\n\t\t\t}else{\r\n\t\t\t\t//check if these are dates\r\n\t\t\t\tlet datex = new Date(x);\r\n\t\t\t\tlet datey = new Date(y);\r\n\t\t\t\tif(datex !== \"Invalid Date\" && !isNaN(datex) && datex.getYear()!=70 && datey !== \"Invalid Date\" && !isNaN(datey) && datey.getYear()!=70){\r\n\t\t\t\t\tx = datex.getTime();\r\n\t\t\t\t\ty = datey.getTime();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//check if the two rows should switch place ASC:\r\n\t\t\tif ((sort == 'asc' && x > y) || (sort == 'desc'  && y > x)) {\r\n\t\t\t\t//Switch positions of the rows and start over\r\n\t\t\t\trows[i].parentNode.insertBefore(rows[i + 1], rows[i]);\r\n\t\t\t\tswitching = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t//Mark the row to sort desc the next time\r\n\tif (sort == 'asc'){\r\n\t\ttarget.classList.add('desc');\r\n\t\ttarget.classList.replace('asc', 'desc');\r\n\t//Mark the row to sort asc the next time\r\n\t}else{\r\n\t\ttarget.classList.replace('desc', 'asc');\r\n\t}\r\n}\r\n\r\n//Store the table headers as td attribute for use on smaller screens\r\nexport function setTableLabel() {\r\n\t//Loop over all tables\r\n\tdocument.querySelectorAll('.sim-table').forEach(function(table){\r\n\t\t//Get all heading elements\r\n\t\tlet tdLabels = [];\r\n\t\ttable.querySelectorAll('thead th').forEach((el,index) => {\r\n\t\t\tif(el.dataset.nicename != null){\r\n\t\t\t\ttdLabels[index]\t= el.dataset.nicename;\r\n\t\t\t}else{\r\n\t\t\t\ttdLabels[index]\t= el.textContent;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t//loop over all table rows\r\n\t\ttable.querySelectorAll('tbody td').forEach( (td) => {\r\n\t\t\tif(!td.hasAttribute('label') && tdLabels[td.cellIndex] != undefined){\r\n\t\t\t\t//set the header text as label\r\n\t\t\t\ttd.setAttribute('label', tdLabels[td.cellIndex]);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(td.textContent == 'X' || td.textContent == ''){\r\n\t\t\t\ttd.classList.add('mobile-hidden');\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\nasync function showFullscreen(target){\r\n\ttarget.textContent\t= 'Close full screen';\r\n\ttarget.classList.replace('show', 'close');\r\n\r\n\tlet parent\t= target.closest('.table-wrapper');\r\n\r\n\t//store current y position\r\n\twindow.lastY\t= window.pageYOffset;\r\n\r\n\twindow.scrollTo(0,0);\r\n\r\n\t// remove scrollbars from body\r\n\tdocument.querySelector('body').style.overflow\t= 'hidden';\r\n\r\n\tdocument.querySelector('header').style.zIndex\t= 'unset';\r\n\r\n\tparent.classList.add('fullscreen');\r\n\r\n\tparent.style.marginLeft\t= '0px';\r\n\r\n\tlet url = new URL(window.location);\r\n\r\n\turl.searchParams.set('fullscreen', parent.querySelector('table').dataset.formid);\r\n\r\n\twindow.history.pushState({}, '', url);\r\n\r\n\tsetTableHeight();\r\n\r\n\tparent.requestFullscreen().catch((err) => {\r\n\t\t// does not work without user interaction\r\n\t});\r\n}\r\n\r\nfunction closeFullscreen(target){\r\n\tlet lastY\t= 100;\r\n\r\n\ttarget.textContent\t= 'Show full screen';\r\n\ttarget.classList.replace('close','show');\r\n\r\n\tif(window.lastY != undefined){\r\n\t\tlastY\t= window.lastY;\r\n\t}\r\n\twindow.scrollTo(0, lastY);\r\n\t\r\n\tconsole.log('scrolling')\r\n\r\n\t// remove scrollbars from body\r\n\tdocument.querySelector('body').style.overflow\t= 'unset';\r\n\r\n\tdocument.querySelector('header').style.zIndex\t= '99999';\r\n\r\n\ttarget.closest('.table-wrapper').classList.remove('fullscreen');\r\n\r\n\tpositionTable();\r\n\r\n\tlet url = new URL(window.location);\r\n\r\n\turl.searchParams.delete('fullscreen');\r\n\r\n\twindow.history.pushState({}, '', url);\r\n\r\n\tdocument.exitFullscreen();\r\n\r\n\tsetTableHeight();\r\n}\r\n\r\nfunction setTableHeight(){\r\n\tlet urlParams = new URLSearchParams(window.location.search);\r\n\tlet\tfullscreen\t= urlParams.get('fullscreen');\r\n\r\n\t// calculate how heigh the table should be\r\n\tlet footerHeight, headerHeight;\r\n\tdocument.querySelectorAll('.sim-table').forEach( table => {\r\n\t\tlet wrapper\t= table.closest('.table-wrapper');\r\n\t\tif(wrapper == null){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif(fullscreen != null){\r\n\t\t\theaderHeight\t= 0;\r\n\t\t\twrapper.querySelectorAll('.table-head').forEach(el=> headerHeight = el.offsetHeight);\r\n\t\t}else{\r\n\t\t\theaderHeight\t= document.querySelector('header').offsetHeight;\r\n\t\t}\r\n\t\t\r\n\t\tfooterHeight\t= 0;\r\n\t\twrapper.querySelectorAll('.sim-table-footer').forEach(el=> footerHeight\t= el.offsetHeight);\r\n\r\n\t\tlet px\t= headerHeight + footerHeight + 40;\r\n\t\ttable.style.maxHeight\t= `calc(100vh - ${px}px)`;\r\n\t});\t\r\n}\r\n\r\nexport function positionTable(){\r\n\t//use whole page width for tables\r\n\tdocument.querySelectorAll(\".table-wrapper\").forEach(wrapper=>{\r\n\t\tlet offset\t\t= '';\r\n\t\tlet newX\t\t= 0;\r\n\r\n\t\tlet table\t= wrapper.querySelector('table');\r\n\t\tif(table == null){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet width\t= table.scrollWidth;\r\n\t\tif(width == 0){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\t// If on small width use full screen\r\n\t\tif(window.innerWidth < 570){\r\n\t\t\toffset\t= wrapper.getBoundingClientRect().x\r\n\t\t}else{\r\n\t\t\tlet diff\t= window.innerWidth - width;\r\n\t\t\t\r\n\t\t\t//calculate if room for sidebar if one exists\r\n\t\t\tif((width/window.innerWidth) < 0.7){\r\n\t\t\t\tif(document.querySelector('.is-right-sidebar') != null){\r\n\t\t\t\t\tdiff\t= (window.innerWidth * 0.7) - width;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tdocument.getElementById('primary').style.zIndex = 1;\r\n\r\n\t\t\t\t//sidebar behind table\r\n\t\t\t\tdocument.querySelectorAll('#right-sidebar').forEach(el=>el.style.zIndex = 0);\r\n\t\t\t}\r\n\r\n\t\t\t//Table needs full screen width\r\n\t\t\tif(diff < 20){\r\n\t\t\t\tnewX = 10;\r\n\t\t\t//center the table\r\n\t\t\t}else{\r\n\t\t\t\tnewX = diff/2; \r\n\t\t\t}\t\t\t\r\n\t\t\t\r\n\t\t\t//first set it back to default\r\n\t\t\tif(wrapper.style.marginLeft != ''){\r\n\t\t\t\twrapper.style.marginLeft = '-0px';\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//then calculate the required offset\r\n\t\t\toffset\t= parseInt(wrapper.getBoundingClientRect().x)-newX;\r\n\t\t}\r\n\r\n\t\twrapper.style.marginLeft = `-${offset}px`;\r\n\t});\r\n}\r\n\r\nexport const hideColumn\t= async (target) => {\r\n\tif(target.tagName == 'SPAN'){\r\n\t\ttarget = target.querySelector('img');\r\n\t}\r\n\r\n\tlet cell;\r\n\r\n\t// Table itself\r\n\tif(target.parentNode.matches('th')){\r\n\t\tcell \t= target.parentNode;\r\n\t}else if(target.matches('th')){\r\n\t\tcell\t= target;\r\n\t}\r\n\r\n\tif(cell){\r\n\t\t// Hide the column\r\n\t\tlet table\t\t= cell.closest('table');\r\n\t\tlet tableRows\t= table.rows;\r\n\t\tfor (const element of tableRows) {\r\n\t\t\telement.cells[cell.cellIndex].classList.add('hidden')\r\n\t\t}\r\n\r\n\t\t// store the hidden column in a var\r\n\t\tif(sim.hidden\t== undefined){\r\n\t\t\tsim.hidden\t= [];\r\n\t\t}\r\n\t\tsim.hidden.push(cell.cellIndex);\r\n\r\n\t\t//show the reset button\r\n\t\tcell.closest('.table-wrapper').querySelectorAll('.reset-col-vis').forEach(el => el.classList.remove('hidden'));\r\n\t}\r\n}\r\n\r\nasync function showHiddenColumns(target){\r\n\t//hiden the reset button\r\n\ttarget.closest('.table-wrapper').querySelector('.reset-col-vis').classList.add('hidden');\r\n\r\n\t// Show the columns again\r\n\tlet table\t\t= target.closest('.form.table-wrapper').querySelector('table');\r\n\ttable.querySelectorAll('th.hidden, td.hidden').forEach(el=>el.classList.remove('hidden'));\r\n}\r\n\r\ndocument.addEventListener(\"click\", event => {\r\n\tlet target = event.target;\r\n\t\r\n\tif(target.tagName == 'TH'){\r\n\t\tsortTable(target);\r\n\t}\r\n\t\r\n\t//Edit data\r\n\tlet td = target.closest('td');\r\n\tif(target.matches('td.edit')){\r\n\t\tevent.stopPropagation();\r\n\t\teditTd(target);\r\n\t}else if(td != null && td.matches('td.edit') && target.tagName != 'INPUT' && target.tagName != 'A' && target.tagName != 'TEXTAREA' && !target.closest('.nice-select') ){\r\n\t\tevent.stopPropagation();\r\n\t\teditTd(target.closest('td'));\r\n\t}else if(target.matches('.show.fullscreenbutton')){\r\n\t\tshowFullscreen(target);\r\n\t}else if(target.matches('.close.fullscreenbutton')){\r\n\t\tcloseFullscreen(target);\r\n\t}\r\n\r\n\t//Hide column\r\n\telse if(target.classList.contains('visibility-icon')){\r\n\t\thideColumn(target);\r\n\t}\r\n\r\n\t// Show all columns again\r\n\telse if(target.matches('.reset-col-vis')){\r\n\t\tshowHiddenColumns(target);\r\n\t}\r\n});\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", function() {\r\n\t\r\n\tpositionTable();\r\n\twindow.addEventListener('resize', positionTable);\r\n\t\r\n\t//add label attribute\r\n\tsetTableLabel();\r\n\r\n\tlet urlParams = new URLSearchParams(window.location.search);\r\n\tlet\tfullscreen\t= urlParams.get('fullscreen');\r\n\r\n\tif(fullscreen != null){\r\n\t\ttry{\r\n\t\t\tshowFullscreen(document.querySelector(`table[data-formid=\"${fullscreen}\"]`).closest('.table-wrapper').querySelector('.fullscreenbutton')); \r\n\t\t}catch{\r\n\t\t\tconsole.error(`table[data-formid=\"${fullscreen}\"]`);\r\n\t\t}\r\n\t}\r\n\r\n\tsetTableHeight();\r\n});\r\n","function getRadioValue(form, selector){\r\n\tlet el\t= form.querySelector(`${selector}:checked`);\r\n\r\n\t//There is no radio selected currently\r\n\tif(el == null){\r\n\t\t//return an empty value\r\n\t\treturn '';\r\n\t}\r\n\r\n\treturn el.value;\r\n}\r\n\r\nfunction getCheckboxValue(form, selector, compareValue, orgName){\r\n\tlet value\t\t= '';\r\n\tlet elements\t= '';\r\n\r\n\t//we are dealing with a specific checkbox\r\n\tif(orgName.type == 'checkbox' && compareValue != null ){\r\n\t\tif(orgName.checked){\r\n\t\t\treturn orgName.value;\r\n\t\t}\r\n\t\t\r\n\t\treturn '';\r\n\t}\r\n\r\n\t//we should find the checkbox with this value and check if it is checked\r\n\tif(compareValue != null){\r\n\t\telements\t= form.querySelector(`${selector}[value=\"${compareValue}\" i]:checked`);\r\n\t\tif(elements != null){\r\n\t\t\tvalue = compareValue;\r\n\t\t}\r\n\t//no compare value give just return all checked values\r\n\t}else{\r\n\t\telements\t= form.querySelectorAll(`${selector}:checked`);\r\n\t\tvalue\t\t= [];\r\n\t\telements.forEach(el=>{\r\n\t\t\tvalue.push(el.value);\r\n\t\t\t/* if(value != ''){\r\n\t\t\t\tvalue += ', ';\r\n\t\t\t}\r\n\t\t\tvalue += el.value; */\r\n\t\t});\r\n\t}\r\n\r\n\treturn value;\r\n}\r\n\r\nfunction getMultiValue(form, el){\r\n\tlet value = [];\r\n\r\n\tform.querySelectorAll(`[name=\"${el.name}\"]`).forEach(elem => value.push(elem.value));\r\n\r\n\treturn value;\r\n}\r\n\r\nexport function getDataListValue(el){\r\n\tlet value\t\t= '';\r\n\tlet origInput \t= el.list.querySelector(`[value='${el.value}' i]`);\r\n\t\t\t\r\n\tif(origInput == null){\r\n\t\tvalue =  el.value;\r\n\t}else{\r\n\t\tvalue = origInput.dataset.value;\r\n\t}\r\n\r\n\treturn value;\r\n}\r\n\r\nexport function getFieldValue(orgName, form, checkDatalist=true, compareValue=null, lowercase=false){\r\n\r\n\tlet el\t\t\t= ''; \r\n\tlet name\t\t= '';\r\n\tlet value \t\t= '';\r\n\tlet selector\t= '';\r\n\r\n\t//name is not a name but a node\r\n\tif(orgName instanceof Element){\r\n\t\tel\t\t\t= orgName;\t\t\r\n\t\t//check if valid input type\r\n\t\tif(el.tagName != 'INPUT' && el.tagName != 'TEXTAREA' && el.tagName != 'SELECT' && el.closest('.nice-select-dropdown') == null){\r\n\t\t\tel = el.querySelector('input, select, textarea');\r\n\t\t}\r\n\t\tif(el == null){\r\n\t\t\tel\t\t\t= orgName;\r\n\t\t}\r\n\t\tname\t\t= el.name;\r\n\t// We should look for an id\r\n\t}else if(orgName.match(\"E[0-9]\")){\r\n\t\tselector\t= `[id^=${orgName}]`;\r\n\t\tel\t\t\t= form.querySelector(selector);\r\n\t\tname\t\t= el.name;\r\n\t}else{\r\n\t\tname\t\t= orgName;\r\n\t\tselector\t= `[name='${name}' i]`;\r\n\t\tel\t\t\t= form.querySelector(selector);\r\n\t}\r\n\t\r\n\tif(el == null){\r\n\t\tconsole.trace();\r\n\t\tconsole.log(\"cannot find element with name \"+name);\r\n\r\n\t\treturn value;\r\n\t}\r\n\r\n\tif(el.type == 'radio'){\r\n\t\tvalue\t= getRadioValue(form, selector);\r\n\t}else if(el.type == 'checkbox'){\r\n\t\tvalue\t= getCheckboxValue(form, selector, compareValue, orgName);\t\r\n\t}else if(el.closest('.nice-select-dropdown') != null && el.dataset.value != undefined){\r\n\t\t//nice select\r\n\t\tvalue = el.dataset.value\r\n\t}else if(el.list != null && el.value != '' && checkDatalist){\r\n\t\tvalue =  getDataListValue(el);\r\n\t}else if(el.name != undefined && el.name.endsWith('[]')){\r\n\t\tvalue =  getMultiValue(form, el);\r\n\t}else if(el.value != null && el.value != 'undefined'){\r\n\t\tvalue = el.value;\r\n\t}\r\n\t\r\n\tif(lowercase){\r\n\t\treturn value.toLowerCase();\r\n\t}\r\n\treturn value;\r\n}","import { cloneNode } from \"../../forms/js/form_exports.js\";\r\nimport { setTableLabel, hideColumn } from \"../../../plugins/sim-plugin/includes/js/table.js\";\r\n\r\nconsole.log(\"library.js loaded\");\r\n\r\nasync function addBook(target){\r\n\tlet cell\t\t\t= target.closest('td');\r\n\tlet row\t\t\t\t= target.closest('tr');\r\n\tlet formData\t\t= new FormData();\r\n\r\n\trow.querySelectorAll('input, textarea').forEach(input => {\r\n\t\tif(input.type != 'checkbox' || input.checked){\r\n\t\t\tformData.append(input.name, input.value);\r\n\t\t}\r\n\t});\r\n\r\n\trow.querySelectorAll('td > img').forEach(img=>formData.append('image', img.src));\r\n\r\n\ttarget.classList.add('hidden');\r\n\tcell.querySelector(`.loader-wrapper`).classList.remove('hidden');\r\n\r\n\tlet response\t= await FormSubmit.fetchRestApi('library/add_book', formData);\r\n\t\r\n\tif(response){\r\n\t\tcell.innerHTML\t= response;\r\n\r\n\t\tMain.displayMessage(response.message);\r\n\r\n\t\trow.classList.add('processed');\r\n\t}else{\r\n\t\ttarget.classList.remove('hidden');\r\n\t\tcell.querySelector(`.loader-wrapper`).classList.add('hidden');\r\n\r\n\t\ttarget.remove();\r\n\t}\r\n}\r\n\r\nlet fileUploadWrap, totalFiles;\r\nasync function fileUpload(target, location){\r\n\ttotalFiles \t\t= target.files.length;\r\n\r\n\tif (totalFiles < 0){\r\n\t\treturn;\r\n\t}\r\n\t\r\n\t//Create a formData element\r\n\tlet formData = new FormData();\r\n\t\r\n\t//Add the ajax action name\r\n\tformData.append('action', 'process_library_upload');\r\n\r\n\tformData.append('location', location);\r\n\r\n\t//Add all the files to the formData\r\n\tfor (let index = 0; index < totalFiles; index++) {\r\n\t\tlet file\t= target.files[index];\r\n\t\tformData.append('files[]', file);\r\n\t}\r\n\t\r\n\t//AJAX request\r\n\tlet request = new XMLHttpRequest();\r\n\t\r\n\t//Listen to the state changes\r\n\trequest.onreadystatechange = readyStateChanged;\r\n\t\r\n\t//Listen to the upload status\r\n\trequest.upload.addEventListener('progress', fileUploadProgress, false);\r\n\t\r\n\trequest.open('POST', sim.ajaxUrl, true);\r\n\t\r\n\t// Show loading gif\r\n\tfileUploadWrap.querySelectorAll(\".loader-wrapper\").forEach(loader =>{\r\n\t\tloader.classList.remove('hidden');\r\n\t\tloader.querySelectorAll(\".loader-text\").forEach(el =>{\r\n\t\t\tel.textContent = \"Preparing upload\";\r\n\t\t\tel.classList.add('upload-message');\r\n\t\t});\r\n\t});\r\n\t\r\n\t//Send AJAX request\r\n\tfileUploadWrap.querySelector('.loader-text').textContent = \"Uploading Picture(s)\";\r\n\tdocument.getElementById('progress-wrapper').classList.remove('hidden');\r\n\r\n\ttry{\r\n\t\trequest.send(formData);\r\n\t} catch(e){\r\n\t\tconsole.error('Error fetching book data:', e);\r\n\t\tMain.displayMessage(e);\r\n\t}\r\n}\r\n\r\nfunction fileUploadProgress(e){\r\n\tif(e.lengthComputable){\r\n\t\tlet max \t\t= e.total;\r\n\t\tlet current \t= e.loaded;\r\n\r\n\t\tlet percentage \t= (current * 100)/max;\r\n\t\tpercentage \t\t= Math.round(percentage * 10) / 10\r\n\t\t\r\n\t\tdocument.querySelectorAll(\"#upload-progress\").forEach(el=>el.value = percentage);\r\n\t\tdocument.querySelectorAll(\"#progress-percentage\").forEach(el=>el.textContent\t= `   ${percentage}%`);\r\n\r\n\t\tif(percentage >= 99){\r\n\t\t\t//Remove progress barr\r\n\t\t\tdocument.getElementById(\"progress-wrapper\").classList.add('hidden');\r\n\t\t\t\r\n\t\t\t// process completed\r\n\t\t\tfileUploadWrap.querySelectorAll(\".loader-text\").forEach(el =>{\r\n\t\t\t\t//Change message text\r\n\t\t\t\tif (totalFiles > 1){\r\n\t\t\t\t\tel.textContent = \"Processing images\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\tel.textContent = \"Processing image\";\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}  \r\n}\r\n\r\nfunction readyStateChanged(e){\r\n\tlet request\t= e.target;\r\n\t\r\n\t//If finished\r\n\tif(request.readyState == 4){\r\n\t\t//Success\r\n\t\tif (request.status >= 200 && request.status < 400) {\r\n\t\t\tfileUploadSucces(request.responseText)\r\n\t\t//Error\r\n\t\t}else{\r\n\t\t\tconsole.error(request.responseText);\r\n\t\t\tMain.displayMessage(JSON.parse(request.responseText).error,'error');\r\n\t\t}\r\n\t\t\r\n\t\t//Hide loading gif\r\n\t\tdocument.querySelectorAll(\".loader-wrapper\").forEach(\r\n\t\t\tfunction(loader){\r\n\t\t\t\tloader.classList.add('hidden');\r\n\t\t\t}\r\n\t\t);\r\n\t\t\t\r\n\t\t//Clear the input\r\n\t\tfileUploadWrap.querySelector('input[type=\"file\"]').value = \"\";\r\n\t}\r\n}\r\n\r\nasync function fileUploadSucces(result){\r\n\tlet json\t\t= JSON.parse(result);\r\n\r\n\tif(!json.success){\r\n\t\tMain.displayMessage(`The files failed to process:<br>${json.data[0].message}`, 'error');\r\n\r\n\t\tdocument.querySelectorAll(`.image-selector-wrap.hidden`).forEach(el=>el.classList.remove('hidden'));\r\n\r\n\t\tfileUploadWrap.querySelectorAll('.image-preview').forEach(el => el.remove());\r\n\r\n\t\treturn;\r\n\t}\r\n\r\n\tlet div \t\t= document.createElement('div');\r\n\tdiv.innerHTML\t= json.data;\r\n\tfileUploadWrap.prepend(div);\r\n\r\n\tMain.displayMessage(\"The files have been processed succesfully.\", 'success', true);\r\n\r\n\tfileUploadWrap.querySelector('.image-selector-wrap').classList.remove('hidden');\r\n\r\n\t// Create a custom event so others can listen to it.\r\n\t// Used by formstable uploads\r\n\tconst event = new Event('uploadfinished');\r\n\tfileUploadWrap.dispatchEvent(event);\r\n\r\n\tawait fetchMetaDatas();\r\n\r\n\t// Run this only when all rows are processed\r\n\tsetTableLabel();\r\n\r\n\tif(sim.hidden != undefined){\r\n\t\tsim.hidden.forEach(col => hideColumn(div.querySelectorAll(`.sim-table th`)[col]));\r\n\t}\r\n}\r\n\r\nasync function fetchMetaDatas(){\r\n\tlet promiseArray = [];\r\n\r\n\tfileUploadWrap.querySelectorAll('table tr').forEach(async (tr) => {\r\n\t\tpromiseArray.push(fetchMetaData(tr));\r\n\t});\r\n\r\n\tawait Promise.all(promiseArray);\r\n}\r\n\r\nasync function fetchMetaData(tr){\r\n\ttry{\r\n\t\t// Check if a book row\r\n\t\tif(tr.querySelector('.title') == null){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet title\t= tr.querySelector('.title').value;\r\n\r\n\t\t// Only search for the first author\r\n\t\tlet author\t= tr.querySelector('.author').value.trim();\r\n\t\tlet url     = `https://openlibrary.org/search.json?q=`+encodeURIComponent(`title:${title}`);\r\n\t\tif(author != ''){\r\n\t\t\turl += encodeURIComponent(` author:${author}`)+'&limit=1';\r\n\t\t}\r\n\t\turl += '&fields=key,title,author_name,subtitle,alternative_subtitle,cover_i,language,number_of_pages_median,first_publish_year,description,subjects';\r\n\r\n\t\tconst response \t= await fetch(url);\r\n\t\tconst data \t\t= await response.json();\r\n\t\tlet bookData    = data['docs'][0] ?? [];\r\n\r\n\t\t// If no book data found, create a list with possible authors\r\n\t\tif(bookData.length == 0 && author == ''){\r\n\t\t\tlet id\t= `authorlist-${title.replaceAll(\" \", \"_\").replaceAll(\"'\", \"\")}`;\r\n\t\t\ttr.querySelectorAll('.author').forEach(el => el.setAttribute(\"list\", id));\r\n\r\n\t\t\tlet list = `<datalist id='${id}' class='author-selection'>`;\r\n\r\n\t\t\tdata['docs'].forEach((doc) => {\r\n\t\t\t\tif(doc['author_name'] != undefined){\r\n\t\t\t\t\tlist += `<option value='${doc['author_name'].join()}'>`;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tlist += `</datalist>`;\r\n\t\t\ttr.querySelector('.authors').insertAdjacentHTML('afterEnd', list);\r\n\t\t}else{\r\n\t\t\tlet authors \t= bookData['author_name'] ?? [author];\r\n\t\t\tlet wrapper \t= tr.querySelector(`.authors.clone-divs-wrapper`);\r\n\t\t\tlet baseElement = wrapper.querySelector(`.clone-div`);\r\n\r\n\t\t\tauthors.forEach(author => {\r\n\t\t\t\tlet clone\t\t= cloneNode(baseElement);\r\n\t\t\t\tclone.querySelector('.author').value = author;\r\n\r\n\t\t\t\twrapper.appendChild(clone);\r\n\t\t\t});\t\t\r\n\t\t\t\r\n\t\t\tbaseElement.remove()\r\n\t\t}\r\n\r\n\t\tlet image        = bookData['cover_i'] ?? '';\r\n        if(image != ''){\r\n           \tlet  smallUrl    = `https://covers.openlibrary.org/b/id/${image}-S.jpg`;\r\n\t\t   \tlet  largeUrl    = `https://covers.openlibrary.org/b/id/${image}-L.jpg`;\r\n\r\n\t\t\ttr.querySelector('.image').innerHTML = `<input type='hidden' name='image' value='${image}'><a href='${largeUrl}' target='_blank'><img src='${smallUrl}' class='book-image' loading='lazy'></a>`;\r\n        }\r\n\r\n\t\tlet subtitle\t= bookData['subtitle'] ?? '';\r\n\r\n\t\tlet year\t\t= bookData['first_publish_year'] ?? '';\r\n\t\tyear\t\t\t= year[0] ?? year;\r\n\r\n\t\tlet language\t= bookData['language'] ?? '';\r\n\t\tlanguage\t\t= language[0] ?? language;\r\n\r\n\t\tlet pageCount\t\t= bookData['number_of_pages'] ?? bookData['number_of_pages_median'] ?? '';\r\n\r\n\t\tlet html = `<td><input type='text' name='subtitle' class='subtitle' value='${subtitle}'></td>`;\r\n\t\thtml += `<td><input type='text' name='series' class='series' value='${bookData['series'] ?? ''}'></td>`;\r\n\t\thtml += `<td><input type='text' name='year' class='year' value='${year}'></td>`;\r\n\t\thtml += `<td><input type='text' name='language' class='language' value='${language}'></td>`;\r\n\t\thtml += `<td><input type='text' name='pages' class='pages' value='${pageCount}'></td>`;\r\n\r\n\t\tlet placeholder\t= tr.querySelector('.placeholder');\r\n\t\tif(placeholder == null){\r\n\t\t\ttr.querySelector('.subtitle').value = subtitle;\r\n\t\t\ttr.querySelector('.series').value \t= bookData['series'] ?? '';\r\n\t\t\ttr.querySelector('.year').value \t= year;\r\n\t\t\ttr.querySelector('.language').value = language;\r\n\t\t\ttr.querySelector('.pages').value \t= pageCount;\r\n\t\t}else{\r\n\t\t\tplaceholder.outerHTML = html;\r\n\t\t}\r\n\r\n        let description\t= tr.querySelector('.description').value\r\n\t\tdescription\t\t= bookData['description'] != undefined ? bookData['description']['value'] != undefined ? bookData['description']['value'] : '' : '';\r\n\r\n\t\tlet key        \t= bookData['key'] ?? '';\r\n\t\tlet workJson\t= '';\r\n        if(key != ''){\r\n            url      = `https://openlibrary.org${key}`;\r\n\t\t\ttr.querySelector('.url').innerHTML = `\r\n\t\t\t<input type='hidden' name='url' value='${url}'>\r\n\t\t\t<a href='${url}' target='_blank'>View on Open Library</a>\r\n\t\t\t`;\r\n\r\n\t\t\t// Fetch the summary from the Open Library API\r\n\t\t\tconst workResponse \t= await fetch(url+'.json');\r\n\t\t\tworkJson \t\t\t= await workResponse.json();\r\n\r\n\t\t\tdescription \t\t= workJson['description'] ?? '';\t\r\n\t\t\t\r\n\t\t\tdescription \t\t= description.value ?? description;\r\n\r\n\t\t\tif(\tworkJson['subjects'] != undefined ){\r\n\t\t\t\tworkJson['subjects'].forEach((subject) => {\r\n\t\t\t\t\ttr.querySelectorAll(`.category-select [data-name=\"${subject}\"]`).forEach((el) => el.checked = true);\r\n\t\t\t\t});\r\n\t\t\t}\r\n        }\r\n\r\n\t\tif(description != ''){\r\n\t\t\ttr.querySelector('.description').value = description;\r\n\t\t}\r\n\r\n\t\t// add book automatically if there is a picture and description\r\n\t\tif(image != '' && key != '' && typeof(workJson) != 'undefined' && workJson['subjects'] != undefined){\r\n\t\t\ttr.querySelector('.add-book').click();\r\n\t\t}\r\n\t} catch(e){\r\n\t\tconsole.error('Error fetching book data:', e);\r\n\t}\r\n}\r\n\r\nfunction hideCss(type){\r\n\tlet style = document.createElement('style');\r\n\tstyle.innerHTML = `.${type} { display: none; }`;\r\n\tdocument.getElementsByTagName('head')[0].appendChild(style);\r\n\r\n\tconst url \t\t= new URL(window.location);\r\n\turl.searchParams.set('hide', type);\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", function() {\r\n\t\r\n\r\n});\r\n\r\ndocument.addEventListener(\"click\", event =>{\r\n\tlet target = event.target;\r\n\r\n\tif(fileUploadWrap != undefined && target.matches(`.add-books`)){\r\n\t\tfileUploadWrap.querySelectorAll('.image-preview, .book.table-wrapper').forEach(el => el.remove());\r\n\t}else if(target.matches(`.add-book`)){\r\n\t\taddBook(target);\r\n\t}else if(target.matches(`.delete-book`)){\r\n\t\ttarget.closest('tr').remove();\r\n\t}else if(target.matches('.hide-existing-books')){\r\n\t\thideCss('existing-book');\r\n\t\ttarget.remove();\r\n\t}else if(target.matches('.hide-processed-books')){\r\n\t\thideCss('processed');\r\n\t\ttarget.remove();\r\n\t}\r\n});\r\n\r\ndocument.addEventListener(\"change\", async event =>{\r\n\tlet target = event.target;\r\n\r\n\tif(target.name == 'image-selector' && target.files.length > 0){\r\n\t\tfileUploadWrap\t= target.closest('.file-upload-wrap');\r\n\r\n\t\t// Remove the old table if any\r\n\t\tfileUploadWrap.querySelectorAll('.image-preview, .book.table-wrapper').forEach(el => el.remove());\r\n\t\t\r\n\t\t// Make sure we have a location\r\n\t\tlet location\t= fileUploadWrap.querySelector(`.book-location`);\r\n\t\tconst isValid \t= location.reportValidity();\r\n\t\tif (!isValid) {\t\t\t\r\n\t\t\ttarget.value = '';\r\n\t\t\tMain.displayMessage(\"Please select a location for the book.\", 'error');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlocation = location.value;\r\n\t\t\r\n\t\t// Remove previous result tables\r\n\t\tdocument.querySelectorAll('.book-table-wrapper').forEach(el => el.remove());\r\n\t\t\r\n\t\ttarget.closest('.image-selector-wrap').classList.add('hidden');\r\n\t\tfileUploadWrap.querySelectorAll('.image-preview').forEach(el => el.remove());\r\n\t\t\r\n\t\tfor (const file of target.files) {\r\n\t\t\tlet reader = new FileReader();\r\n\r\n\t\t\treader.onload = function(e) {\r\n\t\t\t\tlet div \t\t\t= document.createElement('div');\r\n\t\t\t\tdiv.classList.add('image-preview');\r\n\t\t\t\tdiv.style.textAlign\t= 'center';\r\n\r\n\t\t\t\tlet img \t\t\t= document.createElement('img');\r\n\t\t\t\timg.src \t\t\t= e.target.result;\r\n\t\t\t\timg.classList.add('book-image');\r\n\t\t\t\timg.style.maxHeight\t= \"100px\";\r\n\t\t\t\timg.style.padding\t=  \"0\";\r\n\r\n\t\t\t\tdiv.appendChild(img);\r\n\t\t\t\t\r\n\t\t\t\tfileUploadWrap.prepend(div);\r\n\t\t\t}\r\n\t\t\treader.readAsDataURL(file);\r\n\r\n\t\t\tfileUpload(target, location);\r\n\t\t}\r\n\t}else if(target.matches('.title, .author')){\r\n\t\tlet tr = target.closest('tr');\r\n\r\n\t\ttr.style.position = 'relative';\r\n\r\n\t\tlet loader = Main.showLoader(tr.lastChild, false, tr.offsetHeight - 100, 'Updating book data...');\r\n\r\n\t\tloader.style.position \t\t\t= 'absolute';\r\n\t\tloader.style.top\t\t\t\t= 0;\r\n\t\tloader.style.left\t\t\t\t= 0;\r\n\t\tloader.style.width\t\t\t\t= '100vw';\r\n\t\tloader.style.height\t\t\t\t= '100%';\r\n\t\tloader.style.backgroundColor\t= 'rgba(0, 0, 0, 0.5)';\r\n\t\tloader.style.color\t\t\t\t= 'white';\r\n\t\tloader.style.display\t\t\t= 'flex';\r\n\t\tloader.style.justifyContent\t\t= 'center';\r\n\t\tloader.style.alignItems\t\t\t= 'center';\r\n\t\t\r\n\t\t// Update metadata for the book row\r\n\t\tawait fetchMetaData(tr);\r\n\r\n\t\tloader.remove();\r\n\t}\r\n});"],"names":["removeDefaultSelect","el","Array","from","options","forEach","option","defaultSelected","oldValue","tinymceSettings","outsideClicked","event","target","closest","matches","stopPropagation","document","removeEventListener","processInput","querySelector","editTd","classList","add","textContent","innerHTML","cell","inputs","querySelectorAll","inputnode","split","val","type","value","trim","checked","selected","undefined","_niceSelect","Main","attachNiceSelect","addEventListener","keyCode","length","focus","addInputEventListeners","async","orgName","form","checkDatalist","compareValue","lowercase","name","selector","Element","tagName","match","console","trace","log","getRadioValue","elements","push","getCheckboxValue","dataset","list","origInput","getDataListValue","endsWith","elem","getMultiValue","toLowerCase","table","formData","FormData","append","JSON","stringify","key","showLoader","firstChild","FormSubmit","fetchRestApi","url","remove","setTableLabel","tdLabels","index","nicename","td","hasAttribute","cellIndex","setAttribute","showFullscreen","replace","parent","window","lastY","pageYOffset","scrollTo","style","overflow","zIndex","marginLeft","URL","location","searchParams","set","formid","history","pushState","setTableHeight","requestFullscreen","catch","err","footerHeight","headerHeight","fullscreen","URLSearchParams","search","get","wrapper","offsetHeight","px","maxHeight","positionTable","offset","newX","width","scrollWidth","innerWidth","getBoundingClientRect","x","diff","getElementById","parseInt","hideColumn","parentNode","tableRows","rows","element","cells","sim","hidden","fileUploadWrap","totalFiles","files","file","request","XMLHttpRequest","onreadystatechange","readyStateChanged","upload","fileUploadProgress","open","ajaxUrl","loader","send","e","error","displayMessage","lengthComputable","max","total","percentage","loaded","Math","round","readyState","status","result","json","parse","success","data","message","div","createElement","prepend","Event","dispatchEvent","promiseArray","tr","fetchMetaData","Promise","all","fetchMetaDatas","col","fileUploadSucces","responseText","title","author","encodeURIComponent","response","fetch","bookData","id","replaceAll","doc","join","insertAdjacentHTML","authors","baseElement","clone","originalNode","clear","tn","tinymce","settings","save","prepareForCloning","newNode","cloneNode","dropdown","init","input","select","appendChild","image","smallUrl","largeUrl","subtitle","year","language","pageCount","html","placeholder","outerHTML","description","workJson","workResponse","subject","click","hideCss","getElementsByTagName","y","switching","sort","contains","i","isNaN","datex","Date","datey","getYear","getTime","parseFloat","insertBefore","sortTable","delete","exitFullscreen","closeFullscreen","showHiddenColumns","row","img","src","addBook","reportValidity","reader","FileReader","onload","textAlign","padding","readAsDataURL","position","lastChild","top","left","height","backgroundColor","color","display","justifyContent","alignItems"],"sourceRoot":""}