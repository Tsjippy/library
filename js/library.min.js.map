{"version":3,"file":"library.min.js","mappings":"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","sources":["webpack://library/./library.js"],"sourcesContent":["console.log(\"library.js loaded\");\r\n\r\nasync function addBook(target){\r\n\tlet cell\t\t\t= target.closest('td');\r\n\tlet row\t\t\t\t= target.closest('tr');\r\n\tlet formData\t\t= new FormData();\r\n\r\n\trow.querySelectorAll('input, textarea').forEach(input=>formData.append(input.name, input.value));\r\n\trow.querySelectorAll('td > img').forEach(img=>formData.append('image', img.src));\r\n\r\n\ttarget.classList.add('hidden');\r\n\tcell.querySelector(`.loadergif_wrapper`).classList.remove('hidden');\r\n\r\n\tlet response\t= await FormSubmit.fetchRestApi('library/add_book', formData);\r\n\t\r\n\tif(response){\r\n\t\tcell.innerHTML\t= response;\r\n\r\n\t\tMain.displayMessage(response.message);\r\n\t}else{\r\n\t\ttarget.classList.remove('hidden');\r\n\t\tcell.querySelector(`.loadergif_wrapper`).classList.add('hidden');\r\n\r\n\t\ttarget.remove();\r\n\t}\r\n}\r\n\r\nlet fileUploadWrap, totalFiles;\r\nasync function fileUpload(target, location){\r\n\ttotalFiles \t\t= target.files.length;\r\n\r\n\tif (totalFiles < 0){\r\n\t\treturn;\r\n\t}\r\n\t\r\n\t//Create a formData element\r\n\tlet formData = new FormData();\r\n\t\r\n\t//Add the ajax action name\r\n\tformData.append('action', 'process_library_upload');\r\n\r\n\tformData.append('location', location);\r\n\r\n\t//Add all the files to the formData\r\n\tfor (let index = 0; index < totalFiles; index++) {\r\n\t\tlet file\t= target.files[index];\r\n\t\tformData.append('files[]', file);\r\n\t}\r\n\t\r\n\t//AJAX request\r\n\tlet request = new XMLHttpRequest();\r\n\t\r\n\t//Listen to the state changes\r\n\trequest.onreadystatechange = readyStateChanged;\r\n\t\r\n\t//Listen to the upload status\r\n\trequest.upload.addEventListener('progress', fileUploadProgress, false);\r\n\t\r\n\trequest.open('POST', sim.ajaxUrl, true);\r\n\t\r\n\t//Show loading gif\r\n\tfileUploadWrap.querySelectorAll(\".loadergif_wrapper\").forEach(loader =>{\r\n\t\tloader.classList.remove('hidden');\r\n\t\tloader.querySelectorAll(\".uploadmessage\").forEach(el =>{\r\n\t\t\tel.textContent = \"Preparing upload\";\r\n\t\t\tel.classList.add('upload-message');\r\n\t\t});\r\n\t});\r\n\t\r\n\t//Send AJAX request\r\n\tfileUploadWrap.querySelector('.uploadmessage').textContent = \"Uploading Picture(s)\";\r\n\tdocument.getElementById('progress-wrapper').classList.remove('hidden');\r\n\r\n\trequest.send(formData);\r\n}\r\n\r\nfunction fileUploadProgress(e){\r\n\tif(e.lengthComputable){\r\n\t\tlet max \t\t= e.total;\r\n\t\tlet current \t= e.loaded;\r\n\r\n\t\tlet percentage \t= (current * 100)/max;\r\n\t\tpercentage \t\t= Math.round(percentage*10)/10\r\n\t\t\r\n\t\tdocument.querySelectorAll(\"#upload_progress\").forEach(el=>el.value = percentage);\r\n\t\tdocument.querySelectorAll(\"#progress_percentage\").forEach(el=>el.textContent\t= `   ${percentage}%`);\r\n\r\n\t\tif(percentage >= 99){\r\n\t\t\t//Remove progress barr\r\n\t\t\tdocument.getElementById(\"progress-wrapper\").classList.add('hidden');\r\n\t\t\t\r\n\t\t\t// process completed\r\n\t\t\tfileUploadWrap.querySelectorAll(\".uploadmessage\").forEach(el =>{\r\n\t\t\t\t//Change message text\r\n\t\t\t\tif (totalFiles > 1){\r\n\t\t\t\t\tel.textContent = \"Processing images\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\tel.textContent = \"Processing image\";\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}  \r\n}\r\n\r\nfunction readyStateChanged(e){\r\n\tlet request\t= e.target;\r\n\t\r\n\t//If finished\r\n\tif(request.readyState == 4){\r\n\t\t//Success\r\n\t\tif (request.status >= 200 && request.status < 400) {\r\n\t\t\tfileUploadSucces(request.responseText)\r\n\t\t//Error\r\n\t\t}else{\r\n\t\t\tconsole.error(request.responseText);\r\n\t\t\tMain.displayMessage(JSON.parse(request.responseText).error,'error');\r\n\t\t}\r\n\t\t\r\n\t\t//Hide loading gif\r\n\t\tdocument.querySelectorAll(\".loadergif_wrapper\").forEach(\r\n\t\t\tfunction(loader){\r\n\t\t\t\tloader.classList.add('hidden');\r\n\t\t\t}\r\n\t\t);\r\n\t\t\t\r\n\t\t//Clear the input\r\n\t\tfileUploadWrap.querySelector('input[type=\"file\"]').value = \"\";\r\n\t}\r\n}\r\n\r\nfunction fileUploadSucces(result){\r\n\tfileUploadWrap.innerHTML\t= JSON.parse(result).data + fileUploadWrap.innerHTML;\r\n\t\r\n\tMain.displayMessage(\"The files have been processed succesfully.\", 'success', true);\r\n\r\n\tfileUploadWrap.querySelector('.image-selector-wrap').classList.remove('hidden');\r\n\r\n\t// Create a custom event so others can listen to it.\r\n\t// Used by formstable uploads\r\n\tconst event = new Event('uploadfinished');\r\n\tfileUploadWrap.dispatchEvent(event);\r\n\r\n\tfetchMetaDatas();\r\n}\r\n\r\nasync function fetchMetaDatas(){\r\n\tfileUploadWrap.querySelectorAll('table tr').forEach(async (tr) => {\r\n\t\tfetchMetaData(tr);\r\n\t});\r\n}\r\n\r\nasync function fetchMetaData(tr){\r\n\ttry{\r\n\t\t// Check if a book row\r\n\t\tif(tr.querySelector('.title') == null){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet title\t= tr.querySelector('.title').value;\r\n\r\n\t\t// Only search for the first author\r\n\t\tlet author\t= tr.querySelector('.author').value.split(', ')[0].split(' and ')[0].split('/')[0].split('with')[0].trim();\r\n\t\tlet url     = `https://openlibrary.org/search.json?q=`+encodeURIComponent(`title:${title}`);\r\n\t\tif(author != ''){\r\n\t\t\turl += encodeURIComponent(` author:${author}`)+'&limit=1';\r\n\t\t}\r\n\t\turl += '&fields=key,title,author_name,subtitle,alternative_subtitle,cover_i,isbn,language,number_of_pages_median,first_publish_year,description';\r\n\r\n\t\tconst response \t= await fetch(url);\r\n\t\tconst data \t\t= await response.json();\r\n\t\tlet bookData    = data['docs'][0] ?? [];\r\n\r\n\t\tif(author == ''){\r\n\t\t\tlet id\t= `authorlist-${title.replaceAll(\" \", \"_\").replaceAll(\"'\", \"\")}`;\r\n\t\t\ttr.querySelector('.author').setAttribute(\"list\", id);\r\n\r\n\t\t\tlet list = `<datalist id='${id}' class='author-selection'>`;\r\n\r\n\t\t\tdata['docs'].forEach((doc) => {\r\n\t\t\t\tif(doc['author_name'] != undefined){\r\n\t\t\t\t\tlist += `<option value='${doc['author_name'].join()}'>`;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tlist += `</datalist>`;\r\n\t\t\ttr.querySelector('.author').insertAdjacentHTML('afterEnd', list);\r\n\t\t}else{\r\n\t\t\tauthor \t= bookData['author_name'] ?? author;\r\n\r\n\t\t\tif(typeof(author) === 'object'){\r\n\t\t\t\tauthor\t= author.join() ?? author;\r\n\t\t\t}\r\n\t\t\ttr.querySelector('.author').value = bookData['author_name'] ?? author;\r\n\t\t}\r\n\r\n\t\tlet image        = bookData['cover_i'] ?? '';\r\n        if(image != ''){\r\n           \tlet  smallUrl    = `https://covers.openlibrary.org/b/id/${image}-S.jpg`;\r\n\t\t   \tlet  largeUrl    = `https://covers.openlibrary.org/b/id/${image}-L.jpg`;\r\n\r\n\t\t\ttr.querySelector('.image').innerHTML = `<input type='hidden' name='image' value='${image}'><a href='${largeUrl}' target='_blank'><img src='${smallUrl}' class='book-image' loading='lazy'></a>`;\r\n        }\r\n\r\n\t\tlet subtitle\t= bookData['subtitle'] ?? '';\r\n\r\n\t\tlet isbn\t\t= JSON.stringify(bookData['isbn'] ?? '');\r\n\r\n\t\tlet year\t\t= bookData['first_publish_year'] ?? '';\r\n\t\tyear\t\t\t= year[0] ?? year;\r\n\r\n\t\tlet language\t= bookData['language'] ?? '';\r\n\t\tlanguage\t\t= language[0] ?? language;\r\n\r\n\t\tlet pageCount\t\t= bookData['number_of_pages'] ?? bookData['number_of_pages_median'] ?? '';\r\n\r\n\t\tlet html = `<td><input type='text' name='subtitle' class='subtitle' value='${subtitle}'></td>`;\r\n\t\thtml += `<td class='hidden'><input type='text' name='isbn' class='isbn' value='${isbn}'></td>`;\r\n\t\thtml += `<td><input type='text' name='series' class='series' value='${bookData['series'] ?? ''}'></td>`;\r\n\t\thtml += `<td><input type='text' name='year' class='year' value='${year}'></td>`;\r\n\t\thtml += `<td><input type='text' name='language' class='language' value='${language}'></td>`;\r\n\t\thtml += `<td><input type='text' name='pages' class='pages' value='${pageCount}'></td>`;\r\n\r\n\t\tlet placeholder\t= tr.querySelector('.placeholder');\r\n\t\tif(placeholder == null){\r\n\t\t\ttr.querySelector('.subtitle').value = subtitle;\r\n\t\t\ttr.querySelector('.isbn').value \t= isbn;\r\n\t\t\ttr.querySelector('.series').value \t= bookData['series'] ?? '';\r\n\t\t\ttr.querySelector('.year').value \t= year;\r\n\t\t\ttr.querySelector('.language').value = language;\r\n\t\t\ttr.querySelector('.pages').value \t= pageCount;\r\n\t\t}else{\r\n\t\t\tplaceholder.outerHTML = html;\r\n\t\t}\r\n\r\n        let summary      \t= tr.querySelector('.summary').value\r\n\t\tsummary\t\t\t\t= bookData['description'] != undefined ? bookData['description']['value'] != undefined ? bookData['description']['value'] : summary : summary;\r\n\r\n\t\tlet key        = bookData['key'] ?? '';\r\n        if(key != ''){\r\n            url      = `https://openlibrary.org${key}`;\r\n\t\t\ttr.querySelector('.url').innerHTML = `<a href='${url}' target='_blank'>View on Open Library</a>`;\r\n\r\n\t\t\t// Fetch the summary if not already set or needs to be updated\r\n\t\t\tif(summary == '' || placeholder == null){\r\n\t\t\t\t// Fetch the summary from the Open Library API\r\n\t\t\t\tconst descriptionResponse \t= await fetch(url+'.json');\r\n\t\t\t\tconst description \t\t\t= await descriptionResponse.json();\r\n\r\n\t\t\t\tsummary = description['description'] ?? '';\t\r\n\t\t\t\t\r\n\t\t\t\tsummary = summary.value ?? summary;\r\n\t\t\t}\r\n        }\r\n\r\n\t\tif(summary != ''){\r\n\t\t\ttr.querySelector('.summary').value = summary;\r\n\t\t}\r\n\r\n\t} catch(e){\r\n\t\tconsole.error('Error fetching book data:', e);\r\n\t}\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", function() {\r\n\t\r\n\r\n});\r\n\r\ndocument.addEventListener(\"click\", event =>{\r\n\tlet target = event.target;\r\n\r\n\tif(target.matches(`.add-book`)){\r\n\t\taddBook(target);\r\n\t}else if(target.matches(`.delete-book`)){\r\n\t\ttarget.closest('tr').remove();\r\n\t}\r\n});\r\n\r\ndocument.addEventListener(\"change\", async event =>{\r\n\tlet target = event.target;\r\n\r\n\tif(target.name == 'image-selector' && target.files.length > 0){\r\n\t\tfileUploadWrap\t= target.closest('.file_upload_wrap');\r\n\t\t\r\n\t\t// Make sure we have a location\r\n\t\tlet location\t= fileUploadWrap.querySelector(`.book-location`);\r\n\t\tconst isValid \t= location.reportValidity();\r\n\t\tif (!isValid) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlocation = location.value;\r\n\t\t\r\n\t\t// Remove previous result tables\r\n\t\tdocument.querySelectorAll('.book-table-wrapper').forEach(el => el.remove());\r\n\t\t\r\n\t\ttarget.closest('.image-selector-wrap').classList.add('hidden');\r\n\t\tfileUploadWrap.querySelectorAll('.image-preview').forEach(el => el.remove());\r\n\t\t\r\n\t\tfor (const file of target.files) {\r\n\t\t\tlet reader = new FileReader();\r\n\r\n\t\t\treader.onload = function(e) {\r\n\t\t\t\tlet div \t\t\t= document.createElement('div');\r\n\t\t\t\tdiv.classList.add('image-preview');\r\n\r\n\t\t\t\tlet img \t\t\t= document.createElement('img');\r\n\t\t\t\timg.src \t\t\t= e.target.result;\r\n\t\t\t\timg.classList.add('book-image');\r\n\t\t\t\timg.style.maxHeight\t= \"100px\";\r\n\r\n\t\t\t\tdiv.appendChild(img);\r\n\t\t\t\t\r\n\t\t\t\tfileUploadWrap.prepend(div);\r\n\t\t\t}\r\n\t\t\treader.readAsDataURL(file);\r\n\r\n\t\t\tfileUpload(target, location);\r\n\t\t}\r\n\t}else if(target.matches('.title, .author')){\r\n\t\tlet tr = target.closest('tr');\r\n\t\t\r\n\t\t// Update metadata for the book row\r\n\t\tawait fetchMetaData(tr);\r\n\r\n\t\tMain.displayMessage(\"Updated details succesfully.\", 'success', true);\r\n\t}\r\n});"],"names":["fileUploadWrap","totalFiles","async","fileUpload","target","location","files","length","formData","FormData","append","index","file","request","XMLHttpRequest","onreadystatechange","readyStateChanged","upload","addEventListener","fileUploadProgress","open","sim","ajaxUrl","querySelectorAll","forEach","loader","classList","remove","el","textContent","add","querySelector","document","getElementById","send","e","lengthComputable","max","total","percentage","loaded","Math","round","value","readyState","status","result","innerHTML","JSON","parse","data","Main","displayMessage","event","Event","dispatchEvent","tr","fetchMetaData","fetchMetaDatas","fileUploadSucces","responseText","console","error","title","author","split","trim","url","encodeURIComponent","response","fetch","json","bookData","id","replaceAll","setAttribute","list","doc","undefined","join","insertAdjacentHTML","image","smallUrl","largeUrl","subtitle","isbn","stringify","year","language","pageCount","html","placeholder","outerHTML","summary","key","descriptionResponse","log","matches","cell","closest","row","input","name","img","src","FormSubmit","fetchRestApi","message","addBook","reportValidity","reader","FileReader","onload","div","createElement","style","maxHeight","appendChild","prepend","readAsDataURL"],"sourceRoot":""}