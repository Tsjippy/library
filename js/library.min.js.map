{"version":3,"file":"library.min.js","mappings":"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","sources":["webpack://library/./library.js"],"sourcesContent":["import { addStyles } from '../../../plugins/sim-plugin/includes/js/imports.js';\r\n\r\nconsole.log(\"library.js loaded\");\r\n\r\nasync function addBook(target){\r\n\tlet cell\t\t\t= target.closest('td');\r\n\tlet row\t\t\t\t= target.closest('tr');\r\n\tlet formData\t\t= new FormData();\r\n\r\n\trow.querySelectorAll('input, textarea').forEach(input=>formData.append(input.name, input.value));\r\n\trow.querySelectorAll('td > img').forEach(img=>formData.append('image', img.src));\r\n\tconsole.log(target);\r\n\r\n\ttarget.classList.add('hidden');\r\n\tcell.querySelector(`.loadergif_wrapper`).classList.remove('hidden');\r\n\r\n\tlet response\t= await FormSubmit.fetchRestApi('library/add_book', formData);\r\n\t\r\n\tif(response){\r\n\t\tconsole.log(response);\r\n\r\n\t\tcell.innerHTML\t= response;\r\n\r\n\t\tMain.displayMessage(response.message);\r\n\t}else{\r\n\t\ttarget.classList.remove('hidden');\r\n\t\tcell.querySelector(`.loadergif_wrapper`).classList.add('hidden');\r\n\t}\r\n}\r\n\r\nlet fileUploadWrap, totalFiles;\r\nasync function fileUpload(target){\r\n\ttotalFiles \t\t= target.files.length;\r\n\r\n\tif (totalFiles < 0){\r\n\t\treturn;\r\n\t}\r\n\t\r\n\t//Create a formData element\r\n\tlet formData = new FormData();\r\n\t\r\n\t//Add the ajax action name\r\n\tformData.append('action', 'process_library_upload');\r\n\r\n\t//Add all the files to the formData\r\n\tfor (let index = 0; index < totalFiles; index++) {\r\n\t\tlet file\t= target.files[index];\r\n\t\tformData.append('files[]', file);\r\n\t}\r\n\t\r\n\t//AJAX request\r\n\tlet request = new XMLHttpRequest();\r\n\t\r\n\t//Listen to the state changes\r\n\trequest.onreadystatechange = readyStateChanged;\r\n\t\r\n\t//Listen to the upload status\r\n\trequest.upload.addEventListener('progress', fileUploadProgress, false);\r\n\t\r\n\trequest.open('POST', sim.ajaxUrl, true);\r\n\t\r\n\t//Show loading gif\r\n\tfileUploadWrap.querySelectorAll(\".loadergif_wrapper\").forEach(loader =>{\r\n\t\tloader.classList.remove('hidden');\r\n\t\tloader.querySelectorAll(\".uploadmessage\").forEach(el =>{\r\n\t\t\tel.textContent = \"Preparing upload\";\r\n\t\t\tel.classList.add('upload-message');\r\n\t\t});\r\n\t});\r\n\t\r\n\t//Send AJAX request\r\n\tfileUploadWrap.querySelector('.uploadmessage').textContent = \"Uploading Picture(s)\";\r\n\tdocument.getElementById('progress-wrapper').classList.remove('hidden');\r\n\r\n\trequest.send(formData);\r\n}\r\n\r\nfunction fileUploadProgress(e){\r\n\tif(e.lengthComputable){\r\n\t\tlet max \t\t= e.total;\r\n\t\tlet current \t= e.loaded;\r\n\r\n\t\tlet percentage \t= (current * 100)/max;\r\n\t\tpercentage \t\t= Math.round(percentage*10)/10\r\n\t\t\r\n\t\tdocument.querySelectorAll(\"#upload_progress\").forEach(el=>el.value = percentage);\r\n\t\tdocument.querySelectorAll(\"#progress_percentage\").forEach(el=>el.textContent\t= `   ${percentage}%`);\r\n\r\n\t\tif(percentage >= 99){\r\n\t\t\t//Remove progress barr\r\n\t\t\tdocument.getElementById(\"progress-wrapper\").classList.add('hidden');\r\n\t\t\t\r\n\t\t\t// process completed\r\n\t\t\tfileUploadWrap.querySelectorAll(\".uploadmessage\").forEach(el =>{\r\n\t\t\t\t//Change message text\r\n\t\t\t\tif (totalFiles > 1){\r\n\t\t\t\t\tel.textContent = \"Processing images\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\tel.textContent = \"Processing image\";\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}  \r\n}\r\n\r\nfunction readyStateChanged(e){\r\n\tlet request\t= e.target;\r\n\t\r\n\t//If finished\r\n\tif(request.readyState == 4){\r\n\t\t//Success\r\n\t\tif (request.status >= 200 && request.status < 400) {\r\n\t\t\tfileUploadSucces(request.responseText)\r\n\t\t//Error\r\n\t\t}else{\r\n\t\t\tconsole.error(request.responseText);\r\n\t\t\tMain.displayMessage(JSON.parse(request.responseText).error,'error');\r\n\t\t}\r\n\t\t\r\n\t\t//Hide loading gif\r\n\t\tdocument.querySelectorAll(\".loadergif_wrapper\").forEach(\r\n\t\t\tfunction(loader){\r\n\t\t\t\tloader.classList.add('hidden');\r\n\t\t\t}\r\n\t\t);\r\n\t\t\t\r\n\t\t//Clear the input\r\n\t\tfileUploadWrap.querySelector('input[type=\"file\"]').value = \"\";\r\n\t}\r\n}\r\n\r\nfunction fileUploadSucces(result){\r\n\tfileUploadWrap.innerHTML\t= JSON.parse(result).data + fileUploadWrap.innerHTML;\r\n\t\r\n\tMain.displayMessage(\"The files have been processed succesfully.\", 'success', true);\r\n\r\n\tfileUploadWrap.querySelector('.image-selector-wrap').classList.remove('hidden');\r\n\r\n\t// Create a custom event so others can listen to it.\r\n\t// Used by formstable uploads\r\n\tconst event = new Event('uploadfinished');\r\n\tfileUploadWrap.dispatchEvent(event);\r\n\r\n\tfetchMetaDatas();\r\n}\r\n\r\nasync function fetchMetaDatas(){\r\n\tfileUploadWrap.querySelectorAll('table tr').forEach(async (tr) => {\r\n\t\tfetchMetaData(tr);\r\n\t});\r\n}\r\n\r\nasync function fetchMetaData(tr){\r\n\ttry{\r\n\t\t// Check if a book row\r\n\t\tif(tr.querySelector('.title') == null){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet title\t= tr.querySelector('.title').value;\r\n\r\n\t\t// Only search for the first author\r\n\t\tlet author\t= tr.querySelector('.author').value.split(', ')[0].split('and')[0].split('/')[0].split('with')[0].trim();\r\n\t\tlet url     = `https://openlibrary.org/search.json?q=`+encodeURIComponent(`title:${title}`);\r\n\t\tif(author != ''){\r\n\t\t\turl += encodeURIComponent(` author:${author}`);\r\n\t\t}\r\n\r\n\t\tconst response \t= await fetch(url);\r\n\t\tconst data \t\t= await response.json();\r\n\t\tlet bookData    = data['docs'][0] ?? [];\r\n\r\n\t\tif(author == ''){\r\n\t\t\tlet id\t= `authorlist-${title.replaceAll(\" \", \"_\")}`;\r\n\t\t\ttr.querySelector('.author').setAttribute(\"list\", id);\r\n\r\n\t\t\tlet list = `<datalist id='${id}' class='author-selection'>`;\r\n\r\n\t\t\tdata['docs'].forEach((doc) => {\r\n\t\t\t\tif(doc['author_name'] != undefined){\r\n\t\t\t\t\tlist += `<option value='${doc['author_name'].join()}'>`;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tlist += `</datalist>`;\r\n\t\t\ttr.querySelector('.author').insertAdjacentHTML('afterEnd', list);\r\n\t\t}else{\r\n\t\t\tauthor \t= bookData['author_name'] ?? author;\r\n\r\n\t\t\tif(typeof(author) === 'object'){\r\n\t\t\t\tauthor\t= author.join() ?? author;\r\n\t\t\t}\r\n\t\t\ttr.querySelector('.author').value = bookData['author_name'] ?? author;\r\n\t\t}\r\n\r\n\t\tlet image        = bookData['cover_i'] ?? '';\r\n        if(image != ''){\r\n           \tlet  smallUrl    = `https://covers.openlibrary.org/b/id/${image}-S.jpg`;\r\n\t\t   \tlet  largeUrl    = `https://covers.openlibrary.org/b/id/${image}-L.jpg`;\r\n\r\n\t\t\ttr.querySelector('.image').innerHTML = `<input type='hidden' name='image' value='${image}'><a href='${largeUrl}' target='_blank'><img src='${smallUrl}' class='book-image' loading='lazy'></a>`;\r\n        }\r\n\r\n\t\tlet subtitle\t= title.split(':')[1] ?? '';\r\n\t\tif(subtitle == ''){\r\n\t\t\tsubtitle\t= title.split(',')[1] ?? '';\r\n\t\t}\r\n\t\ttitle\t\t\t= title.split(':')[0].split(',')[0];\r\n\t\ttr.querySelector('.title').value = title;\r\n\r\n\t\tlet isbn13\t\t= bookData['isbn_13'] ?? '';\r\n\t\tisbn13\t\t\t= isbn13[0] ?? isbn13;\r\n\r\n\t\tlet isbn10\t\t= bookData['isbn_10'] ?? '';\r\n\t\tisbn10\t\t\t= isbn10[0] ?? isbn10;\r\n\r\n\t\tlet year\t\t= bookData['first_publish_year'] ?? '';\r\n\t\tyear\t\t\t= year[0] ?? year;\r\n\r\n\t\tlet language\t= bookData['language'] ?? '';\r\n\t\tlanguage\t\t= language[0] ?? language;\r\n\r\n\t\tlet html = `<td><input type='text' name='subtitle' class='subtitle' value='${subtitle}'></td>`;\r\n\t\thtml += `<td class='hidden'><input type='text' name='isbn13' class='isbn13' value='${isbn13}'></td>`;\r\n\t\thtml += `<td class='hidden'><input type='text' name='isbn10' class='isbn10' value='${isbn10}'></td>`;\r\n\t\thtml += `<td><input type='text' name='series' class='series' value='${bookData['series'] ?? ''}'></td>`;\r\n\t\thtml += `<td><input type='text' name='year' class='year' value='${year}'></td>`;\r\n\t\thtml += `<td><input type='text' name='language' class='language' value='${language}'></td>`;\r\n\t\thtml += `<td><input type='text' name='pages' class='pages' value='${bookData['number_of_pages'] ?? ''}'></td>`;\r\n\r\n\t\tlet placeholder\t= tr.querySelector('.placeholder');\r\n\t\tif(placeholder == null){\r\n\t\t\ttr.querySelector('.subtitle').value = subtitle;\r\n\t\t\ttr.querySelector('.isbn13').value \t= isbn13;\r\n\t\t\ttr.querySelector('.isbn10').value \t= isbn10;\r\n\t\t\ttr.querySelector('.series').value \t= bookData['series'] ?? '';\r\n\t\t\ttr.querySelector('.year').value \t= year;\r\n\t\t\ttr.querySelector('.language').value = language;\r\n\t\t\ttr.querySelector('.pages').value \t= bookData['number_of_pages'] ?? '';\r\n\t\t}else{\r\n\t\t\tplaceholder.outerHTML = html;\r\n\t\t}\r\n\r\n        let summary      = bookData['description'] != undefined ? bookData['description']['value'] != undefined ? bookData['description']['value'] : '' : '';\r\n\t\tif(summary != ''){\r\n\t\t\ttr.querySelector('.summary').value = summary;\r\n\t\t}\r\n\r\n\t\tlet key        = bookData['key'] ?? '';\r\n        if(key != ''){\r\n            url      = `https://openlibrary.org${key}`;\r\n\t\t\ttr.querySelector('.url').innerHTML = `<a href='${url}' target='_blank'>View on Open Library</a>`;\r\n        }\r\n\r\n\t} catch(e){\r\n\t\tconsole.error('Error fetching book data:', e);\r\n\t}\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", function() {\r\n\t\r\n\r\n});\r\n\r\ndocument.addEventListener(\"click\", event =>{\r\n\tlet target = event.target;\r\n\r\n\tif(target.matches(`.add-book`)){\r\n\t\taddBook(target);\r\n\t}else if(target.matches(`.delete-book`)){\r\n\t\ttarget.remove();\r\n\t}\r\n});\r\n\r\ndocument.addEventListener(\"change\", async event =>{\r\n\tlet target = event.target;\r\n\r\n\tif(target.name == 'image-selector'){\r\n\t\ttarget.closest('.image-selector-wrap').classList.add('hidden');\r\n\t\tfileUploadWrap\t= target.closest('.file_upload_wrap');\r\n\t\tfileUploadWrap.querySelectorAll('.image-preview').forEach(el => el.remove());\r\n\t\t\r\n\t\tfor (const file of target.files) {\r\n\t\t\tlet reader = new FileReader();\r\n\r\n\t\t\treader.onload = function(e) {\r\n\t\t\t\tlet div \t\t\t= document.createElement('div');\r\n\t\t\t\tdiv.classList.add('image-preview');\r\n\r\n\t\t\t\tlet img \t\t\t= document.createElement('img');\r\n\t\t\t\timg.src \t\t\t= e.target.result;\r\n\t\t\t\timg.classList.add('book-image');\r\n\t\t\t\timg.style.maxHeight\t= \"100px\";\r\n\r\n\t\t\t\tdiv.appendChild(img);\r\n\t\t\t\t\r\n\t\t\t\tfileUploadWrap.prepend(div);\r\n\t\t\t}\r\n\t\t\treader.readAsDataURL(file);\r\n\r\n\t\t\tfileUpload(target);\r\n\t\t}\r\n\t}else if(target.matches('.title, .author')){\r\n\t\tlet tr = target.closest('tr');\r\n\t\t\r\n\t\t// Update metadata for the book row\r\n\t\tawait fetchMetaData(tr);\r\n\r\n\t\tMain.displayMessage(\"Updated details succesfully.\", 'success', true);\r\n\t}\r\n});"],"names":["fileUploadWrap","totalFiles","async","fileUpload","target","files","length","formData","FormData","append","index","file","request","XMLHttpRequest","onreadystatechange","readyStateChanged","upload","addEventListener","fileUploadProgress","open","sim","ajaxUrl","querySelectorAll","forEach","loader","classList","remove","el","textContent","add","querySelector","document","getElementById","send","e","lengthComputable","max","total","percentage","loaded","Math","round","value","readyState","status","result","innerHTML","JSON","parse","data","Main","displayMessage","event","Event","dispatchEvent","tr","fetchMetaData","fetchMetaDatas","fileUploadSucces","responseText","console","error","title","author","split","trim","url","encodeURIComponent","response","fetch","json","bookData","id","replaceAll","setAttribute","list","doc","undefined","join","insertAdjacentHTML","image","smallUrl","largeUrl","subtitle","isbn13","isbn10","year","language","html","placeholder","outerHTML","summary","key","log","matches","cell","closest","row","input","name","img","src","FormSubmit","fetchRestApi","message","addBook","reader","FileReader","onload","div","createElement","style","maxHeight","appendChild","prepend","readAsDataURL"],"sourceRoot":""}